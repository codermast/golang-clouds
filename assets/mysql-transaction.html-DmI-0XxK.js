import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as e}from"./app-Cjxa952C.js";const t={};function l(d,s){return e(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="mysql-事务" tabindex="-1"><a class="header-anchor" href="#mysql-事务"><span>MySQL 事务</span></a></h1><p>事务是一组不可分割的操作，要么全部成功，要么全部失败。</p><h2 id="事务操作" tabindex="-1"><a class="header-anchor" href="#事务操作"><span>事务操作</span></a></h2><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查看自动提交状态</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @@autocommit;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 关闭自动提交</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @@autocommit </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启事务</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">START TRANSACTION</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 或</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">BEGIN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 提交事务</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">COMMIT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 回滚事务</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ROLLBACK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>示例</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">START TRANSACTION</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">UPDATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> account </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> balance </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> balance - </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;张三&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">UPDATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> account </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> balance </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> balance + </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;李四&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 成功则提交</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">COMMIT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 失败则回滚</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ROLLBACK;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="acid-特性" tabindex="-1"><a class="header-anchor" href="#acid-特性"><span>ACID 特性</span></a></h2><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">说明</th><th style="text-align:left;">实现机制</th></tr></thead><tbody><tr><td style="text-align:left;">原子性</td><td style="text-align:left;">事务不可分割，要么全成功要么全失败</td><td style="text-align:left;">undo log</td></tr><tr><td style="text-align:left;">一致性</td><td style="text-align:left;">事务前后数据状态一致</td><td style="text-align:left;">其他三个特性保证</td></tr><tr><td style="text-align:left;">隔离性</td><td style="text-align:left;">事务之间互不干扰</td><td style="text-align:left;">MVCC + 锁</td></tr><tr><td style="text-align:left;">持久性</td><td style="text-align:left;">事务提交后数据永久保存</td><td style="text-align:left;">redo log</td></tr></tbody></table><h2 id="并发问题" tabindex="-1"><a class="header-anchor" href="#并发问题"><span>并发问题</span></a></h2><table><thead><tr><th style="text-align:left;">问题</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">脏读</td><td style="text-align:left;">读到其他事务<strong>未提交</strong>的数据</td></tr><tr><td style="text-align:left;">不可重复读</td><td style="text-align:left;">同一事务内两次读取<strong>同一行</strong>数据不一致</td></tr><tr><td style="text-align:left;">幻读</td><td style="text-align:left;">同一事务内两次读取<strong>记录数</strong>不一致</td></tr></tbody></table><h3 id="脏读" tabindex="-1"><a class="header-anchor" href="#脏读"><span>脏读</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>事务A                        事务B</span></span>
<span class="line"><span>BEGIN;                       BEGIN;</span></span>
<span class="line"><span>UPDATE user SET age=20;      </span></span>
<span class="line"><span>                             SELECT age FROM user; → 20（脏读）</span></span>
<span class="line"><span>ROLLBACK;                    </span></span>
<span class="line"><span>                             -- 读到的20是无效数据</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="不可重复读" tabindex="-1"><a class="header-anchor" href="#不可重复读"><span>不可重复读</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>事务A                        事务B</span></span>
<span class="line"><span>BEGIN;                       BEGIN;</span></span>
<span class="line"><span>SELECT age FROM user; → 18   </span></span>
<span class="line"><span>                             UPDATE user SET age=20;</span></span>
<span class="line"><span>                             COMMIT;</span></span>
<span class="line"><span>SELECT age FROM user; → 20   -- 两次读取结果不同</span></span>
<span class="line"><span>COMMIT;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="幻读" tabindex="-1"><a class="header-anchor" href="#幻读"><span>幻读</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>事务A                            事务B</span></span>
<span class="line"><span>BEGIN;                           BEGIN;</span></span>
<span class="line"><span>SELECT * WHERE age=18; → 2条     </span></span>
<span class="line"><span>                                 INSERT INTO user VALUES(3, 18);</span></span>
<span class="line"><span>                                 COMMIT;</span></span>
<span class="line"><span>SELECT * WHERE age=18; → 3条     -- 记录数变化</span></span>
<span class="line"><span>COMMIT;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="隔离级别" tabindex="-1"><a class="header-anchor" href="#隔离级别"><span>隔离级别</span></a></h2><table><thead><tr><th style="text-align:left;">隔离级别</th><th style="text-align:left;">脏读</th><th style="text-align:left;">不可重复读</th><th style="text-align:left;">幻读</th><th style="text-align:left;">性能</th></tr></thead><tbody><tr><td style="text-align:left;">Read Uncommitted</td><td style="text-align:left;">✅</td><td style="text-align:left;">✅</td><td style="text-align:left;">✅</td><td style="text-align:left;">最高</td></tr><tr><td style="text-align:left;">Read Committed</td><td style="text-align:left;">❌</td><td style="text-align:left;">✅</td><td style="text-align:left;">✅</td><td style="text-align:left;">较高</td></tr><tr><td style="text-align:left;">Repeatable Read</td><td style="text-align:left;">❌</td><td style="text-align:left;">❌</td><td style="text-align:left;">✅</td><td style="text-align:left;">一般</td></tr><tr><td style="text-align:left;">Serializable</td><td style="text-align:left;">❌</td><td style="text-align:left;">❌</td><td style="text-align:left;">❌</td><td style="text-align:left;">最低</td></tr></tbody></table><p><strong>MySQL 默认隔离级别：Repeatable Read（RR）</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查看隔离级别</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @@transaction_isolation;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 设置隔离级别</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SESSION</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TRANSACTION</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ISOLATION</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> LEVEL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> READ</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> COMMITTED</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> GLOBAL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TRANSACTION</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ISOLATION</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> LEVEL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> REPEATABLE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> READ</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mvcc" tabindex="-1"><a class="header-anchor" href="#mvcc"><span>MVCC</span></a></h2><p>MVCC（Multi-Version Concurrency Control）多版本并发控制，用于实现 RC 和 RR 隔离级别。</p><h3 id="核心组件" tabindex="-1"><a class="header-anchor" href="#核心组件"><span>核心组件</span></a></h3><table><thead><tr><th style="text-align:left;">组件</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">隐藏字段</td><td style="text-align:left;">DB_TRX_ID、DB_ROLL_PTR、DB_ROW_ID</td></tr><tr><td style="text-align:left;">undo log</td><td style="text-align:left;">记录数据的历史版本</td></tr><tr><td style="text-align:left;">Read View</td><td style="text-align:left;">判断版本可见性</td></tr></tbody></table><h3 id="隐藏字段" tabindex="-1"><a class="header-anchor" href="#隐藏字段"><span>隐藏字段</span></a></h3><p>每行数据都有三个隐藏字段：</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">DB_TRX_ID</td><td style="text-align:left;">最后修改该行的事务 ID</td></tr><tr><td style="text-align:left;">DB_ROLL_PTR</td><td style="text-align:left;">指向 undo log 的指针</td></tr><tr><td style="text-align:left;">DB_ROW_ID</td><td style="text-align:left;">隐藏主键（无主键时使用）</td></tr></tbody></table><h3 id="版本链" tabindex="-1"><a class="header-anchor" href="#版本链"><span>版本链</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>当前版本</span></span>
<span class="line"><span>┌──────────────────────┐</span></span>
<span class="line"><span>│ id=1, name=&#39;张三&#39;    │</span></span>
<span class="line"><span>│ DB_TRX_ID = 100      │</span></span>
<span class="line"><span>│ DB_ROLL_PTR ─────────┼──┐</span></span>
<span class="line"><span>└──────────────────────┘  │</span></span>
<span class="line"><span>                          ▼</span></span>
<span class="line"><span>                    ┌──────────────────────┐</span></span>
<span class="line"><span>                    │ id=1, name=&#39;李四&#39;    │</span></span>
<span class="line"><span>                    │ DB_TRX_ID = 50       │</span></span>
<span class="line"><span>                    │ DB_ROLL_PTR ─────────┼──┐</span></span>
<span class="line"><span>                    └──────────────────────┘  │</span></span>
<span class="line"><span>                                              ▼</span></span>
<span class="line"><span>                                        ┌──────────────────────┐</span></span>
<span class="line"><span>                                        │ id=1, name=&#39;王五&#39;    │</span></span>
<span class="line"><span>                                        │ DB_TRX_ID = 10       │</span></span>
<span class="line"><span>                                        │ DB_ROLL_PTR = NULL   │</span></span>
<span class="line"><span>                                        └──────────────────────┘</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="read-view" tabindex="-1"><a class="header-anchor" href="#read-view"><span>Read View</span></a></h3><p>Read View 记录当前活跃事务，用于判断版本可见性。</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">m_ids</td><td style="text-align:left;">活跃事务 ID 列表</td></tr><tr><td style="text-align:left;">min_trx_id</td><td style="text-align:left;">最小活跃事务 ID</td></tr><tr><td style="text-align:left;">max_trx_id</td><td style="text-align:left;">下一个待分配的事务 ID</td></tr><tr><td style="text-align:left;">creator_trx_id</td><td style="text-align:left;">创建该 Read View 的事务 ID</td></tr></tbody></table><p><strong>可见性判断规则：</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>trx_id == creator_trx_id  → 可见（自己的修改）</span></span>
<span class="line"><span>trx_id &lt; min_trx_id       → 可见（事务已提交）</span></span>
<span class="line"><span>trx_id &gt;= max_trx_id      → 不可见（未来的事务）</span></span>
<span class="line"><span>trx_id in m_ids           → 不可见（未提交的活跃事务）</span></span>
<span class="line"><span>其他                       → 可见</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rc-vs-rr-的区别" tabindex="-1"><a class="header-anchor" href="#rc-vs-rr-的区别"><span>RC vs RR 的区别</span></a></h3><table><thead><tr><th style="text-align:left;">隔离级别</th><th style="text-align:left;">Read View 生成时机</th></tr></thead><tbody><tr><td style="text-align:left;">RC</td><td style="text-align:left;">每次 SELECT 都生成</td></tr><tr><td style="text-align:left;">RR</td><td style="text-align:left;">第一次 SELECT 时生成</td></tr></tbody></table><p><strong>这就是为什么 RR 能避免不可重复读：</strong></p><ul><li>RC：每次读都是最新视图，能读到其他事务已提交的数据</li><li>RR：使用同一个视图，看不到后续提交的数据</li></ul><h2 id="日志" tabindex="-1"><a class="header-anchor" href="#日志"><span>日志</span></a></h2><h3 id="redo-log-重做日志" tabindex="-1"><a class="header-anchor" href="#redo-log-重做日志"><span>redo log（重做日志）</span></a></h3><ul><li><strong>作用</strong>：保证事务持久性</li><li><strong>原理</strong>：记录数据页的物理变化</li><li><strong>机制</strong>：WAL（Write-Ahead Logging），先写日志再写磁盘</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>┌──────────┐    ①写入    ┌──────────┐</span></span>
<span class="line"><span>│  事务    │ ──────────→ │ redo log │  ← 顺序写，速度快</span></span>
<span class="line"><span>└──────────┘             └──────────┘</span></span>
<span class="line"><span>                               │</span></span>
<span class="line"><span>                               ↓ ②后台刷盘</span></span>
<span class="line"><span>                         ┌──────────┐</span></span>
<span class="line"><span>                         │ 数据文件  │  ← 随机写，速度慢</span></span>
<span class="line"><span>                         └──────────┘</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="undo-log-回滚日志" tabindex="-1"><a class="header-anchor" href="#undo-log-回滚日志"><span>undo log（回滚日志）</span></a></h3><ul><li><strong>作用</strong>：保证事务原子性，支持 MVCC</li><li><strong>原理</strong>：记录数据修改前的值</li><li><strong>用途</strong>： <ul><li>事务回滚</li><li>MVCC 版本链</li></ul></li></ul><h3 id="binlog-归档日志" tabindex="-1"><a class="header-anchor" href="#binlog-归档日志"><span>binlog（归档日志）</span></a></h3><ul><li><strong>作用</strong>：主从复制、数据恢复</li><li><strong>位置</strong>：Server 层</li><li><strong>格式</strong>： <ul><li>STATEMENT：记录 SQL 语句</li><li>ROW：记录行数据变化</li><li>MIXED：混合模式</li></ul></li></ul><h3 id="两阶段提交" tabindex="-1"><a class="header-anchor" href="#两阶段提交"><span>两阶段提交</span></a></h3><p>确保 redo log 和 binlog 一致：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>1. 写入 redo log（prepare 状态）</span></span>
<span class="line"><span>2. 写入 binlog</span></span>
<span class="line"><span>3. 提交 redo log（commit 状态）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="事务常见问题" tabindex="-1"><a class="header-anchor" href="#事务常见问题"><span>事务常见问题</span></a></h2><h3 id="q1-大事务的危害" tabindex="-1"><a class="header-anchor" href="#q1-大事务的危害"><span>Q1: 大事务的危害？</span></a></h3><ul><li>锁定资源时间长，影响并发</li><li>undo log 膨胀</li><li>主从延迟</li></ul><h3 id="q2-如何避免长事务" tabindex="-1"><a class="header-anchor" href="#q2-如何避免长事务"><span>Q2: 如何避免长事务？</span></a></h3><ul><li>控制事务大小</li><li>避免在事务中做耗时操作</li><li>设置超时时间</li></ul><h3 id="q3-rr-级别下如何解决幻读" tabindex="-1"><a class="header-anchor" href="#q3-rr-级别下如何解决幻读"><span>Q3: RR 级别下如何解决幻读？</span></a></h3><ul><li>快照读：MVCC</li><li>当前读：间隙锁（Next-Key Lock）</li></ul>`,56)])])}const p=i(t,[["render",l]]),c=JSON.parse('{"path":"/tutorials/database/mysql/mysql-transaction.html","title":"MySQL 事务","lang":"zh-CN","frontmatter":{"order":4,"description":"MySQL 事务 事务是一组不可分割的操作，要么全部成功，要么全部失败。 事务操作 示例 ACID 特性 并发问题 脏读 不可重复读 幻读 隔离级别 MySQL 默认隔离级别：Repeatable Read（RR） MVCC MVCC（Multi-Version Concurrency Control）多版本并发控制，用于实现 RC 和 RR 隔离级别...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MySQL 事务\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-12T08:44:14.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"友人\\",\\"url\\":\\"https://www.codermast.com\\",\\"email\\":\\"codermast@163.com\\"}]}"],["meta",{"property":"og:url","content":"https://www.golangclouds.com/tutorials/database/mysql/mysql-transaction.html"}],["meta",{"property":"og:site_name","content":"Golang 全栈指南"}],["meta",{"property":"og:title","content":"MySQL 事务"}],["meta",{"property":"og:description","content":"MySQL 事务 事务是一组不可分割的操作，要么全部成功，要么全部失败。 事务操作 示例 ACID 特性 并发问题 脏读 不可重复读 幻读 隔离级别 MySQL 默认隔离级别：Repeatable Read（RR） MVCC MVCC（Multi-Version Concurrency Control）多版本并发控制，用于实现 RC 和 RR 隔离级别..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-12T08:44:14.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-12T08:44:14.000Z"}]]},"git":{"createdTime":1765529054000,"updatedTime":1765529054000,"contributors":[{"name":"友人","username":"","email":"codermast@qq.com","commits":1}]},"readingTime":{"minutes":3.47,"words":1040},"filePathRelative":"tutorials/database/mysql/mysql-transaction.md","autoDesc":true}');export{p as comp,c as data};
