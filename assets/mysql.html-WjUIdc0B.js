import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,a as l,o as e}from"./app-uhJ6Iyj_.js";const a={};function n(d,t){return e(),i("div",null,[...t[0]||(t[0]=[l(`<h1 id="mysql-面试题" tabindex="-1"><a class="header-anchor" href="#mysql-面试题"><span>MySQL 面试题</span></a></h1><p>MySQL 数据库面试高频考点，覆盖索引、事务、锁、优化、主从复制等核心知识。</p><hr><h2 id="一、索引" tabindex="-1"><a class="header-anchor" href="#一、索引"><span>一、索引</span></a></h2><h3 id="q1-b-tree-为什么比-b-tree-hash-更适合-mysql" tabindex="-1"><a class="header-anchor" href="#q1-b-tree-为什么比-b-tree-hash-更适合-mysql"><span>Q1: B+Tree 为什么比 B-Tree/Hash 更适合 MySQL？</span></a></h3><p><strong>B+Tree vs B-Tree：</strong></p><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">B+Tree</th><th style="text-align:left;">B-Tree</th></tr></thead><tbody><tr><td style="text-align:left;">数据存储</td><td style="text-align:left;">只在叶子节点存数据</td><td style="text-align:left;">所有节点都存数据</td></tr><tr><td style="text-align:left;">叶子节点</td><td style="text-align:left;">有链表串联，支持范围查询</td><td style="text-align:left;">无链表</td></tr><tr><td style="text-align:left;">每页存储</td><td style="text-align:left;">更多 key（因为不存数据）</td><td style="text-align:left;">较少 key</td></tr><tr><td style="text-align:left;">IO 次数</td><td style="text-align:left;">更少（树更矮）</td><td style="text-align:left;">更多</td></tr></tbody></table><p><strong>B+Tree vs Hash：</strong></p><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">B+Tree</th><th style="text-align:left;">Hash</th></tr></thead><tbody><tr><td style="text-align:left;">等值查询</td><td style="text-align:left;">O(logN)</td><td style="text-align:left;">O(1)</td></tr><tr><td style="text-align:left;">范围查询</td><td style="text-align:left;">✅ 支持</td><td style="text-align:left;">❌ 不支持</td></tr><tr><td style="text-align:left;">排序</td><td style="text-align:left;">✅ 支持</td><td style="text-align:left;">❌ 不支持</td></tr><tr><td style="text-align:left;">前缀匹配</td><td style="text-align:left;">✅ 支持</td><td style="text-align:left;">❌ 不支持</td></tr></tbody></table><p><strong>结论：</strong> B+Tree 更适合 OLTP 场景的范围查询和排序需求。</p><hr><h3 id="q2-聚簇索引和二级索引的区别-什么是回表" tabindex="-1"><a class="header-anchor" href="#q2-聚簇索引和二级索引的区别-什么是回表"><span>Q2: 聚簇索引和二级索引的区别？什么是回表？</span></a></h3><p><strong>聚簇索引（Clustered Index）：</strong></p><ul><li>叶子节点存储<strong>完整数据行</strong></li><li>InnoDB 主键索引就是聚簇索引</li><li>每表只有一个</li></ul><p><strong>二级索引（Secondary Index）：</strong></p><ul><li>叶子节点存储<strong>主键值</strong></li><li>非主键索引都是二级索引</li><li>查询完整数据需要<strong>回表</strong></li></ul><p><strong>回表：</strong> 通过二级索引查到主键后，再根据主键去聚簇索引查完整数据。</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 回表查询</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> user </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;Tom&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. 通过 name 索引找到主键 id</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. 通过主键 id 回表查完整数据</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 覆盖索引，无需回表</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> user </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;Tom&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- name 索引已包含 id 和 name，直接返回</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q3-什么是最左前缀法则" tabindex="-1"><a class="header-anchor" href="#q3-什么是最左前缀法则"><span>Q3: 什么是最左前缀法则？</span></a></h3><p><strong>联合索引 (a, b, c) 的最左前缀法则：</strong></p><table><thead><tr><th style="text-align:left;">查询条件</th><th style="text-align:left;">是否使用索引</th></tr></thead><tbody><tr><td style="text-align:left;"><code>a = 1</code></td><td style="text-align:left;">✅</td></tr><tr><td style="text-align:left;"><code>a = 1 AND b = 2</code></td><td style="text-align:left;">✅</td></tr><tr><td style="text-align:left;"><code>a = 1 AND b = 2 AND c = 3</code></td><td style="text-align:left;">✅</td></tr><tr><td style="text-align:left;"><code>b = 2</code></td><td style="text-align:left;">❌ 无法使用</td></tr><tr><td style="text-align:left;"><code>b = 2 AND c = 3</code></td><td style="text-align:left;">❌ 无法使用</td></tr><tr><td style="text-align:left;"><code>a = 1 AND c = 3</code></td><td style="text-align:left;">✅ 只用 a</td></tr></tbody></table><p><strong>范围查询右侧失效：</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 索引 (a, b, c)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> t </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> a </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> b </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> c </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 只能用到 a 和 b，c 无法使用（范围查询后的列失效）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q4-索引失效的常见场景" tabindex="-1"><a class="header-anchor" href="#q4-索引失效的常见场景"><span>Q4: 索引失效的常见场景</span></a></h3><table><thead><tr><th style="text-align:left;">场景</th><th style="text-align:left;">示例</th><th style="text-align:left;">原因</th></tr></thead><tbody><tr><td style="text-align:left;">函数/表达式</td><td style="text-align:left;"><code>WHERE YEAR(date) = 2024</code></td><td style="text-align:left;">索引列被加工</td></tr><tr><td style="text-align:left;">隐式类型转换</td><td style="text-align:left;"><code>WHERE varchar_col = 123</code></td><td style="text-align:left;">字符串列用数字查</td></tr><tr><td style="text-align:left;">左模糊</td><td style="text-align:left;"><code>WHERE name LIKE &#39;%Tom&#39;</code></td><td style="text-align:left;">无法走索引</td></tr><tr><td style="text-align:left;">OR 部分无索引</td><td style="text-align:left;"><code>WHERE a = 1 OR b = 2</code></td><td style="text-align:left;">b 无索引则全表扫</td></tr><tr><td style="text-align:left;">数据分布差</td><td style="text-align:left;">回表代价超过全表扫描</td><td style="text-align:left;">优化器放弃索引</td></tr><tr><td style="text-align:left;">不等于</td><td style="text-align:left;"><code>WHERE status != 1</code></td><td style="text-align:left;">需扫描大部分数据</td></tr></tbody></table><hr><h3 id="q5-如何创建高效的联合索引" tabindex="-1"><a class="header-anchor" href="#q5-如何创建高效的联合索引"><span>Q5: 如何创建高效的联合索引？</span></a></h3><p><strong>选择原则：</strong></p><ol><li><strong>区分度高的列在前</strong></li><li><strong>常用查询条件优先</strong></li><li><strong>考虑排序/分组需求</strong></li><li><strong>尽量覆盖高频查询</strong></li></ol><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询：WHERE user_id = ? AND status = ? ORDER BY created_at</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 推荐索引：(user_id, status, created_at)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 避免冗余索引</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- (a), (a,b), (a,b,c) 只需要 (a,b,c)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="二、事务与-mvcc" tabindex="-1"><a class="header-anchor" href="#二、事务与-mvcc"><span>二、事务与 MVCC</span></a></h2><h3 id="q6-事务的-acid-特性及实现" tabindex="-1"><a class="header-anchor" href="#q6-事务的-acid-特性及实现"><span>Q6: 事务的 ACID 特性及实现</span></a></h3><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">说明</th><th style="text-align:left;">实现机制</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>A</strong> 原子性</td><td style="text-align:left;">全成功或全失败</td><td style="text-align:left;">Undo Log</td></tr><tr><td style="text-align:left;"><strong>C</strong> 一致性</td><td style="text-align:left;">数据状态正确</td><td style="text-align:left;">依赖其他三个特性</td></tr><tr><td style="text-align:left;"><strong>I</strong> 隔离性</td><td style="text-align:left;">事务互不干扰</td><td style="text-align:left;">MVCC + 锁</td></tr><tr><td style="text-align:left;"><strong>D</strong> 持久性</td><td style="text-align:left;">提交后永久保存</td><td style="text-align:left;">Redo Log</td></tr></tbody></table><hr><h3 id="q7-mysql-的四种隔离级别" tabindex="-1"><a class="header-anchor" href="#q7-mysql-的四种隔离级别"><span>Q7: MySQL 的四种隔离级别</span></a></h3><table><thead><tr><th style="text-align:left;">隔离级别</th><th style="text-align:left;">脏读</th><th style="text-align:left;">不可重复读</th><th style="text-align:left;">幻读</th></tr></thead><tbody><tr><td style="text-align:left;">READ UNCOMMITTED</td><td style="text-align:left;">✅</td><td style="text-align:left;">✅</td><td style="text-align:left;">✅</td></tr><tr><td style="text-align:left;">READ COMMITTED (RC)</td><td style="text-align:left;">❌</td><td style="text-align:left;">✅</td><td style="text-align:left;">✅</td></tr><tr><td style="text-align:left;">REPEATABLE READ (RR)</td><td style="text-align:left;">❌</td><td style="text-align:left;">❌</td><td style="text-align:left;">✅*</td></tr><tr><td style="text-align:left;">SERIALIZABLE</td><td style="text-align:left;">❌</td><td style="text-align:left;">❌</td><td style="text-align:left;">❌</td></tr></tbody></table><p><strong>MySQL 默认 RR，通过 MVCC + Next-Key Lock 基本解决幻读。</strong></p><hr><h3 id="q8-谈谈你对-mvcc-的理解-它的实现原理是什么" tabindex="-1"><a class="header-anchor" href="#q8-谈谈你对-mvcc-的理解-它的实现原理是什么"><span>Q8: 谈谈你对 MVCC 的理解？它的实现原理是什么？</span></a></h3><p><strong>MVCC (Multi-Version Concurrency Control)</strong> 多版本并发控制，是 InnoDB 实现隔离级别（尤其是 RC 和 RR）的核心机制。它允许数据库在并发场景下，实现**“非阻塞读”**（快照读），解决了读写冲突问题。</p><h4 id="_1-核心思想" tabindex="-1"><a class="header-anchor" href="#_1-核心思想"><span>1. 核心思想</span></a></h4><p>通过维护数据的历史版本，让读操作不加锁就能读到一致性的数据，从而提高系统的吞吐量。</p><h4 id="_2-三大核心支撑" tabindex="-1"><a class="header-anchor" href="#_2-三大核心支撑"><span>2. 三大核心支撑</span></a></h4><p>MVCC 的实现依赖于：<strong>隐藏字段、Undo Log 版本链、ReadView</strong>。</p><ul><li><strong>隐藏字段</strong>：每行数据除了真实数据外，还有几个隐藏列： <ul><li><code>DB_TRX_ID</code>：最近修改该行数据的<strong>事务 ID</strong>。</li><li><code>DB_ROLL_PTR</code>：回滚指针，指向该行数据上一个版本的 <strong>Undo Log</strong> 地址。</li><li><code>DB_ROW_ID</code>：隐式主键（如果没有显式主键）。</li></ul></li><li><strong>Undo Log 版本链</strong>：<br> 当事务修改数据时，老版本数据会被写入 Undo Log，并通过隐藏列的 <code>roll_ptr</code> 把这些记录串联起来，形成一个<strong>版本链</strong>。</li><li><strong>ReadView (一致性视图)</strong>：<br> 事务进行“快照读”时产生的一个快照，包含 4 个核心属性： <ul><li><code>m_ids</code>：生成 ReadView 时，当前系统中<strong>活跃且未提交</strong>的事务 ID 列表。</li><li><code>min_trx_id</code>：<code>m_ids</code> 中的最小值。</li><li><code>max_trx_id</code>：生成 ReadView 时系统应该分配给下一个事务的 ID（即当前最大事务 ID + 1）。</li><li><code>creator_trx_id</code>：生成该 ReadView 的当前事务 ID。</li></ul></li></ul><h4 id="_3-数据可见性算法-重点" tabindex="-1"><a class="header-anchor" href="#_3-数据可见性算法-重点"><span>3. 数据可见性算法（重点）</span></a></h4><p>当事务读取数据时，会拿到版本链中某个版本的 <code>trx_id</code>，并与 ReadView 进行对比：</p><ol><li><strong>等于 <code>creator_trx_id</code></strong>：说明是自己改的，<strong>可见</strong>。</li><li><strong>小于 <code>min_trx_id</code></strong>：说明该版本事务在视图生成前已提交，<strong>可见</strong>。</li><li><strong>大于等于 <code>max_trx_id</code></strong>：说明该版本事务在视图生成后才开启，<strong>不可见</strong>。</li><li><strong>在 <code>min_trx_id</code> 和 <code>max_trx_id</code> 之间</strong>： <ul><li>如果在 <code>m_ids</code> 中：说明该版本事务还未提交，<strong>不可见</strong>。</li><li>如果不在 <code>m_ids</code> 中：说明该版本事务已提交，<strong>可见</strong>。</li></ul></li></ol><h4 id="_4-rc-和-rr-的区别" tabindex="-1"><a class="header-anchor" href="#_4-rc-和-rr-的区别"><span>4. RC 和 RR 的区别</span></a></h4><p>MVCC 在不同隔离级别下的表现差异主要体现在 <strong>ReadView 的生成时机</strong>：</p><ul><li><strong>RC (Read Committed)</strong>：<strong>每次执行 SELECT</strong> 都会重新生成一个新的 ReadView。所以能读到别的事务刚提交的数据。</li><li><strong>RR (Repeatable Read)</strong>：<strong>仅在事务第一次执行 SELECT</strong> 时生成一个 ReadView，后续所有的快照读都复用这一个。所以保证了同一个事务内多次读取结果一致。</li></ul><p><strong>总结：</strong> MVCC 让事务在不加锁的情况下实现了安全、高效的读取，是 MySQL 处理高并发读写请求的“杀手锏”。</p><hr><h3 id="q9-redo-log-和-binlog-的两阶段提交" tabindex="-1"><a class="header-anchor" href="#q9-redo-log-和-binlog-的两阶段提交"><span>Q9: Redo Log 和 Binlog 的两阶段提交</span></a></h3><p><strong>为什么需要两阶段提交？</strong></p><p>保证 Redo Log 和 Binlog 的一致性。</p><p><strong>流程：</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>1. 写入 Redo Log（prepare 状态）</span></span>
<span class="line"><span>2. 写入 Binlog</span></span>
<span class="line"><span>3. 提交事务，Redo Log 改为 commit 状态</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>崩溃恢复：</strong></p><ul><li>Redo Log 是 prepare，Binlog 无记录 → 回滚</li><li>Redo Log 是 prepare，Binlog 有记录 → 提交</li></ul><hr><h2 id="三、锁" tabindex="-1"><a class="header-anchor" href="#三、锁"><span>三、锁</span></a></h2><h3 id="q10-innodb-的锁类型" tabindex="-1"><a class="header-anchor" href="#q10-innodb-的锁类型"><span>Q10: InnoDB 的锁类型</span></a></h3><p><strong>按粒度分：</strong></p><table><thead><tr><th style="text-align:left;">锁类型</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">全局锁</td><td style="text-align:left;"><code>FLUSH TABLES WITH READ LOCK</code></td></tr><tr><td style="text-align:left;">表锁</td><td style="text-align:left;">MDL 锁、意向锁</td></tr><tr><td style="text-align:left;">行锁</td><td style="text-align:left;">Record Lock、Gap Lock、Next-Key Lock</td></tr></tbody></table><p><strong>行锁类型：</strong></p><table><thead><tr><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th><th style="text-align:left;">解决问题</th></tr></thead><tbody><tr><td style="text-align:left;">Record Lock</td><td style="text-align:left;">锁定单行</td><td style="text-align:left;">解决脏读、不可重复读</td></tr><tr><td style="text-align:left;">Gap Lock</td><td style="text-align:left;">锁定间隙</td><td style="text-align:left;">解决幻读</td></tr><tr><td style="text-align:left;">Next-Key Lock</td><td style="text-align:left;">Record + Gap</td><td style="text-align:left;">InnoDB 默认</td></tr></tbody></table><hr><h3 id="q11-什么情况会产生间隙锁" tabindex="-1"><a class="header-anchor" href="#q11-什么情况会产生间隙锁"><span>Q11: 什么情况会产生间隙锁？</span></a></h3><p><strong>RR 隔离级别下：</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 假设 id 有 1, 5, 10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 等值查询（不存在）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> t </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FOR</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> UPDATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 锁住间隙 (1, 5)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 范围查询</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> t </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FOR</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> UPDATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 锁住间隙 (1, 5] 和 (5, 10)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>间隙锁的问题：</strong> 可能导致死锁，降低并发。</p><hr><h3 id="q12-如何排查和解决死锁" tabindex="-1"><a class="header-anchor" href="#q12-如何排查和解决死锁"><span>Q12: 如何排查和解决死锁</span></a></h3><p><strong>排查方法：</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查看最近死锁</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">SHOW ENGINE INNODB </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">STATUS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\\G</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启死锁日志</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> GLOBAL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> innodb_print_all_deadlocks </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>解决策略：</strong></p><ol><li>按固定顺序访问表/行</li><li>减小事务粒度</li><li>使用索引避免全表扫描</li><li>设置锁等待超时 <code>innodb_lock_wait_timeout</code></li></ol><hr><h2 id="四、sql-优化" tabindex="-1"><a class="header-anchor" href="#四、sql-优化"><span>四、SQL 优化</span></a></h2><h3 id="q13-explain-关键字段解读" tabindex="-1"><a class="header-anchor" href="#q13-explain-关键字段解读"><span>Q13: EXPLAIN 关键字段解读</span></a></h3><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">说明</th><th style="text-align:left;">关键值</th></tr></thead><tbody><tr><td style="text-align:left;">type</td><td style="text-align:left;">访问类型</td><td style="text-align:left;">const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL</td></tr><tr><td style="text-align:left;">key</td><td style="text-align:left;">实际使用的索引</td><td style="text-align:left;">NULL 表示未使用索引</td></tr><tr><td style="text-align:left;">rows</td><td style="text-align:left;">预估扫描行数</td><td style="text-align:left;">越少越好</td></tr><tr><td style="text-align:left;">Extra</td><td style="text-align:left;">额外信息</td><td style="text-align:left;">Using index（好）/ Using filesort（注意）</td></tr></tbody></table><p><strong>type 值解释：</strong></p><ul><li><strong>const</strong>：主键/唯一索引等值查询</li><li><strong>eq_ref</strong>：关联查询，唯一索引匹配</li><li><strong>ref</strong>：普通索引等值查询</li><li><strong>range</strong>：范围查询</li><li><strong>ALL</strong>：全表扫描（需优化）</li></ul><hr><h3 id="q14-慢查询如何排查" tabindex="-1"><a class="header-anchor" href="#q14-慢查询如何排查"><span>Q14: 慢查询如何排查</span></a></h3><p><strong>开启慢查询日志：</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> GLOBAL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> slow_query_log </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> GLOBAL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> long_query_time </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 超过 2 秒记录</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>分析工具：</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 官方工具</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqldumpslow</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> t</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slow.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Percona 工具（推荐）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pt-query-digest</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slow.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>优化步骤：</strong></p><ol><li>开启慢查询日志</li><li>找出 Top N 慢 SQL</li><li>EXPLAIN 分析执行计划</li><li>添加/优化索引</li><li>重写 SQL 或调整业务</li></ol><hr><h3 id="q15-分页查询如何优化" tabindex="-1"><a class="header-anchor" href="#q15-分页查询如何优化"><span>Q15: 分页查询如何优化</span></a></h3><p><strong>问题：</strong> <code>LIMIT 100000, 10</code> 需要扫描 100010 行</p><p><strong>优化方案：</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 原始 SQL</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> orders </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">LIMIT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 优化 1：子查询</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> orders</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> orders </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">LIMIT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">LIMIT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 优化 2：游标分页（推荐）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> orders </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 上次最大ID </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">LIMIT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="五、复制与高可用" tabindex="-1"><a class="header-anchor" href="#五、复制与高可用"><span>五、复制与高可用</span></a></h2><h3 id="q16-主从复制的原理" tabindex="-1"><a class="header-anchor" href="#q16-主从复制的原理"><span>Q16: 主从复制的原理</span></a></h3><p><strong>流程：</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>1. Master 写入 Binlog</span></span>
<span class="line"><span>2. Slave IO 线程拉取 Binlog</span></span>
<span class="line"><span>3. Slave 写入 Relay Log</span></span>
<span class="line"><span>4. Slave SQL 线程重放 Relay Log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>复制模式：</strong></p><table><thead><tr><th style="text-align:left;">模式</th><th style="text-align:left;">说明</th><th style="text-align:left;">特点</th></tr></thead><tbody><tr><td style="text-align:left;">异步</td><td style="text-align:left;">Master 不等 Slave</td><td style="text-align:left;">性能好，可能丢数据</td></tr><tr><td style="text-align:left;">半同步</td><td style="text-align:left;">至少一个 Slave 确认</td><td style="text-align:left;">折中方案</td></tr><tr><td style="text-align:left;">全同步</td><td style="text-align:left;">所有 Slave 确认</td><td style="text-align:left;">强一致，性能差</td></tr></tbody></table><hr><h3 id="q17-主从延迟的原因和解决方案" tabindex="-1"><a class="header-anchor" href="#q17-主从延迟的原因和解决方案"><span>Q17: 主从延迟的原因和解决方案</span></a></h3><p><strong>原因：</strong></p><ol><li>大事务执行慢</li><li>从库机器性能差</li><li>单线程回放（MySQL 5.6 前）</li><li>网络延迟</li></ol><p><strong>解决方案：</strong></p><ol><li>拆分大事务</li><li>开启并行复制 <code>slave_parallel_workers</code></li><li>提升从库配置</li><li>关键读操作强制走主库</li></ol><hr><h3 id="q18-分库分表的时机和策略" tabindex="-1"><a class="header-anchor" href="#q18-分库分表的时机和策略"><span>Q18: 分库分表的时机和策略</span></a></h3><p><strong>触发条件：</strong></p><ul><li>单表超过 2000 万行</li><li>表大小超过 2GB</li><li>QPS 超过单实例瓶颈</li></ul><p><strong>分表策略：</strong></p><table><thead><tr><th style="text-align:left;">策略</th><th style="text-align:left;">说明</th><th style="text-align:left;">适用场景</th></tr></thead><tbody><tr><td style="text-align:left;">Hash</td><td style="text-align:left;">按 key 取模</td><td style="text-align:left;">数据均匀分布</td></tr><tr><td style="text-align:left;">Range</td><td style="text-align:left;">按范围划分</td><td style="text-align:left;">时间序列数据</td></tr><tr><td style="text-align:left;">一致性哈希</td><td style="text-align:left;">减少扩容迁移</td><td style="text-align:left;">动态扩容场景</td></tr></tbody></table><p><strong>代价：</strong></p><ul><li>跨分片查询复杂</li><li>分布式事务</li><li>唯一 ID 生成</li></ul><hr><h2 id="六、更多八股文" tabindex="-1"><a class="header-anchor" href="#六、更多八股文"><span>六、更多八股文</span></a></h2><h3 id="q19-mysql-的三大日志" tabindex="-1"><a class="header-anchor" href="#q19-mysql-的三大日志"><span>Q19: MySQL 的三大日志</span></a></h3><table><thead><tr><th style="text-align:left;">日志</th><th style="text-align:left;">作用</th><th style="text-align:left;">层级</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>binlog</strong></td><td style="text-align:left;">归档日志，主从复制</td><td style="text-align:left;">Server 层</td></tr><tr><td style="text-align:left;"><strong>redo log</strong></td><td style="text-align:left;">崩溃恢复，保证持久性</td><td style="text-align:left;">InnoDB 存储引擎层</td></tr><tr><td style="text-align:left;"><strong>undo log</strong></td><td style="text-align:left;">事务回滚，MVCC</td><td style="text-align:left;">InnoDB 存储引擎层</td></tr></tbody></table><p><strong>redo log vs binlog：</strong></p><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">redo log</th><th style="text-align:left;">binlog</th></tr></thead><tbody><tr><td style="text-align:left;">写入方式</td><td style="text-align:left;">循环写，固定大小</td><td style="text-align:left;">追加写，归档</td></tr><tr><td style="text-align:left;">内容</td><td style="text-align:left;">物理日志（页修改）</td><td style="text-align:left;">逻辑日志（SQL 语句）</td></tr><tr><td style="text-align:left;">用途</td><td style="text-align:left;">崩溃恢复</td><td style="text-align:left;">复制、恢复</td></tr></tbody></table><hr><h3 id="q20-buffer-pool-的作用" tabindex="-1"><a class="header-anchor" href="#q20-buffer-pool-的作用"><span>Q20: Buffer Pool 的作用</span></a></h3><p><strong>作用：</strong> 缓存数据页和索引页，减少磁盘 IO</p><p><strong>组成：</strong></p><ul><li><strong>数据页</strong>：缓存表数据</li><li><strong>索引页</strong>：缓存索引</li><li><strong>Change Buffer</strong>：缓存二级索引修改</li><li><strong>自适应哈希索引</strong>：热点数据索引</li></ul><p><strong>淘汰策略：</strong> 改进的 LRU，分为新生代和老年代</p><hr><h3 id="q21-change-buffer-的作用" tabindex="-1"><a class="header-anchor" href="#q21-change-buffer-的作用"><span>Q21: Change Buffer 的作用</span></a></h3><p><strong>作用：</strong> 缓存二级索引的写操作，减少随机 IO</p><p><strong>条件：</strong></p><ul><li>只对二级索引生效</li><li>索引不是唯一索引（唯一索引需要判断重复）</li></ul><p><strong>合并时机：</strong></p><ul><li>访问该数据页时</li><li>后台线程定期合并</li><li>数据库关闭时</li></ul><hr><h3 id="q22-innodb-和-myisam-的区别" tabindex="-1"><a class="header-anchor" href="#q22-innodb-和-myisam-的区别"><span>Q22: InnoDB 和 MyISAM 的区别</span></a></h3><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">InnoDB</th><th style="text-align:left;">MyISAM</th></tr></thead><tbody><tr><td style="text-align:left;">事务</td><td style="text-align:left;">✅</td><td style="text-align:left;">❌</td></tr><tr><td style="text-align:left;">行锁</td><td style="text-align:left;">✅</td><td style="text-align:left;">❌（只有表锁）</td></tr><tr><td style="text-align:left;">外键</td><td style="text-align:left;">✅</td><td style="text-align:left;">❌</td></tr><tr><td style="text-align:left;">崩溃恢复</td><td style="text-align:left;">✅</td><td style="text-align:left;">❌</td></tr><tr><td style="text-align:left;">全文索引</td><td style="text-align:left;">✅（MySQL 5.6+）</td><td style="text-align:left;">✅</td></tr><tr><td style="text-align:left;">存储文件</td><td style="text-align:left;">.ibd</td><td style="text-align:left;">.MYD + .MYI</td></tr></tbody></table><hr><h3 id="q23-大表优化方案" tabindex="-1"><a class="header-anchor" href="#q23-大表优化方案"><span>Q23: 大表优化方案</span></a></h3><table><thead><tr><th style="text-align:left;">方案</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>分区表</strong></td><td style="text-align:left;">按时间/范围分区</td></tr><tr><td style="text-align:left;"><strong>归档冷数据</strong></td><td style="text-align:left;">历史数据迁移</td></tr><tr><td style="text-align:left;"><strong>分库分表</strong></td><td style="text-align:left;">水平/垂直拆分</td></tr><tr><td style="text-align:left;"><strong>读写分离</strong></td><td style="text-align:left;">主写从读</td></tr><tr><td style="text-align:left;"><strong>索引优化</strong></td><td style="text-align:left;">添加合适索引</td></tr><tr><td style="text-align:left;"><strong>SQL 优化</strong></td><td style="text-align:left;">避免全表扫描</td></tr></tbody></table><hr><h3 id="q24-如何优化-count" tabindex="-1"><a class="header-anchor" href="#q24-如何优化-count"><span>Q24: 如何优化 COUNT(*)</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 慢：全表扫描</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> COUNT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(*) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> orders;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 优化方案：</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. 使用二级索引（比主键索引小）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> COUNT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(*) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> orders </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FORCE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(idx_status);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. 维护计数表</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. 估算值（information_schema.TABLES）</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. Redis 缓存计数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q25-什么是当前读和快照读" tabindex="-1"><a class="header-anchor" href="#q25-什么是当前读和快照读"><span>Q25: 什么是当前读和快照读</span></a></h3><table><thead><tr><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th><th style="text-align:left;">示例</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>快照读</strong></td><td style="text-align:left;">读取历史版本，通过 MVCC</td><td style="text-align:left;">普通 SELECT</td></tr><tr><td style="text-align:left;"><strong>当前读</strong></td><td style="text-align:left;">读取最新数据，加锁</td><td style="text-align:left;">SELECT ... FOR UPDATE</td></tr></tbody></table><hr><h3 id="q26-mysql-锁等待排查" tabindex="-1"><a class="header-anchor" href="#q26-mysql-锁等待排查"><span>Q26: MySQL 锁等待排查</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查看锁等待</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> information_schema</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">INNODB_LOCK_WAITS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查看事务</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> information_schema</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">INNODB_TRX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查看锁</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> performance_schema</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">data_locks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 杀死阻塞事务</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">KILL</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">thread_id</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="七、高频考点清单" tabindex="-1"><a class="header-anchor" href="#七、高频考点清单"><span>七、高频考点清单</span></a></h2><h3 id="必考" tabindex="-1"><a class="header-anchor" href="#必考"><span>必考</span></a></h3><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-0" disabled="disabled"><label class="task-list-item-label" for="task-item-0"> B+Tree 优势、聚簇索引 vs 二级索引</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-1" disabled="disabled"><label class="task-list-item-label" for="task-item-1"> 最左前缀法则、索引失效场景</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-2" disabled="disabled"><label class="task-list-item-label" for="task-item-2"> MVCC 实现、Read View 时机</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-3" disabled="disabled"><label class="task-list-item-label" for="task-item-3"> Record Lock / Gap Lock / Next-Key Lock</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-4" disabled="disabled"><label class="task-list-item-label" for="task-item-4"> Redo Log / Binlog 两阶段提交</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-5" disabled="disabled"><label class="task-list-item-label" for="task-item-5"> EXPLAIN 关键字段含义</label></li></ul><h3 id="常考" tabindex="-1"><a class="header-anchor" href="#常考"><span>常考</span></a></h3><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-6" disabled="disabled"><label class="task-list-item-label" for="task-item-6"> 事务 ACID 实现</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-7" disabled="disabled"><label class="task-list-item-label" for="task-item-7"> 隔离级别与并发问题</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-8" disabled="disabled"><label class="task-list-item-label" for="task-item-8"> 慢查询排查流程</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-9" disabled="disabled"><label class="task-list-item-label" for="task-item-9"> 分页优化</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-10" disabled="disabled"><label class="task-list-item-label" for="task-item-10"> 死锁排查</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-11" disabled="disabled"><label class="task-list-item-label" for="task-item-11"> 三大日志的作用</label></li></ul><h3 id="进阶" tabindex="-1"><a class="header-anchor" href="#进阶"><span>进阶</span></a></h3><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-12" disabled="disabled"><label class="task-list-item-label" for="task-item-12"> 主从复制原理</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-13" disabled="disabled"><label class="task-list-item-label" for="task-item-13"> 半同步复制</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-14" disabled="disabled"><label class="task-list-item-label" for="task-item-14"> 分库分表策略</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-15" disabled="disabled"><label class="task-list-item-label" for="task-item-15"> 主从延迟解决方案</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-16" disabled="disabled"><label class="task-list-item-label" for="task-item-16"> Buffer Pool 原理</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-17" disabled="disabled"><label class="task-list-item-label" for="task-item-17"> InnoDB vs MyISAM</label></li></ul>`,163)])])}const k=s(a,[["render",n]]),p=JSON.parse('{"path":"/interview/mysql.html","title":"MySQL 面试题","lang":"zh-CN","frontmatter":{"order":3,"icon":"logos:mysql","description":"MySQL 面试题 MySQL 数据库面试高频考点，覆盖索引、事务、锁、优化、主从复制等核心知识。 一、索引 Q1: B+Tree 为什么比 B-Tree/Hash 更适合 MySQL？ B+Tree vs B-Tree： B+Tree vs Hash： 结论： B+Tree 更适合 OLTP 场景的范围查询和排序需求。 Q2: 聚簇索引和二级索引的区...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MySQL 面试题\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-30T10:10:44.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"友人\\",\\"url\\":\\"https://www.codermast.com\\",\\"email\\":\\"codermast@163.com\\"}]}"],["meta",{"property":"og:url","content":"https://www.golangclouds.com/interview/mysql.html"}],["meta",{"property":"og:site_name","content":"Golang 全栈指南"}],["meta",{"property":"og:title","content":"MySQL 面试题"}],["meta",{"property":"og:description","content":"MySQL 面试题 MySQL 数据库面试高频考点，覆盖索引、事务、锁、优化、主从复制等核心知识。 一、索引 Q1: B+Tree 为什么比 B-Tree/Hash 更适合 MySQL？ B+Tree vs B-Tree： B+Tree vs Hash： 结论： B+Tree 更适合 OLTP 场景的范围查询和排序需求。 Q2: 聚簇索引和二级索引的区..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-30T10:10:44.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-30T10:10:44.000Z"}]]},"git":{"createdTime":1765529054000,"updatedTime":1767089444000,"contributors":[{"name":"友人","username":"","email":"codermast@qq.com","commits":3}]},"readingTime":{"minutes":10.17,"words":3050},"filePathRelative":"interview/mysql.md","autoDesc":true}');export{k as comp,p as data};
