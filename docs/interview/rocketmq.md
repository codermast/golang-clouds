---
order: 5
icon: simple-icons:apache
---

# RocketMQ 面试题

消息模型、顺序/延迟/事务消息、重试与堆积、存储与高可用。

## 基础与模型

- 架构组件：Producer、Consumer、NameServer、Broker（CommitLog、ConsumeQueue、IndexFile）。
- 消息模型：主题 Topic、队列 Queue、Tag/Key；集群消费 vs 广播消费区别？
- 消息路由：NameServer 元数据、Producer 负载均衡策略（轮询/最小延迟等）。

## 可靠性与重试

- 至少一次/最多一次/恰好一次？RocketMQ 默认“至少一次”。
- 消费重试：`RECONSUME_LATER`，死信队列（DLQ）触发条件，最大重试次数配置？
- 发送重试：同步发送失败重试、异步回调重试；如何避免重复消费？（幂等/唯一键/去重表）。

## 顺序消息

- 全局顺序 vs 分区顺序；如何保证分区顺序？（同一业务键映射同一队列）。
- 消费端顺序保证：`MessageListenerOrderly`，消费超时/异常导致的队列锁转移。

## 延迟与定时

- 延迟等级（固定 18 级）机制；RocketMQ 5 支持任意时间延迟（定时消息），实现原理简述。

## 事务消息

- 事务消息流程：半消息（Prepare）→本地事务回查→Commit/Rollback。
- 回查触发条件？常见回查失败处理？
- 与本地事务一致性保证：本地事务要幂等、可查询。

## 存储与性能

- CommitLog 追加写 + PageCache + 顺序刷盘（同步/异步）；为什么顺序写快？
- ConsumeQueue/IndexFile 作用？
- 消息堆积处理：扩容消费实例、提高并发、批量拉取、升级机器；长时间堆积的风险（过期、落盘）。
- 写刷盘策略：同步刷盘（可靠） vs 异步刷盘（性能）。
- 高可用：主从同步复制、Dledger（RAFT）区别？同步/异步复制导致的数据一致性差异。

## 安全与限流

- 鉴权与 ACL 基本使用；限流/降级思路（速率限制、线程池隔离、拒绝策略）。

## 高频清单

- [ ] 至少一次语义与幂等处理
- [ ] 消费重试与 DLQ 机制
- [ ] 顺序消息实现与队列选择
- [ ] 事务消息流程与回查条件
- [ ] CommitLog/ConsumeQueue/IndexFile 作用
- [ ] 同步/异步刷盘与同步/异步复制区别
- [ ] 延迟消息实现与等级
- [ ] 堆积处理策略
