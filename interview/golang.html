<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.26" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.99" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Golang é¢è¯•é¢˜","image":[""],"dateModified":"2025-12-30T10:10:44.000Z","author":[{"@type":"Person","name":"Golang Clouds","url":"https://www.golangclouds.com","email":"codermast@163.com"}]}</script><meta property="og:url" content="https://www.golangclouds.com/interview/golang.html"><meta property="og:site_name" content="Golang Clouds"><meta property="og:title" content="Golang é¢è¯•é¢˜"><meta property="og:description" content="Golang é¢è¯•é¢˜ Go è¯­è¨€é¢è¯•é«˜é¢‘è€ƒç‚¹ï¼Œè¦†ç›–åŸºç¡€è¯­æ³•ã€æ•°æ®ç»“æ„ã€å¹¶å‘ç¼–ç¨‹ã€å†…å­˜ç®¡ç†ã€GCã€è°ƒåº¦å™¨ç­‰æ ¸å¿ƒçŸ¥è¯†ã€‚ ä¸€ã€åŸºç¡€è¯­æ³• Q1: Go æœ‰å“ªäº›åŸºæœ¬æ•°æ®ç±»å‹ï¼Ÿ æ³¨æ„ï¼šint çš„å¤§å°å–å†³äºæ“ä½œç³»ç»Ÿï¼ˆ32ä½ç³»ç»Ÿæ˜¯int32ï¼Œ64ä½æ˜¯int64ï¼‰ã€‚ Q2: Goä¸­newå’Œmakeçš„åŒºåˆ« Q3: Goçš„deferåŸç†æ˜¯ä»€ä¹ˆ defer ç‰¹ç‚¹ï¼š å»¶è¿Ÿæ‰§è¡Œï¼š..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-12-30T10:10:44.000Z"><meta property="article:modified_time" content="2025-12-30T10:10:44.000Z"><meta name="keywords" content="Golang,Goè¯­è¨€,äº‘åŸç”Ÿ,Docker,Kubernetes,å¾®æœåŠ¡,MySQL,Redis,gRPC"><meta name="baidu-site-verification" content="codeva-GfqTd2Cs0w"><script><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"JWxCHZQ6MtnZPBkF",ck:"JWxCHZQ6MtnZPBkF"})</script></script><link rel="icon" href="/favicon.ico"><title>Golang é¢è¯•é¢˜ | Golang Clouds</title><meta name="description" content="Golang é¢è¯•é¢˜ Go è¯­è¨€é¢è¯•é«˜é¢‘è€ƒç‚¹ï¼Œè¦†ç›–åŸºç¡€è¯­æ³•ã€æ•°æ®ç»“æ„ã€å¹¶å‘ç¼–ç¨‹ã€å†…å­˜ç®¡ç†ã€GCã€è°ƒåº¦å™¨ç­‰æ ¸å¿ƒçŸ¥è¯†ã€‚ ä¸€ã€åŸºç¡€è¯­æ³• Q1: Go æœ‰å“ªäº›åŸºæœ¬æ•°æ®ç±»å‹ï¼Ÿ æ³¨æ„ï¼šint çš„å¤§å°å–å†³äºæ“ä½œç³»ç»Ÿï¼ˆ32ä½ç³»ç»Ÿæ˜¯int32ï¼Œ64ä½æ˜¯int64ï¼‰ã€‚ Q2: Goä¸­newå’Œmakeçš„åŒºåˆ« Q3: Goçš„deferåŸç†æ˜¯ä»€ä¹ˆ defer ç‰¹ç‚¹ï¼š å»¶è¿Ÿæ‰§è¡Œï¼š...">
    <link rel="preload" href="/assets/style-CHot2ts4.css" as="style"><link rel="stylesheet" href="/assets/style-CHot2ts4.css">
    <link rel="modulepreload" href="/assets/app-EbySI1sk.js"><link rel="modulepreload" href="/assets/golang.html-DgUSaLa5.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-B-hE6zum.js" as="script"><link rel="prefetch" href="/assets/index.html-C7iZ7lVH.js" as="script"><link rel="prefetch" href="/assets/index.html-Dh91QzcW.js" as="script"><link rel="prefetch" href="/assets/basic.html-B3wagl8s.js" as="script"><link rel="prefetch" href="/assets/k8s.html-BhVF038j.js" as="script"><link rel="prefetch" href="/assets/mysql.html-DObslR3X.js" as="script"><link rel="prefetch" href="/assets/index.html-DTTvjOmo.js" as="script"><link rel="prefetch" href="/assets/redis.html-CSA4pGur.js" as="script"><link rel="prefetch" href="/assets/rocketmq.html-Cw7os7cC.js" as="script"><link rel="prefetch" href="/assets/java.html-ES4Ospcc.js" as="script"><link rel="prefetch" href="/assets/index.html-81zMZ9G7.js" as="script"><link rel="prefetch" href="/assets/index.html-ct5qveEz.js" as="script"><link rel="prefetch" href="/assets/index.html-GtU0Ha1r.js" as="script"><link rel="prefetch" href="/assets/index.html-CWhxJzb9.js" as="script"><link rel="prefetch" href="/assets/concurrency.html-CVeS_gmL.js" as="script"><link rel="prefetch" href="/assets/gc.html-BUjdeIxf.js" as="script"><link rel="prefetch" href="/assets/gmp.html-Dg1xA478.js" as="script"><link rel="prefetch" href="/assets/go-concurrency.html-C5begucB.js" as="script"><link rel="prefetch" href="/assets/memory.html-Bsyn6-ab.js" as="script"><link rel="prefetch" href="/assets/profiling.html-3n1oOlMx.js" as="script"><link rel="prefetch" href="/assets/index.html-BenhHHSN.js" as="script"><link rel="prefetch" href="/assets/grpc.html-BzSBoceE.js" as="script"><link rel="prefetch" href="/assets/microservice.html-C_s8UtRL.js" as="script"><link rel="prefetch" href="/assets/mq.html-FM0Y_Cs5.js" as="script"><link rel="prefetch" href="/assets/index.html-DvjfYIhg.js" as="script"><link rel="prefetch" href="/assets/redis.html-BP0FfGsl.js" as="script"><link rel="prefetch" href="/assets/go-basic.html-BMAkWdCt.js" as="script"><link rel="prefetch" href="/assets/go-composite.html-QxebWs82.js" as="script"><link rel="prefetch" href="/assets/go-control.html-BsIW1q7W.js" as="script"><link rel="prefetch" href="/assets/go-error.html-CQk7pvIg.js" as="script"><link rel="prefetch" href="/assets/go-function.html-DsBEruSu.js" as="script"><link rel="prefetch" href="/assets/go-install.html--d9f-LRc.js" as="script"><link rel="prefetch" href="/assets/go-interface.html-BtMa7wAi.js" as="script"><link rel="prefetch" href="/assets/go-module.html-B_Qe93_r.js" as="script"><link rel="prefetch" href="/assets/index.html-DtTjn_og.js" as="script"><link rel="prefetch" href="/assets/config.html-CKAo51nZ.js" as="script"><link rel="prefetch" href="/assets/docker.html-Cdjp9cGJ.js" as="script"><link rel="prefetch" href="/assets/kubernetes.html-NltUjnoq.js" as="script"><link rel="prefetch" href="/assets/logging.html-Bm7HRNxC.js" as="script"><link rel="prefetch" href="/assets/index.html-BC8kaeGw.js" as="script"><link rel="prefetch" href="/assets/testing.html-bhHXxgCw.js" as="script"><link rel="prefetch" href="/assets/bufio.html-DJDYtByE.js" as="script"><link rel="prefetch" href="/assets/container.html-8Pc9MIwh.js" as="script"><link rel="prefetch" href="/assets/crypto.html--y_HFekE.js" as="script"><link rel="prefetch" href="/assets/encoding-csv.html-BLUNaW2y.js" as="script"><link rel="prefetch" href="/assets/encoding-json.html-OrJhO94u.js" as="script"><link rel="prefetch" href="/assets/encoding-xml.html-BjHSjp4c.js" as="script"><link rel="prefetch" href="/assets/flag.html-A8nKiLy_.js" as="script"><link rel="prefetch" href="/assets/fmt.html-BexNsLDB.js" as="script"><link rel="prefetch" href="/assets/http.html-DU7ew1T_.js" as="script"><link rel="prefetch" href="/assets/io.html-DR0QPdTf.js" as="script"><link rel="prefetch" href="/assets/log.html-Cq4wvIg-.js" as="script"><link rel="prefetch" href="/assets/math.html-Du4TnJEt.js" as="script"><link rel="prefetch" href="/assets/net.html-C24liuJ5.js" as="script"><link rel="prefetch" href="/assets/os.html-CkRvlyn0.js" as="script"><link rel="prefetch" href="/assets/index.html-C6T7hIBf.js" as="script"><link rel="prefetch" href="/assets/sort.html-BrHLk5EW.js" as="script"><link rel="prefetch" href="/assets/strconv.html-C88RE3pI.js" as="script"><link rel="prefetch" href="/assets/time.html-BwTu2D-P.js" as="script"><link rel="prefetch" href="/assets/index.html-B8XBP8M9.js" as="script"><link rel="prefetch" href="/assets/index.html-CW7xeUVx.js" as="script"><link rel="prefetch" href="/assets/homebrew.html-BBxXHx_7.js" as="script"><link rel="prefetch" href="/assets/index.html-DKJgA8Ml.js" as="script"><link rel="prefetch" href="/assets/index.html-COMy89Pf.js" as="script"><link rel="prefetch" href="/assets/index.html-tVoSFUAE.js" as="script"><link rel="prefetch" href="/assets/index.html-DEKBAfVR.js" as="script"><link rel="prefetch" href="/assets/BackEnd-Dev-Build.html-BZHRPziS.js" as="script"><link rel="prefetch" href="/assets/Database-Dev-Build.html-CJjAN7fi.js" as="script"><link rel="prefetch" href="/assets/FrontEnd-Dev-Build.html-Cxa_uYTl.js" as="script"><link rel="prefetch" href="/assets/index.html-CGsS8B8V.js" as="script"><link rel="prefetch" href="/assets/index.html-JRWpPZ1N.js" as="script"><link rel="prefetch" href="/assets/index.html-BEBZu80C.js" as="script"><link rel="prefetch" href="/assets/mq-comparison.html-CATCI62I.js" as="script"><link rel="prefetch" href="/assets/index.html-DuSoGW99.js" as="script"><link rel="prefetch" href="/assets/error.html-5HmeH3Ct.js" as="script"><link rel="prefetch" href="/assets/file.html-zOR9mCu9.js" as="script"><link rel="prefetch" href="/assets/middleware.html-B0dEnIo7.js" as="script"><link rel="prefetch" href="/assets/quickstart.html-5PXlqRpG.js" as="script"><link rel="prefetch" href="/assets/request.html-tLAFOmzK.js" as="script"><link rel="prefetch" href="/assets/response.html-Cav5bcsd.js" as="script"><link rel="prefetch" href="/assets/router.html-ocxZmIav.js" as="script"><link rel="prefetch" href="/assets/validation.html-dR1DP7sO.js" as="script"><link rel="prefetch" href="/assets/association.html-cLC3h-e6.js" as="script"><link rel="prefetch" href="/assets/crud.html-CB8-PTRE.js" as="script"><link rel="prefetch" href="/assets/model.html-XulBFBTH.js" as="script"><link rel="prefetch" href="/assets/performance.html-CNr_C8kf.js" as="script"><link rel="prefetch" href="/assets/query.html-ekJjOJwz.js" as="script"><link rel="prefetch" href="/assets/quickstart.html-BVZZ0Qvg.js" as="script"><link rel="prefetch" href="/assets/transaction.html-5qv37r0_.js" as="script"><link rel="prefetch" href="/assets/index.html-Dldxkmuq.js" as="script"><link rel="prefetch" href="/assets/git-basic-operations.html-BylMOkeo.js" as="script"><link rel="prefetch" href="/assets/git-branch-manage.html-DyCdhwcm.js" as="script"><link rel="prefetch" href="/assets/git-content-operations.html-CewpnqAb.js" as="script"><link rel="prefetch" href="/assets/git-introduce-install.html-HDNcN-ts.js" as="script"><link rel="prefetch" href="/assets/git-remote-manage.html-B3QZlw6S.js" as="script"><link rel="prefetch" href="/assets/git-workspace-index-repo.html-iuCi_hJI.js" as="script"><link rel="prefetch" href="/assets/index.html-BwTsJGpV.js" as="script"><link rel="prefetch" href="/assets/index.html-C_AJwi6x.js" as="script"><link rel="prefetch" href="/assets/shortcuts.html-CHLQ8_JP.js" as="script"><link rel="prefetch" href="/assets/introduce-install-config.html-DLvDeOeT.js" as="script"><link rel="prefetch" href="/assets/index.html-BtFnj-sv.js" as="script"><link rel="prefetch" href="/assets/basic-knowledge.html-DntqLkhe.js" as="script"><link rel="prefetch" href="/assets/component-communication.html-DFlhmE_Q.js" as="script"><link rel="prefetch" href="/assets/computed.html-AP0M4cTN.js" as="script"><link rel="prefetch" href="/assets/create-vue-project.html-Bc8iNKPk.js" as="script"><link rel="prefetch" href="/assets/life-cycle.html-DFPRRCRl.js" as="script"><link rel="prefetch" href="/assets/other-api.html-D9F06bno.js" as="script"><link rel="prefetch" href="/assets/pinia.html-D2Jf15SF.js" as="script"><link rel="prefetch" href="/assets/index.html-BfP2ecPx.js" as="script"><link rel="prefetch" href="/assets/router.html-DwWbNSnK.js" as="script"><link rel="prefetch" href="/assets/template-grammar.html-C3Szcl3M.js" as="script"><link rel="prefetch" href="/assets/vue3-new-component.html-CARAAvGW.js" as="script"><link rel="prefetch" href="/assets/watch.html-BG_hnwT1.js" as="script"><link rel="prefetch" href="/assets/annotation.html-DRVHA_8e.js" as="script"><link rel="prefetch" href="/assets/basic-grammar.html-BwI2y2mJ.js" as="script"><link rel="prefetch" href="/assets/class-and-object.html-ErDmbU84.js" as="script"><link rel="prefetch" href="/assets/common-classes.html-Cxy54otp.js" as="script"><link rel="prefetch" href="/assets/exception.html-DJspTSTm.js" as="script"><link rel="prefetch" href="/assets/generics.html-C99Z9crq.js" as="script"><link rel="prefetch" href="/assets/jdk-env-path.html-D_MIl-qr.js" as="script"><link rel="prefetch" href="/assets/index.html-CUI8r4SA.js" as="script"><link rel="prefetch" href="/assets/reflection.html-jc80YJQt.js" as="script"><link rel="prefetch" href="/assets/string.html-kn5tA6y_.js" as="script"><link rel="prefetch" href="/assets/list-arraylist.html-uCKUGZh4.js" as="script"><link rel="prefetch" href="/assets/list-linkedlist.html-BtLT-2Cm.js" as="script"><link rel="prefetch" href="/assets/list-stack.html-Dggys2yJ.js" as="script"><link rel="prefetch" href="/assets/list-vectore.html-CVdnR6Uk.js" as="script"><link rel="prefetch" href="/assets/map-hashmap.html-C5_trWpR.js" as="script"><link rel="prefetch" href="/assets/map-linkedhashmap.html-3poevIBO.js" as="script"><link rel="prefetch" href="/assets/map-treemap.html-BNAsCXix.js" as="script"><link rel="prefetch" href="/assets/queue-deque.html-D5nZE6rC.js" as="script"><link rel="prefetch" href="/assets/queue-queue.html-DWaPgDLQ.js" as="script"><link rel="prefetch" href="/assets/index.html-Blhh6fQB.js" as="script"><link rel="prefetch" href="/assets/set-hashset.html-CHa1ce14.js" as="script"><link rel="prefetch" href="/assets/set-linkedhashset.html-DeH9ywqw.js" as="script"><link rel="prefetch" href="/assets/set-treeset.html-BfIQMHDl.js" as="script"><link rel="prefetch" href="/assets/buffer-stream.html-zLccJNoo.js" as="script"><link rel="prefetch" href="/assets/byte-stream.html-ptreGDTx.js" as="script"><link rel="prefetch" href="/assets/char-stream.html-CUpdYu-U.js" as="script"><link rel="prefetch" href="/assets/file.html-CZh6Dq7N.js" as="script"><link rel="prefetch" href="/assets/io-stream-system.html-CR2ldeyo.js" as="script"><link rel="prefetch" href="/assets/nio.html-SQbtE4Cz.js" as="script"><link rel="prefetch" href="/assets/index.html-DDGABTps.js" as="script"><link rel="prefetch" href="/assets/class-loading.html-BLz_DUZ_.js" as="script"><link rel="prefetch" href="/assets/garbage-collection.html-CWuSJDNI.js" as="script"><link rel="prefetch" href="/assets/jvm-memory.html-CRB0_rPj.js" as="script"><link rel="prefetch" href="/assets/jvm-tuning.html-_3JrXSVQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DY2chfJ_.js" as="script"><link rel="prefetch" href="/assets/atomic.html-KQZvMmxO.js" as="script"><link rel="prefetch" href="/assets/completable-future.html-sjwRnkHc.js" as="script"><link rel="prefetch" href="/assets/concurrent-collections.html-BorCQPrY.js" as="script"><link rel="prefetch" href="/assets/concurrent-utils.html-Dj2l3mud.js" as="script"><link rel="prefetch" href="/assets/index.html-ByO7KqT_.js" as="script"><link rel="prefetch" href="/assets/synchronized-lock.html-B8XbXn0F.js" as="script"><link rel="prefetch" href="/assets/thread-basic.html-DCK17hAs.js" as="script"><link rel="prefetch" href="/assets/thread-pool.html-Dkvm0Z5a.js" as="script"><link rel="prefetch" href="/assets/annotations-beans.html-wWmKwdVX.js" as="script"><link rel="prefetch" href="/assets/implement-ioc.html-Dex4EtJm.js" as="script"><link rel="prefetch" href="/assets/introduction-case.html-xmlCH6qF.js" as="script"><link rel="prefetch" href="/assets/index.html-DD38YnHu.js" as="script"><link rel="prefetch" href="/assets/spring-aop.html-MVrAo6y3.js" as="script"><link rel="prefetch" href="/assets/spring-aot.html-Cn6ZG2Tg.js" as="script"><link rel="prefetch" href="/assets/spring-data-validation.html-DYoZ1WFA.js" as="script"><link rel="prefetch" href="/assets/spring-i18n.html-DqTu5-AM.js" as="script"><link rel="prefetch" href="/assets/spring-ioc.html-DDdcnFKn.js" as="script"><link rel="prefetch" href="/assets/spring-junit.html-8-ljknhj.js" as="script"><link rel="prefetch" href="/assets/spring-resources.html-COAnq61Y.js" as="script"><link rel="prefetch" href="/assets/spring-summarize.html-DCg1boGn.js" as="script"><link rel="prefetch" href="/assets/spring-transaction.html-DdCVquqd.js" as="script"><link rel="prefetch" href="/assets/xml-beans.html-rr8YjzZk.js" as="script"><link rel="prefetch" href="/assets/index.html-CpPBQ71n.js" as="script"><link rel="prefetch" href="/assets/springboot-config.html-Bclump8C.js" as="script"><link rel="prefetch" href="/assets/springboot-data.html-CiJKfIW2.js" as="script"><link rel="prefetch" href="/assets/springboot-quickstart.html-DGBxdHhM.js" as="script"><link rel="prefetch" href="/assets/springboot-web.html-DeK18Dl8.js" as="script"><link rel="prefetch" href="/assets/index.html-KMoAh-eA.js" as="script"><link rel="prefetch" href="/assets/springcloud-config.html-BrnVVr15.js" as="script"><link rel="prefetch" href="/assets/springcloud-discovery.html-DdIySoOS.js" as="script"><link rel="prefetch" href="/assets/springcloud-feign.html-C_bpdIy9.js" as="script"><link rel="prefetch" href="/assets/springcloud-gateway.html-0MkoAkOI.js" as="script"><link rel="prefetch" href="/assets/springcloud-introduction.html-BZWEBBFS.js" as="script"><link rel="prefetch" href="/assets/springcloud-sentinel.html-poQcnisV.js" as="script"><link rel="prefetch" href="/assets/index.html-BdH_OCm9.js" as="script"><link rel="prefetch" href="/assets/springmvc-databind.html-C5bkIdKX.js" as="script"><link rel="prefetch" href="/assets/springmvc-exception.html-BG-Vp1AI.js" as="script"><link rel="prefetch" href="/assets/springmvc-interceptor.html-DgVWak_-.js" as="script"><link rel="prefetch" href="/assets/springmvc-introduction.html-CpgKIbuo.js" as="script"><link rel="prefetch" href="/assets/springmvc-request.html-WftjOweV.js" as="script"><link rel="prefetch" href="/assets/springmvc-response.html-BAfHafrz.js" as="script"><link rel="prefetch" href="/assets/mysql-architecture.html-Ocb0IXv3.js" as="script"><link rel="prefetch" href="/assets/mysql-index.html-ML-qkdYp.js" as="script"><link rel="prefetch" href="/assets/mysql-lock.html-BcpD7PzT.js" as="script"><link rel="prefetch" href="/assets/mysql-optimize.html-DrxiL7m7.js" as="script"><link rel="prefetch" href="/assets/mysql-transaction.html-0mV6eTIR.js" as="script"><link rel="prefetch" href="/assets/index.html-B3oFI8X7.js" as="script"><link rel="prefetch" href="/assets/sql-advanced.html-K4AGLWuc.js" as="script"><link rel="prefetch" href="/assets/sql-basic.html-B0TpExHX.js" as="script"><link rel="prefetch" href="/assets/index.html-ClYDh5uA.js" as="script"><link rel="prefetch" href="/assets/redis-advanced.html-DQSJuetx.js" as="script"><link rel="prefetch" href="/assets/redis-basic.html-BqdoXtVq.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-6novQJAP.js" as="script"><link rel="prefetch" href="/assets/redis-datatype.html-DOzRlhWk.js" as="script"><link rel="prefetch" href="/assets/redis-optimize.html-CZGoDtje.js" as="script"><link rel="prefetch" href="/assets/redis-persistence.html-BkuLbV2e.js" as="script"><link rel="prefetch" href="/assets/redis-principle.html-CzF2LqSV.js" as="script"><link rel="prefetch" href="/assets/index.html-D-1lwTJm.js" as="script"><link rel="prefetch" href="/assets/docker-basic.html-DY3xo6wg.js" as="script"><link rel="prefetch" href="/assets/docker-compose.html-B9KFn4nG.js" as="script"><link rel="prefetch" href="/assets/docker-container-connection.html-DWiIv1DT.js" as="script"><link rel="prefetch" href="/assets/docker-dockerfile.html-DN83clK9.js" as="script"><link rel="prefetch" href="/assets/docker-helloworld.html-FNk7sGqr.js" as="script"><link rel="prefetch" href="/assets/docker-install.html-BsG54mZ0.js" as="script"><link rel="prefetch" href="/assets/docker-introduce.html-CfbKMhHy.js" as="script"><link rel="prefetch" href="/assets/docker-object.html-DgreyIJE.js" as="script"><link rel="prefetch" href="/assets/docker-warehouse.html-CU86Z0cI.js" as="script"><link rel="prefetch" href="/assets/docker-web-containers.html-CkYEZYtF.js" as="script"><link rel="prefetch" href="/assets/index.html-ChPsYAPU.js" as="script"><link rel="prefetch" href="/assets/k8s-config.html-rcYd8YLL.js" as="script"><link rel="prefetch" href="/assets/k8s-helm.html-B31HzbrP.js" as="script"><link rel="prefetch" href="/assets/k8s-install.html-CYv9XvTy.js" as="script"><link rel="prefetch" href="/assets/k8s-introduction.html-PNKSv1wD.js" as="script"><link rel="prefetch" href="/assets/k8s-kubectl.html-fr-TOZn7.js" as="script"><link rel="prefetch" href="/assets/k8s-monitoring.html-BVUGha7j.js" as="script"><link rel="prefetch" href="/assets/k8s-network-security.html-biO4Ngi_.js" as="script"><link rel="prefetch" href="/assets/k8s-service.html-BkERp4BV.js" as="script"><link rel="prefetch" href="/assets/k8s-storage.html-DxHCrQxs.js" as="script"><link rel="prefetch" href="/assets/k8s-workload.html-C6uLObL-.js" as="script"><link rel="prefetch" href="/assets/index.html-BXqRTVi5.js" as="script"><link rel="prefetch" href="/assets/linux-bash.html-xIZVviQ2.js" as="script"><link rel="prefetch" href="/assets/linux-file-directory.html-CobCvNuc.js" as="script"><link rel="prefetch" href="/assets/linux-network.html-CeRtrIgT.js" as="script"><link rel="prefetch" href="/assets/linux-package.html-BeyKhFdu.js" as="script"><link rel="prefetch" href="/assets/linux-process.html-DmBZo-l8.js" as="script"><link rel="prefetch" href="/assets/linux-scripts.html-DeIC__Eq.js" as="script"><link rel="prefetch" href="/assets/linux-service.html-BX2h4t_5.js" as="script"><link rel="prefetch" href="/assets/linux-user-permission.html-C6VYS3i0.js" as="script"><link rel="prefetch" href="/assets/index.html-f5PEY07t.js" as="script"><link rel="prefetch" href="/assets/nginx-https.html-DSQd65ky.js" as="script"><link rel="prefetch" href="/assets/nginx-install.html-DffFzKLW.js" as="script"><link rel="prefetch" href="/assets/nginx-loadbalance.html-C02jw2qJ.js" as="script"><link rel="prefetch" href="/assets/nginx-optimization.html-B67tG4gf.js" as="script"><link rel="prefetch" href="/assets/nginx-proxy.html-ConsRV61.js" as="script"><link rel="prefetch" href="/assets/nginx-static.html-y0vXanMw.js" as="script"><link rel="prefetch" href="/assets/nginx-vhost.html-5ITouQdq.js" as="script"><link rel="prefetch" href="/assets/index.html-Bkw0sgWQ.js" as="script"><link rel="prefetch" href="/assets/kafka-introduction.html-Btzt9q7S.js" as="script"><link rel="prefetch" href="/assets/kafka-producer-consumer.html-CMtTdG4L.js" as="script"><link rel="prefetch" href="/assets/kafka-springboot.html-CVqMiIB2.js" as="script"><link rel="prefetch" href="/assets/index.html-C5pkXMEq.js" as="script"><link rel="prefetch" href="/assets/rabbitmq-exchange.html-D2qcrAc8.js" as="script"><link rel="prefetch" href="/assets/rabbitmq-introduction.html-DJj3Vq8b.js" as="script"><link rel="prefetch" href="/assets/rabbitmq-reliability.html-8xZZzg5G.js" as="script"><link rel="prefetch" href="/assets/rabbitmq-springboot.html-DFnPHUaw.js" as="script"><link rel="prefetch" href="/assets/index.html-CoZOccLg.js" as="script"><link rel="prefetch" href="/assets/index.html-CbujApCN.js" as="script"><link rel="prefetch" href="/assets/rocketmq-introduction.html-BWvtNbNy.js" as="script"><link rel="prefetch" href="/assets/rocketmq-message-type.html-Wsji18Ju.js" as="script"><link rel="prefetch" href="/assets/rocketmq-springboot.html-BG12fNOB.js" as="script"><link rel="prefetch" href="/assets/observer-pattern.html-BOMyTMoC.js" as="script"><link rel="prefetch" href="/assets/index.html-CkmMnPkb.js" as="script"><link rel="prefetch" href="/assets/factory-pattern.html-DXsW4ze7.js" as="script"><link rel="prefetch" href="/assets/index.html-SKq7oD0k.js" as="script"><link rel="prefetch" href="/assets/singleton-pattern.html-ziR0eK_S.js" as="script"><link rel="prefetch" href="/assets/adapter-pattern.html-DW02utgv.js" as="script"><link rel="prefetch" href="/assets/index.html-D_8Fojg7.js" as="script"><link rel="prefetch" href="/assets/404.html-B9GWBzRy.js" as="script"><link rel="prefetch" href="/assets/index.html-Ck3549NZ.js" as="script"><link rel="prefetch" href="/assets/index.html-BynXmaVM.js" as="script"><link rel="prefetch" href="/assets/index.html-caHQ4f8Y.js" as="script"><link rel="prefetch" href="/assets/auto-fmlfkwi0.js" as="script"><link rel="prefetch" href="/assets/index-DXW7qb_O.js" as="script"><link rel="prefetch" href="/assets/flowchart-G1WAoCnn.js" as="script"><link rel="prefetch" href="/assets/mermaid.esm.min-e4BBkz3V.js" as="script"><link rel="prefetch" href="/assets/vue-repl-D7Z8LdHL.js" as="script"><link rel="prefetch" href="/assets/codemirror-editor-CgBd5qps.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-IL6PhzrQ.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-CSCL3NJe.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-CJk6ev8u.js" as="script"><link rel="prefetch" href="/assets/math.esm-BmZXia10.js" as="script"><link rel="prefetch" href="/assets/search.esm-D94zHP-f.js" as="script"><link rel="prefetch" href="/assets/notes.esm-CrtRLS_3.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-u92KjI0g.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-CKV1Bsxh.js" as="script"><link rel="prefetch" href="/assets/dash.all.min-D41k4F20.js" as="script"><link rel="prefetch" href="/assets/mpegts-H7cYUIum.js" as="script"><link rel="prefetch" href="/assets/hls.min-rf4GZgM1.js" as="script"><link rel="prefetch" href="/assets/artplayer-D5a8s37K.js" as="script"><link rel="prefetch" href="/assets/browser-CgTUrs9U.js" as="script"><link rel="prefetch" href="/assets/vidstack-player-CeUGw3IK.js" as="script"><link rel="prefetch" href="/assets/hls.min-rf4GZgM1.js" as="script"><link rel="prefetch" href="/assets/dash.all.min-D41k4F20.js" as="script"><link rel="prefetch" href="/assets/giscus-ifyzM6xw.js" as="script"><link rel="prefetch" href="/assets/SearchResult-DQIDpmA8.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/" aria-label="å¸¦æˆ‘å›å®¶"><img class="vp-nav-logo" src="/logo.png" alt><!----><span class="vp-site-name hide-in-pad">Golang Clouds</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="GolangæŒ‡å—"><!--[--><iconify-icon class="vp-icon" icon="grommet-icons:golang" sizing="height" height="1em"></iconify-icon>GolangæŒ‡å—<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">è¯­æ³•æ ¸å¿ƒ</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/golang/core/" aria-label="æ ¸å¿ƒåŸºç¡€"><!--[--><iconify-icon class="vp-icon" icon="solar:crown-star-bold" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->æ ¸å¿ƒåŸºç¡€<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/golang/advanced/" aria-label="è¿›é˜¶ç‰¹æ€§"><!--[--><iconify-icon class="vp-icon" icon="ic:outline-sync-lock" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->è¿›é˜¶ç‰¹æ€§<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/golang/engineering/" aria-label="å·¥ç¨‹åŒ–"><!--[--><iconify-icon class="vp-icon" icon="carbon:build-tool" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->å·¥ç¨‹åŒ–<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/golang/distributed/" aria-label="åˆ†å¸ƒå¼"><!--[--><iconify-icon class="vp-icon" icon="zondicons:network" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->åˆ†å¸ƒå¼<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">Webå¼€å‘</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/golang/web/gin/" aria-label="Ginæ¡†æ¶"><!--[--><iconify-icon class="vp-icon" icon="simple-icons:lightning" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Ginæ¡†æ¶<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/golang/web/gorm/" aria-label="GORM"><!--[--><iconify-icon class="vp-icon" icon="mdi:database" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->GORM<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">ç¤¾åŒºç”Ÿæ€</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/golang/stdlib/" aria-label="æ ‡å‡†åº“"><!--[--><iconify-icon class="vp-icon" icon="majesticons:library" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->æ ‡å‡†åº“<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="åç«¯æŠ€æœ¯"><!--[--><iconify-icon class="vp-icon" icon="mingcute:code-fill" sizing="height" height="1em"></iconify-icon>åç«¯æŠ€æœ¯<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ•°æ®åº“</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/tutorials/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="vp-icon" icon="tabler:brand-mysql" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/tutorials/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="vp-icon" icon="cib:redis" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ¶ˆæ¯é˜Ÿåˆ—</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/tutorials/mq/kafka/" aria-label="Kafka"><!--[--><iconify-icon class="vp-icon" icon="logos:kafka-icon" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Kafka<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/tutorials/mq/rabbitmq/" aria-label="RabbitMQ"><!--[--><iconify-icon class="vp-icon" icon="simple-icons:rabbitmq" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->RabbitMQ<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/tutorials/mq/rocketmq/" aria-label="RocketMQ"><!--[--><iconify-icon class="vp-icon" icon="simple-icons:apacherocketmq" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->RocketMQ<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">äº‘åŸç”Ÿ</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/tutorials/cloud/docker/" aria-label="Docker"><!--[--><iconify-icon class="vp-icon" icon="mdi:docker" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/tutorials/cloud/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="vp-icon" icon="mdi:kubernetes" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/tutorials/cloud/linux/" aria-label="Linux"><!--[--><iconify-icon class="vp-icon" icon="mingcute:linux-fill" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="é¢è¯•å®å…¸"><!--[--><iconify-icon class="vp-icon" icon="icon-park-solid:tips" sizing="height" height="1em"></iconify-icon>é¢è¯•å®å…¸<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/interview/golang.html" aria-label="Golang"><!--[--><iconify-icon class="vp-icon" icon="logos:go" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/interview/mysql.html" aria-label="MySQL"><!--[--><iconify-icon class="vp-icon" icon="simple-icons:mysql" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/interview/redis.html" aria-label="Redis"><!--[--><iconify-icon class="vp-icon" icon="cib:redis" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/interview/rocketmq.html" aria-label="RocketMQ"><!--[--><iconify-icon class="vp-icon" icon="simple-icons:apacherocketmq" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->RocketMQ<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/interview/k8s.html" aria-label="Kubernetes"><!--[--><iconify-icon class="vp-icon" icon="mdi:kubernetes" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/project/" aria-label="é¡¹ç›®å®æˆ˜"><!--[--><iconify-icon class="vp-icon" icon="ant-design:project-filled" sizing="height" height="1em"></iconify-icon><!--]-->é¡¹ç›®å®æˆ˜<!----></a></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/codermast/codermast-notes" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="slimsearch-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="slimsearch-placeholder">æœç´¢</div><div class="slimsearch-key-hints"><kbd class="slimsearch-key">Ctrl</kbd><kbd class="slimsearch-key">K</kbd></div></button><!--]--><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/interview/golang.html" aria-label="Golang é¢è¯•é¢˜"><!--[--><iconify-icon class="vp-icon" icon="logos:go" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Golang é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/interview/mysql.html" aria-label="MySQL é¢è¯•é¢˜"><!--[--><iconify-icon class="vp-icon" icon="logos:mysql" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->MySQL é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/interview/redis.html" aria-label="Redis é¢è¯•é¢˜"><!--[--><iconify-icon class="vp-icon" icon="logos:redis" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Redis é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/interview/rocketmq.html" aria-label="RocketMQ é¢è¯•é¢˜"><!--[--><iconify-icon class="vp-icon" icon="simple-icons:apacherocketmq" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->RocketMQ é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/interview/k8s.html" aria-label="Kubernetes é¢è¯•é¢˜"><!--[--><iconify-icon class="vp-icon" icon="simple-icons:kubernetes" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/interview/basic.html" aria-label="è®¡ç®—æœºåŸºç¡€é¢ç»"><!--[--><iconify-icon class="vp-icon" icon="icon-park-outline:computer" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->è®¡ç®—æœºåŸºç¡€é¢ç»<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="vp-icon" icon="logos:go" sizing="height" height="1em"></iconify-icon>Golang é¢è¯•é¢˜</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://www.golangclouds.com" target="_blank" rel="noopener noreferrer">Golang Clouds</a></span><span property="author" content="Golang Clouds"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2025/12/12</span><meta property="datePublished" content="2025-12-12T08:44:14.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 28 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT28M"></span><!----><!----></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="golang-é¢è¯•é¢˜" tabindex="-1"><a class="header-anchor" href="#golang-é¢è¯•é¢˜"><span>Golang é¢è¯•é¢˜</span></a></h1><p>Go è¯­è¨€é¢è¯•é«˜é¢‘è€ƒç‚¹ï¼Œè¦†ç›–åŸºç¡€è¯­æ³•ã€æ•°æ®ç»“æ„ã€å¹¶å‘ç¼–ç¨‹ã€å†…å­˜ç®¡ç†ã€GCã€è°ƒåº¦å™¨ç­‰æ ¸å¿ƒçŸ¥è¯†ã€‚</p><hr><h2 id="ä¸€ã€åŸºç¡€è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€åŸºç¡€è¯­æ³•"><span>ä¸€ã€åŸºç¡€è¯­æ³•</span></a></h2><h3 id="q1-go-æœ‰å“ªäº›åŸºæœ¬æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#q1-go-æœ‰å“ªäº›åŸºæœ¬æ•°æ®ç±»å‹"><span>Q1: Go æœ‰å“ªäº›åŸºæœ¬æ•°æ®ç±»å‹ï¼Ÿ</span></a></h3><table><thead><tr><th style="text-align:left;">åˆ†ç±»</th><th style="text-align:left;">ç±»å‹</th></tr></thead><tbody><tr><td style="text-align:left;">å¸ƒå°”</td><td style="text-align:left;"><code>bool</code></td></tr><tr><td style="text-align:left;">æ•´å‹</td><td style="text-align:left;"><code>int</code>, <code>int8</code>, <code>int16</code>, <code>int32</code>, <code>int64</code></td></tr><tr><td style="text-align:left;">æ— ç¬¦å·</td><td style="text-align:left;"><code>uint</code>, <code>uint8</code>, <code>uint16</code>, <code>uint32</code>, <code>uint64</code>, <code>uintptr</code></td></tr><tr><td style="text-align:left;">æµ®ç‚¹</td><td style="text-align:left;"><code>float32</code>, <code>float64</code></td></tr><tr><td style="text-align:left;">å¤æ•°</td><td style="text-align:left;"><code>complex64</code>, <code>complex128</code></td></tr><tr><td style="text-align:left;">å­—ç¬¦ä¸²</td><td style="text-align:left;"><code>string</code></td></tr><tr><td style="text-align:left;">å­—ç¬¦</td><td style="text-align:left;"><code>byte</code> (uint8), <code>rune</code> (int32)</td></tr></tbody></table><blockquote><p><strong>æ³¨æ„</strong>ï¼š<code>int</code> çš„å¤§å°å–å†³äºæ“ä½œç³»ç»Ÿï¼ˆ32ä½ç³»ç»Ÿæ˜¯int32ï¼Œ64ä½æ˜¯int64ï¼‰ã€‚</p></blockquote><hr><h3 id="q2-goä¸­newå’Œmakeçš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#q2-goä¸­newå’Œmakeçš„åŒºåˆ«"><span>Q2: Goä¸­newå’Œmakeçš„åŒºåˆ«</span></a></h3><table><thead><tr><th style="text-align:left;">ç‰¹æ€§</th><th style="text-align:left;">new</th><th style="text-align:left;">make</th></tr></thead><tbody><tr><td style="text-align:left;">è¿”å›ç±»å‹</td><td style="text-align:left;">è¿”å›æŒ‡é’ˆ <code>*T</code></td><td style="text-align:left;">è¿”å›å€¼ <code>T</code></td></tr><tr><td style="text-align:left;">åˆå§‹åŒ–</td><td style="text-align:left;">é›¶å€¼</td><td style="text-align:left;">åˆå§‹åŒ–å†…éƒ¨ç»“æ„</td></tr><tr><td style="text-align:left;">é€‚ç”¨ç±»å‹</td><td style="text-align:left;">æ‰€æœ‰ç±»å‹</td><td style="text-align:left;">sliceã€mapã€channel</td></tr></tbody></table><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// new - åˆ†é…å†…å­˜ï¼Œè¿”å›æŒ‡é’ˆï¼Œé›¶å€¼åˆå§‹åŒ–</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> new</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)       </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// *intï¼Œå€¼ä¸º 0</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">s</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> new</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">([]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// *[]intï¼Œå€¼ä¸º nil</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// make - åˆ†é…å¹¶åˆå§‹åŒ–å†…éƒ¨ç»“æ„</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">slice</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> make</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">([]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// []intï¼Œå·²åˆå§‹åŒ–</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">m</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> make</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)       </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// mapï¼Œå·²åˆå§‹åŒ–</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ch</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> make</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">chan</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)         </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// chanï¼Œå·²åˆå§‹åŒ–</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q3-goçš„deferåŸç†æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#q3-goçš„deferåŸç†æ˜¯ä»€ä¹ˆ"><span>Q3: Goçš„deferåŸç†æ˜¯ä»€ä¹ˆ</span></a></h3><p><strong>defer ç‰¹ç‚¹ï¼š</strong></p><ol><li><strong>å»¶è¿Ÿæ‰§è¡Œ</strong>ï¼šå‡½æ•°è¿”å›å‰æ‰§è¡Œ</li><li><strong>LIFO é¡ºåº</strong>ï¼šåè¿›å…ˆå‡ºï¼ˆæ ˆç»“æ„ï¼‰</li><li><strong>å‚æ•°é¢„è®¡ç®—</strong>ï¼šå£°æ˜æ—¶æ±‚å€¼ï¼Œéæ‰§è¡Œæ—¶</li></ol><p><strong>åº•å±‚å®ç°ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> _defer</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    siz</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">     int32</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å‚æ•°å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    started</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> bool</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    sp</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      uintptr</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // æ ˆæŒ‡é’ˆ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    pc</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      uintptr</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // ç¨‹åºè®¡æ•°å™¨</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    fn</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">      *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">funcval</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // å»¶è¿Ÿå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    link</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">    *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">_defer</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // é“¾è¡¨æŒ‡é’ˆ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ‰§è¡Œæ—¶æœºï¼š</strong></p><ol><li>å‡½æ•° return å€¼èµ‹ç»™è¿”å›å˜é‡</li><li>æ‰§è¡Œ defer å‡½æ•°ï¼ˆLIFOï¼‰</li><li>å‡½æ•°è¿”å›</li></ol><p><strong>ç»å…¸é™·é˜±ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æƒ…å†µä¸€ï¼šè¿”å›å€¼æ˜¯åŒ¿åå˜é‡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> f1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    x</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    defer</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">x</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> x</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // è¿”å› 5ï¼ˆx çš„å‰¯æœ¬ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æƒ…å†µäºŒï¼šè¿”å›å€¼æ˜¯å‘½åå˜é‡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> f2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">x</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    defer</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">x</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // è¿”å› 6ï¼ˆdefer ä¿®æ”¹äº†å‘½åè¿”å›å€¼ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q4-goçš„selectå¯ä»¥ç”¨äºä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#q4-goçš„selectå¯ä»¥ç”¨äºä»€ä¹ˆ"><span>Q4: Goçš„selectå¯ä»¥ç”¨äºä»€ä¹ˆ</span></a></h3><p><strong>ç”¨é€”ï¼š</strong></p><ol><li>å¤šè·¯ Channel å¤ç”¨</li><li>è¶…æ—¶æ§åˆ¶</li><li>éé˜»å¡æ“ä½œ</li></ol><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">case</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;-</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ch1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å¤„ç† ch1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">case</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ch2</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;-</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> x</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å‘é€åˆ° ch2</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">case</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;-</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">After</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // è¶…æ—¶å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">default</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // éé˜»å¡ï¼ˆæ‰€æœ‰ case ä¸æ»¡è¶³æ—¶æ‰§è¡Œï¼‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>éšæœºé€‰æ‹©å°±ç»ªçš„ caseï¼ˆé¿å…é¥¥é¥¿ï¼‰</li><li>æ²¡æœ‰ default æ—¶ä¼šé˜»å¡</li><li>case å¿…é¡»æ˜¯ Channel æ“ä½œ</li></ul><hr><h3 id="q5-goå€¼æ¥æ”¶è€…å’ŒæŒ‡é’ˆæ¥æ”¶è€…çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#q5-goå€¼æ¥æ”¶è€…å’ŒæŒ‡é’ˆæ¥æ”¶è€…çš„åŒºåˆ«"><span>Q5: Goå€¼æ¥æ”¶è€…å’ŒæŒ‡é’ˆæ¥æ”¶è€…çš„åŒºåˆ«</span></a></h3><table><thead><tr><th style="text-align:left;">ç‰¹æ€§</th><th style="text-align:left;">å€¼æ¥æ”¶è€…</th><th style="text-align:left;">æŒ‡é’ˆæ¥æ”¶è€…</th></tr></thead><tbody><tr><td style="text-align:left;">è°ƒç”¨æ—¶</td><td style="text-align:left;">å¤åˆ¶æ•´ä¸ªå€¼</td><td style="text-align:left;">åªå¤åˆ¶æŒ‡é’ˆ</td></tr><tr><td style="text-align:left;">ä¿®æ”¹åŸå€¼</td><td style="text-align:left;">ä¸å¯ä»¥</td><td style="text-align:left;">å¯ä»¥</td></tr><tr><td style="text-align:left;">nil æ¥æ”¶è€…</td><td style="text-align:left;">æ— æ³•è°ƒç”¨ï¼ˆpanicï¼‰</td><td style="text-align:left;">å¯ä»¥è°ƒç”¨</td></tr><tr><td style="text-align:left;">æ¥å£å®ç°</td><td style="text-align:left;">T å’Œ *T éƒ½å®ç°</td><td style="text-align:left;">åªæœ‰ *T å®ç°</td></tr></tbody></table><p><strong>é€‰æ‹©å»ºè®®ï¼š</strong></p><ul><li>éœ€è¦ä¿®æ”¹æ¥æ”¶è€… â†’ æŒ‡é’ˆæ¥æ”¶è€…</li><li>å¤§ç»“æ„ä½“ â†’ æŒ‡é’ˆæ¥æ”¶è€…ï¼ˆé¿å…å¤åˆ¶å¼€é”€ï¼‰</li><li>ä¸€è‡´æ€§ â†’ åŒä¸€ç±»å‹ä¿æŒç»Ÿä¸€é£æ ¼</li></ul><hr><h3 id="q6-goçš„structèƒ½ä¸èƒ½æ¯”è¾ƒ" tabindex="-1"><a class="header-anchor" href="#q6-goçš„structèƒ½ä¸èƒ½æ¯”è¾ƒ"><span>Q6: Goçš„Structèƒ½ä¸èƒ½æ¯”è¾ƒ</span></a></h3><p><strong>èƒ½å¦æ¯”è¾ƒå–å†³äºå­—æ®µç±»å‹ï¼š</strong></p><table><thead><tr><th style="text-align:left;">å¯æ¯”è¾ƒç±»å‹</th><th style="text-align:left;">ä¸å¯æ¯”è¾ƒç±»å‹</th></tr></thead><tbody><tr><td style="text-align:left;">åŸºæœ¬ç±»å‹ï¼ˆintã€stringã€boolï¼‰</td><td style="text-align:left;">slice</td></tr><tr><td style="text-align:left;">æŒ‡é’ˆ</td><td style="text-align:left;">map</td></tr><tr><td style="text-align:left;">æ•°ç»„ï¼ˆå…ƒç´ å¯æ¯”è¾ƒï¼‰</td><td style="text-align:left;">function</td></tr><tr><td style="text-align:left;">æ¥å£ï¼ˆåŠ¨æ€ç±»å‹å’Œå€¼éƒ½å¯æ¯”è¾ƒï¼‰</td><td style="text-align:left;">åŒ…å«ä¸å¯æ¯”è¾ƒå­—æ®µçš„ç»“æ„ä½“</td></tr></tbody></table><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Person</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    Name</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> string</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    Age</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  int</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">p1</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Person</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Tom&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">18</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">p2</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Person</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Tom&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">18</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">p1</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> p2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// true âœ…</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Data</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    Values</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> []</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // åŒ…å« slice</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// d1 == d2  // ç¼–è¯‘é”™è¯¯ï¼âŒ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ·±åº¦æ¯”è¾ƒï¼š</strong> ä½¿ç”¨ <code>reflect.DeepEqual()</code></p><hr><h3 id="q7-goå‡½æ•°è¿”å›å±€éƒ¨å˜é‡çš„æŒ‡é’ˆæ˜¯å¦å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#q7-goå‡½æ•°è¿”å›å±€éƒ¨å˜é‡çš„æŒ‡é’ˆæ˜¯å¦å®‰å…¨"><span>Q7: Goå‡½æ•°è¿”å›å±€éƒ¨å˜é‡çš„æŒ‡é’ˆæ˜¯å¦å®‰å…¨</span></a></h3><p><strong>å®‰å…¨ï¼Go çš„é€ƒé€¸åˆ†æä¼šå¤„ç†ã€‚</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    u</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Tom&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// é€ƒé€¸åˆ°å †</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> &amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">u</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">               // å®‰å…¨è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åŸç†ï¼š</strong></p><ul><li>ç¼–è¯‘å™¨è¿›è¡Œé€ƒé€¸åˆ†æ</li><li>éœ€è¦é€ƒé€¸çš„å˜é‡åˆ†é…åœ¨å †ä¸Š</li><li>å †ä¸Šçš„å˜é‡ç”± GC ç®¡ç†</li></ul><hr><h3 id="q8-goä¸­ä¸¤ä¸ªnilå¯èƒ½ä¸ç›¸ç­‰å—" tabindex="-1"><a class="header-anchor" href="#q8-goä¸­ä¸¤ä¸ªnilå¯èƒ½ä¸ç›¸ç­‰å—"><span>Q8: Goä¸­ä¸¤ä¸ªNilå¯èƒ½ä¸ç›¸ç­‰å—</span></a></h3><p><strong>å¯èƒ½ï¼æ¥å£ç±»å‹çš„ nil åˆ¤æ–­æœ‰é™·é˜±ã€‚</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> p</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{} </span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> p</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// false! âŒ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åŸå› ï¼š</strong> æ¥å£ç”± <code>(type, value)</code> ç»„æˆï¼Œåªæœ‰ä¸¤è€…éƒ½ä¸º nil æ‰ç­‰äº nilã€‚</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> eface</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    _type</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">_type</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         // ç±»å‹ï¼š*intï¼ˆé nilï¼‰</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    data</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">  unsafe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Pointer</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // å€¼ï¼šnil</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q9-go-çš„-error-å¤„ç†æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#q9-go-çš„-error-å¤„ç†æœºåˆ¶"><span>Q9: Go çš„ error å¤„ç†æœºåˆ¶</span></a></h3><p><strong>error æ˜¯ä¸€ä¸ªæ¥å£ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> error</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">string</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é”™è¯¯å¤„ç†æ–¹å¼ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 1. ç›´æ¥è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> err</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 2. åŒ…è£…é”™è¯¯ï¼ˆGo 1.13+ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Errorf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;è¯»å–é…ç½®å¤±è´¥: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%w</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 3. é”™è¯¯åˆ¤æ–­</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> errors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Is</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">os</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ErrNotExist</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å¤„ç†æ–‡ä»¶ä¸å­˜åœ¨</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 4. ç±»å‹æ–­è¨€</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> pathErr</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">os</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PathError</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> errors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">As</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pathErr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pathErr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><a href="http://errors.Is" target="_blank" rel="noopener noreferrer">errors.Is</a> vs <a href="http://errors.As" target="_blank" rel="noopener noreferrer">errors.As</a>ï¼š</strong></p><table><thead><tr><th style="text-align:left;">å‡½æ•°</th><th style="text-align:left;">ä½œç”¨</th><th style="text-align:left;">åœºæ™¯</th></tr></thead><tbody><tr><td style="text-align:left;"><code>errors.Is</code></td><td style="text-align:left;">åˆ¤æ–­æ˜¯å¦æ˜¯ç‰¹å®šé”™è¯¯å€¼</td><td style="text-align:left;">sentinel error</td></tr><tr><td style="text-align:left;"><code>errors.As</code></td><td style="text-align:left;">åˆ¤æ–­æ˜¯å¦æ˜¯ç‰¹å®šé”™è¯¯ç±»å‹</td><td style="text-align:left;">è‡ªå®šä¹‰ error ç±»å‹</td></tr></tbody></table><hr><h3 id="q10-å¦‚ä½•è‡ªå®šä¹‰-error" tabindex="-1"><a class="header-anchor" href="#q10-å¦‚ä½•è‡ªå®šä¹‰-error"><span>Q10: å¦‚ä½•è‡ªå®šä¹‰ error</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ–¹æ³•ä¸€ï¼šå®ç° error æ¥å£</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MyError</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    Code</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    Message</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> string</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">e </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MyError</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Sprintf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">] </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Code</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Message</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ–¹æ³•äºŒï¼šä½¿ç”¨ errors.New</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ErrNotFound</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> errors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">New</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;not found&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ fmt.Errorf</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Errorf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;user </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> not found&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">userID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q11-panic-å’Œ-recover-çš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#q11-panic-å’Œ-recover-çš„ä½¿ç”¨"><span>Q11: panic å’Œ recover çš„ä½¿ç”¨</span></a></h3><p><strong>panicï¼š</strong> ç¨‹åºé‡åˆ°æ— æ³•æ¢å¤çš„é”™è¯¯æ—¶ä½¿ç”¨</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è§¦å‘ panic</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">panic</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;something went wrong&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å¸¸è§è§¦å‘åœºæ™¯</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">arr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]          </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ•°ç»„è¶Šç•Œ</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Method</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()      </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// nil æŒ‡é’ˆè°ƒç”¨æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">closedChan</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// é‡å¤å…³é—­ channel</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>recoverï¼š</strong> æ•è· panicï¼Œå¿…é¡»åœ¨ defer ä¸­ä½¿ç”¨</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> safeCall</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    defer</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> r</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> recover</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">r</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Printf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Recovered: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // æ‰“å°å †æ ˆ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            debug</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PrintStack</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å¯èƒ½ panic çš„ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    riskyOperation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q12-panic-å’Œ-error-å¦‚ä½•é€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#q12-panic-å’Œ-error-å¦‚ä½•é€‰æ‹©"><span>Q12: panic å’Œ error å¦‚ä½•é€‰æ‹©</span></a></h3><table><thead><tr><th style="text-align:left;">åœºæ™¯</th><th style="text-align:left;">é€‰æ‹©</th><th style="text-align:left;">åŸå› </th></tr></thead><tbody><tr><td style="text-align:left;">é¢„æœŸå†…çš„é”™è¯¯</td><td style="text-align:left;">error</td><td style="text-align:left;">è°ƒç”¨æ–¹å¯å¤„ç†</td></tr><tr><td style="text-align:left;">ç¼–ç¨‹é”™è¯¯/bug</td><td style="text-align:left;">panic</td><td style="text-align:left;">ä¸åº”è¯¥å‘ç”Ÿ</td></tr><tr><td style="text-align:left;">åˆå§‹åŒ–å¤±è´¥</td><td style="text-align:left;">panic</td><td style="text-align:left;">ç¨‹åºæ— æ³•ç»§ç»­</td></tr><tr><td style="text-align:left;">åº“å‡½æ•°</td><td style="text-align:left;">error</td><td style="text-align:left;">ä¸åº”å¼ºåˆ¶ç»ˆæ­¢ç¨‹åº</td></tr></tbody></table><p><strong>åŸåˆ™ï¼š</strong></p><ul><li><strong>ä¼˜å…ˆç”¨ error</strong>ï¼šGo æ¨èæ˜¾å¼é”™è¯¯å¤„ç†</li><li><strong>panic æ…ç”¨</strong>ï¼šåªç”¨äºçœŸæ­£çš„å¼‚å¸¸æƒ…å†µ</li><li><strong>åº“ä»£ç ä¸è¦ panic</strong>ï¼šè®©è°ƒç”¨æ–¹å†³å®šå¦‚ä½•å¤„ç†</li></ul><hr><h3 id="q13-deferã€panicã€recover-çš„æ‰§è¡Œé¡ºåº" tabindex="-1"><a class="header-anchor" href="#q13-deferã€panicã€recover-çš„æ‰§è¡Œé¡ºåº"><span>Q13: deferã€panicã€recover çš„æ‰§è¡Œé¡ºåº</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    defer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    defer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    defer</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> r</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> recover</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">r</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Recovered:&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    defer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;3&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    panic</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;error!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    defer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;4&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä¸ä¼šæ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼š</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 3</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Recovered: error!</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 2</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ‰§è¡Œæµç¨‹ï¼š</strong></p><ol><li>panic å‘ç”Ÿåï¼Œåœæ­¢æ­£å¸¸æ‰§è¡Œ</li><li>æŒ‰ LIFO é¡ºåºæ‰§è¡Œ defer</li><li>é‡åˆ° recover åˆ™æ•è· panic</li><li>recover åç»­çš„ defer ç»§ç»­æ‰§è¡Œ</li></ol><hr><h2 id="äºŒã€æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#äºŒã€æ•°æ®ç»“æ„"><span>äºŒã€æ•°æ®ç»“æ„</span></a></h2><h3 id="q14-string-åº•å±‚ç»“æ„æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#q14-string-åº•å±‚ç»“æ„æ˜¯ä»€ä¹ˆ"><span>Q14: string åº•å±‚ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> stringStruct</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    str</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> unsafe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Pointer</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // æŒ‡å‘åº•å±‚å­—èŠ‚æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    len</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">             // å­—ç¬¦ä¸²é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>string æ˜¯<strong>ä¸å¯å˜</strong>çš„</li><li><code>len(s)</code> è¿”å›å­—èŠ‚æ•°ï¼Œä¸æ˜¯å­—ç¬¦æ•°</li><li>ä½¿ç”¨ <code>utf8.RuneCountInString(s)</code> è·å–å­—ç¬¦æ•°</li></ul><p><strong>å­—ç¬¦ä¸²æ‹¼æ¥æ€§èƒ½å¯¹æ¯”ï¼š</strong></p><table><thead><tr><th style="text-align:left;">æ–¹å¼</th><th style="text-align:left;">æ€§èƒ½</th><th style="text-align:left;">åœºæ™¯</th></tr></thead><tbody><tr><td style="text-align:left;"><code>+</code></td><td style="text-align:left;">ä½</td><td style="text-align:left;">å°‘é‡æ‹¼æ¥</td></tr><tr><td style="text-align:left;"><code>fmt.Sprintf</code></td><td style="text-align:left;">ä½</td><td style="text-align:left;">æ ¼å¼åŒ–</td></tr><tr><td style="text-align:left;"><code>strings.Builder</code></td><td style="text-align:left;">é«˜</td><td style="text-align:left;">å¤§é‡æ‹¼æ¥ï¼ˆæ¨èï¼‰</td></tr><tr><td style="text-align:left;"><code>bytes.Buffer</code></td><td style="text-align:left;">é«˜</td><td style="text-align:left;">éœ€è¦å­—èŠ‚æ“ä½œ</td></tr></tbody></table><hr><h3 id="q15-slice-åº•å±‚ç»“æ„å’Œæ‰©å®¹æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#q15-slice-åº•å±‚ç»“æ„å’Œæ‰©å®¹æœºåˆ¶"><span>Q15: slice åº•å±‚ç»“æ„å’Œæ‰©å®¹æœºåˆ¶</span></a></h3><p><strong>åº•å±‚ç»“æ„ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> slice</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    array</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> unsafe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Pointer</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // æŒ‡å‘åº•å±‚æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    len</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   int</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">             // å½“å‰é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    cap</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   int</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">             // å®¹é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ‰©å®¹è§„åˆ™ï¼ˆGo 1.18+ï¼‰ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> oldCap</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    newCap</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> oldCap</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // ç¿»å€</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    newCap</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> oldCap</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">oldCap</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> +</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // çº¦ 1.25 å€å¢é•¿</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><ul><li>é¢„åˆ†é…å¯é¿å…æ‰©å®¹ï¼š<code>make([]int, 0, 100)</code></li><li>æ‰©å®¹ååº•å±‚æ•°ç»„å¯èƒ½å˜åŒ–ï¼ŒåŸåˆ‡ç‰‡ä¸å—å½±å“</li></ul><hr><h3 id="q16-goä¸­å¯¹nilçš„sliceå’Œç©ºsliceçš„å¤„ç†æ˜¯ä¸€è‡´çš„å—" tabindex="-1"><a class="header-anchor" href="#q16-goä¸­å¯¹nilçš„sliceå’Œç©ºsliceçš„å¤„ç†æ˜¯ä¸€è‡´çš„å—"><span>Q16: Goä¸­å¯¹nilçš„Sliceå’Œç©ºSliceçš„å¤„ç†æ˜¯ä¸€è‡´çš„å—</span></a></h3><p><strong>ä¸å®Œå…¨ä¸€è‡´ã€‚</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> nilSlice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> []</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          // nil slice: nil, len=0, cap=0</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">emptySlice</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> []</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{}       </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ç©º slice: é nil, len=0, cap=0</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">emptySlice2</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> make</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">([]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ç©º slice: é nil, len=0, cap=0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">æ“ä½œ</th><th style="text-align:left;">nil Slice</th><th style="text-align:left;">ç©º Slice</th></tr></thead><tbody><tr><td style="text-align:left;"><code>len()</code></td><td style="text-align:left;">0</td><td style="text-align:left;">0</td></tr><tr><td style="text-align:left;"><code>cap()</code></td><td style="text-align:left;">0</td><td style="text-align:left;">0</td></tr><tr><td style="text-align:left;"><code>append()</code></td><td style="text-align:left;">æ­£å¸¸</td><td style="text-align:left;">æ­£å¸¸</td></tr><tr><td style="text-align:left;"><code>== nil</code></td><td style="text-align:left;"><strong>true</strong></td><td style="text-align:left;"><strong>false</strong></td></tr><tr><td style="text-align:left;">JSON åºåˆ—åŒ–</td><td style="text-align:left;"><code>null</code></td><td style="text-align:left;"><code>[]</code></td></tr></tbody></table><hr><h3 id="q17-slice-ä½œä¸ºå‚æ•°ä¼ é€’ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#q17-slice-ä½œä¸ºå‚æ•°ä¼ é€’ä¼šå‘ç”Ÿä»€ä¹ˆ"><span>Q17: slice ä½œä¸ºå‚æ•°ä¼ é€’ä¼šå‘ç”Ÿä»€ä¹ˆ</span></a></h3><p>slice æ˜¯<strong>å€¼ä¼ é€’</strong>ï¼Œä½†ä¼ é€’çš„æ˜¯ headerï¼ˆptr, len, capï¼‰ï¼Œåº•å±‚æ•°ç»„å…±äº«ã€‚</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> modify</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> []</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">       // âœ… ä¼šä¿®æ”¹åŸåˆ‡ç‰‡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    s</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> append</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// âŒ ä¸ä¼šå½±å“åŸåˆ‡ç‰‡çš„ len</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¦ä¿®æ”¹åŸåˆ‡ç‰‡çš„é•¿åº¦ï¼Œéœ€è¦ä¼ æŒ‡é’ˆ <code>*[]int</code>ã€‚</p><hr><h3 id="q18-map-çš„åº•å±‚å®ç°" tabindex="-1"><a class="header-anchor" href="#q18-map-çš„åº•å±‚å®ç°"><span>Q18: map çš„åº•å±‚å®ç°</span></a></h3><p><strong>åº•å±‚ç»“æ„ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> hmap</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    count</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">     int</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // å…ƒç´ ä¸ªæ•°</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    B</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">         uint8</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          // bucket æ•°é‡ = 2^B</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    hash0</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">     uint32</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         // å“ˆå¸Œç§å­ï¼ˆéšæœºåŒ–ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    buckets</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">   unsafe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Pointer</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // bucket æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    oldbuckets</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> unsafe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Pointer</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // æ‰©å®¹æ—¶çš„æ—§ bucket</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>bucket ç»“æ„ï¼š</strong></p><ul><li>æ¯ä¸ª bucket å­˜ 8 ä¸ª key-value</li><li>é«˜ 8 ä½å“ˆå¸Œç”¨äºå¿«é€Ÿæ¯”è¾ƒï¼ˆtophashï¼‰</li><li>æº¢å‡º bucket ç”¨é“¾è¡¨å¤„ç†</li></ul><p><strong>æ‰©å®¹æ¡ä»¶ï¼š</strong></p><ol><li>è´Ÿè½½å› å­ &gt; 6.5ï¼ˆç¿»å€æ‰©å®¹ï¼‰</li><li>overflow bucket è¿‡å¤šï¼ˆç­‰é‡æ‰©å®¹ï¼Œæ•´ç†ç¢ç‰‡ï¼‰</li></ol><hr><h3 id="q19-map-ä¸ºä»€ä¹ˆæ˜¯æ— åºçš„" tabindex="-1"><a class="header-anchor" href="#q19-map-ä¸ºä»€ä¹ˆæ˜¯æ— åºçš„"><span>Q19: map ä¸ºä»€ä¹ˆæ˜¯æ— åºçš„</span></a></h3><ol><li><strong>å“ˆå¸Œåˆ†å¸ƒ</strong>ï¼škey æŒ‰å“ˆå¸Œå€¼åˆ†å¸ƒï¼Œä¸æ˜¯æŒ‰æ’å…¥é¡ºåº</li><li><strong>æ‰©å®¹è¿ç§»</strong>ï¼šæ‰©å®¹æ—¶æ•°æ®ä¼šé‡æ–°åˆ†å¸ƒåˆ°æ–° bucket</li><li><strong>æ•…æ„éšæœºåŒ–</strong>ï¼šGo åœ¨éå†æ—¶æ•…æ„åŠ å…¥éšæœºèµ·å§‹ä½ç½®</li></ol><hr><h3 id="q20-map-vs-sync-map-æ·±åº¦å¯¹æ¯”åŠå¢åˆ æ”¹æŸ¥å®ç°ç»†èŠ‚" tabindex="-1"><a class="header-anchor" href="#q20-map-vs-sync-map-æ·±åº¦å¯¹æ¯”åŠå¢åˆ æ”¹æŸ¥å®ç°ç»†èŠ‚"><span>Q20: map vs sync.Map æ·±åº¦å¯¹æ¯”åŠå¢åˆ æ”¹æŸ¥å®ç°ç»†èŠ‚</span></a></h3><h4 id="_1-æ ¸å¿ƒå¯¹æ¯”æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_1-æ ¸å¿ƒå¯¹æ¯”æ€»ç»“"><span>1. æ ¸å¿ƒå¯¹æ¯”æ€»ç»“</span></a></h4><table><thead><tr><th style="text-align:left;">ç‰¹æ€§</th><th style="text-align:left;">map (é…åˆ RWMutex)</th><th style="text-align:left;">sync.Map</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>çº¿ç¨‹å®‰å…¨</strong></td><td style="text-align:left;">ä¸å®‰å…¨ï¼ˆéœ€æ‰‹åŠ¨åŠ é”ï¼‰</td><td style="text-align:left;">å¹¶å‘å®‰å…¨</td></tr><tr><td style="text-align:left;"><strong>é”é¢—ç²’åº¦</strong></td><td style="text-align:left;">æ•´ä¸ª mapï¼ˆå¤§é”ï¼‰ï¼Œç«äº‰æ¿€çƒˆ</td><td style="text-align:left;">è¯»å†™åˆ†ç¦»ï¼Œåªæœ‰ dirty éƒ¨åˆ†åŠ é”ï¼ˆç»†é”ï¼‰</td></tr><tr><td style="text-align:left;"><strong>æ€§èƒ½åœºæ™¯</strong></td><td style="text-align:left;"><strong>å†™æ“ä½œå¤š</strong>ã€é€šç”¨åœºæ™¯</td><td style="text-align:left;"><strong>è¯»å¤šå†™å°‘</strong>ã€Key é›†åˆç¨³å®šã€å¤šæ ¸ç«äº‰</td></tr><tr><td style="text-align:left;"><strong>å†…å­˜å ç”¨</strong></td><td style="text-align:left;">è¾ƒä½</td><td style="text-align:left;">è¾ƒé«˜ï¼ˆç»´æŠ¤ read å’Œ dirty ä¸¤ä¸ª mapï¼‰</td></tr><tr><td style="text-align:left;"><strong>é›¶å€¼å¯ç”¨</strong></td><td style="text-align:left;"><code>make</code> åå¯ç”¨ï¼Œnil map å†™ä¼š panic</td><td style="text-align:left;">ç›´æ¥å£°æ˜å³å¯ä½¿ç”¨ï¼ˆå¼€ç®±å³ç”¨ï¼‰</td></tr></tbody></table><h4 id="_2-map-çš„å¢åˆ æ”¹æŸ¥å®ç°-hmap" tabindex="-1"><a class="header-anchor" href="#_2-map-çš„å¢åˆ æ”¹æŸ¥å®ç°-hmap"><span>2. map çš„å¢åˆ æ”¹æŸ¥å®ç° (hmap)</span></a></h4><p>Go æ ‡å‡† <code>map</code> ä½¿ç”¨å“ˆå¸Œè¡¨å®ç°ï¼Œé‡‡ç”¨ <strong>é“¾åœ°å€æ³•</strong> è§£å†³å†²çªï¼š</p><ul><li><strong>æŸ¥ (Load)</strong>ï¼š <ol><li>è®¡ç®— Key çš„ Hash å€¼ã€‚</li><li>å– Hash ä½ä½å®šä½äºå“ªä¸ª Bucketï¼ˆæ¡¶ï¼‰ã€‚</li><li>éå†æ¡¶å†…çš„ 8 ä¸ªæ§½ä½ï¼Œé€šè¿‡ <strong>tophash</strong>ï¼ˆHash é«˜ 8 ä½ï¼‰å¿«é€Ÿè¿‡æ»¤ï¼Œå†åŒ¹é… Keyã€‚</li><li>è‹¥æ¡¶æ»¡ä¸”æœªæ‰¾åˆ°ï¼Œç»§ç»­æŸ¥æ‰¾ <strong>overflow bucket</strong>ï¼ˆæº¢å‡ºæ¡¶ï¼‰ã€‚</li></ol></li><li><strong>å¢/æ”¹ (Store)</strong>ï¼šå®šä½åˆ° Bucket åï¼Œå¯»æ‰¾ç©ºä½æˆ–å·²å­˜åœ¨çš„ Keyã€‚è‹¥è´Ÿè½½å› å­ &gt; 6.5 æˆ–æº¢å‡ºæ¡¶è¿‡å¤šï¼Œè§¦å‘ <strong>æ¸è¿›å¼æ‰©å®¹</strong>ã€‚</li><li><strong>åˆ  (Delete)</strong>ï¼šå®šä½åˆ°æ§½ä½ï¼Œå°† Key/Value æ¸…ç†ï¼Œå¹¶é‡ç½® tophashã€‚</li></ul><h4 id="_3-sync-map-çš„å¢åˆ æ”¹æŸ¥å®ç°-read-dirty" tabindex="-1"><a class="header-anchor" href="#_3-sync-map-çš„å¢åˆ æ”¹æŸ¥å®ç°-read-dirty"><span>3. sync.Map çš„å¢åˆ æ”¹æŸ¥å®ç° (read/dirty)</span></a></h4><p><code>sync.Map</code> é‡‡ç”¨äº† <strong>è¯»å†™åˆ†ç¦»</strong> å’Œ <strong>å†…å­˜æ¢æ—¶é—´</strong> çš„ç­–ç•¥ï¼š</p><ul><li><p><strong>åº•å±‚ç»“æ„</strong>ï¼š</p><ul><li><code>read</code>ï¼šåŸå­è®¿é—®ï¼ˆ<code>atomic.Value</code>ï¼‰ï¼ŒåŒ…å«åªè¯»æ•°æ®ï¼Œä¸åŠ é”ã€‚</li><li><code>dirty</code>ï¼šåŸç”Ÿ mapï¼ŒåŒ…å«å…¨é‡æ•°æ®ï¼Œæ“ä½œéœ€åŠ äº’æ–¥é”ã€‚</li><li><code>misses</code>ï¼šè®¡æ•°å™¨ï¼Œè®°å½• read æœªå‘½ä¸­è€ŒæŸ¥ dirty çš„æ¬¡æ•°ã€‚</li></ul></li><li><p><strong>æŸ¥ (Load)</strong>ï¼š</p><ol><li>å…ˆä» <code>read</code> åŸå­è¯»å–ï¼Œå‘½ä¸­åˆ™è¿”å›ï¼ˆæå…¶é«˜æ•ˆï¼‰ã€‚</li><li>è‹¥æœªå‘½ä¸­ä¸” <code>amended=true</code>ï¼ˆè¯´æ˜ dirty æœ‰ read æ²¡æœ‰çš„æ•°æ®ï¼‰ï¼ŒåŠ é”è®¿é—® <code>dirty</code>ã€‚</li><li><strong>Miss å‡çº§</strong>ï¼šè‹¥ misses è¾¾åˆ° <code>len(dirty)</code>ï¼Œå°† dirty æ•´ä½“è¿ç§»ç»™ readï¼Œæ¸…ç©º dirtyï¼Œå®ç°â€œå†·æ•°æ®å˜çƒ­â€ã€‚</li></ol></li><li><p><strong>å¢ (Store)</strong>ï¼š</p><ol><li>è‹¥ Key åœ¨ <code>read</code> ä¸­ä¸”æœªè¢«æ ‡è®°ä¸º <code>expunged</code>ï¼Œå°è¯• <strong>CAS</strong> æ— é”æ›´æ–°ã€‚</li><li>è‹¥ CAS å¤±è´¥ï¼ˆä¸åœ¨ read æˆ–å·²è¢«åˆ ï¼‰ï¼ŒåŠ é”å¤„ç†ï¼šåŒæ£€æŸ¥ï¼ˆDouble Checkï¼‰ï¼Œå†™å…¥æˆ–æ›´æ–° <code>dirty</code>ã€‚</li></ol></li><li><p><strong>åˆ  (Delete)</strong>ï¼š</p><ol><li>è‹¥ Key åœ¨ <code>read</code> ä¸­ï¼Œç›´æ¥å°†å…¶ Value æ ‡è®°ä¸º <code>nil</code>ï¼ˆé€»è¾‘åˆ é™¤ï¼Œæ— é”ï¼‰ã€‚</li><li>è‹¥ä¸åœ¨ <code>read</code> ä¸” <code>amended=true</code>ï¼ŒåŠ é”ç‰©ç†åˆ é™¤ <code>dirty</code> ä¸­çš„ Keyã€‚</li></ol></li></ul><h4 id="_4-ä¸ºä»€ä¹ˆ-sync-map-é€‚åˆè¯»å¤šå†™å°‘" tabindex="-1"><a class="header-anchor" href="#_4-ä¸ºä»€ä¹ˆ-sync-map-é€‚åˆè¯»å¤šå†™å°‘"><span>4. ä¸ºä»€ä¹ˆ sync.Map é€‚åˆè¯»å¤šå†™å°‘ï¼Ÿ</span></a></h4><p>å› ä¸ºåœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹ï¼Œç»å¤§å¤šæ•°æ“ä½œéƒ½èƒ½åœ¨ <code>read</code> map ä¸­é€šè¿‡åŸå­æ“ä½œå®Œæˆï¼Œå®Œå…¨é¿å¼€äº†äº’æ–¥é”ï¼Œä»è€Œåœ¨å¤§è§„æ¨¡å¹¶å‘ä¸‹æ€§èƒ½è¿œè¶… <code>RWMutex + map</code>ã€‚è€Œåœ¨å†™å¤šçš„åœºæ™¯ä¸‹ï¼Œé¢‘ç¹çš„ <code>dirty</code> å†™å…¥å’Œ <code>miss</code> è¿ç§»ä¼šå¯¼è‡´æ€§èƒ½é™¡é™ã€‚</p><hr><h3 id="q21-goä¸­çš„mapå¦‚ä½•å®ç°é¡ºåºè¯»å–" tabindex="-1"><a class="header-anchor" href="#q21-goä¸­çš„mapå¦‚ä½•å®ç°é¡ºåºè¯»å–"><span>Q21: Goä¸­çš„mapå¦‚ä½•å®ç°é¡ºåºè¯»å–</span></a></h3><p><strong>map æœ¬èº«æ— åºï¼Œéœ€è¦é¢å¤–å¤„ç†ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ–¹æ³•ï¼šæ”¶é›† key æ’åº</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">keys</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> make</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">([]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">len</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> k</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> range</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    keys</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> append</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">keys</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">k</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Strings</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">keys</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> _</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">k</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> range</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> keys</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">k</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">k</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q22-interface-çš„åº•å±‚ç»“æ„" tabindex="-1"><a class="header-anchor" href="#q22-interface-çš„åº•å±‚ç»“æ„"><span>Q22: interface çš„åº•å±‚ç»“æ„</span></a></h3><p><strong>ç©ºæ¥å£ <code>interface{}</code>ï¼ˆefaceï¼‰ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> eface</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    _type</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">_type</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         // ç±»å‹ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    data</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">  unsafe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Pointer</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // æ•°æ®æŒ‡é’ˆ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>éç©ºæ¥å£ï¼ˆifaceï¼‰ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> iface</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    tab</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">  *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">itab</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">           // ç±»å‹å’Œæ–¹æ³•è¡¨</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    data</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> unsafe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Pointer</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // æ•°æ®æŒ‡é’ˆ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="ä¸‰ã€å¹¶å‘ç¼–ç¨‹" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€å¹¶å‘ç¼–ç¨‹"><span>ä¸‰ã€å¹¶å‘ç¼–ç¨‹</span></a></h2><h3 id="q23-åç¨‹ã€çº¿ç¨‹ã€è¿›ç¨‹çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#q23-åç¨‹ã€çº¿ç¨‹ã€è¿›ç¨‹çš„åŒºåˆ«"><span>Q23: åç¨‹ã€çº¿ç¨‹ã€è¿›ç¨‹çš„åŒºåˆ«</span></a></h3><table><thead><tr><th style="text-align:left;">ç‰¹æ€§</th><th style="text-align:left;">è¿›ç¨‹</th><th style="text-align:left;">çº¿ç¨‹</th><th style="text-align:left;">åç¨‹(Goroutine)</th></tr></thead><tbody><tr><td style="text-align:left;">å®šä¹‰</td><td style="text-align:left;">èµ„æºåˆ†é…å•ä½</td><td style="text-align:left;">CPU è°ƒåº¦å•ä½</td><td style="text-align:left;">ç”¨æˆ·æ€è½»é‡çº§çº¿ç¨‹</td></tr><tr><td style="text-align:left;">å†…å­˜</td><td style="text-align:left;">ç‹¬ç«‹åœ°å€ç©ºé—´</td><td style="text-align:left;">å…±äº«è¿›ç¨‹å†…å­˜</td><td style="text-align:left;">å…±äº«çº¿ç¨‹å†…å­˜</td></tr><tr><td style="text-align:left;">åˆ›å»ºå¼€é”€</td><td style="text-align:left;">å¾ˆå¤§</td><td style="text-align:left;">è¾ƒå¤§(~1MB)</td><td style="text-align:left;">å¾ˆå°(~2KB)</td></tr><tr><td style="text-align:left;">åˆ‡æ¢å¼€é”€</td><td style="text-align:left;">å¾ˆå¤§</td><td style="text-align:left;">è¾ƒå¤§(~1Î¼s)</td><td style="text-align:left;">å¾ˆå°(~200ns)</td></tr><tr><td style="text-align:left;">è°ƒåº¦</td><td style="text-align:left;">æ“ä½œç³»ç»Ÿ</td><td style="text-align:left;">æ“ä½œç³»ç»Ÿ</td><td style="text-align:left;">Go runtime(ç”¨æˆ·æ€)</td></tr><tr><td style="text-align:left;">æ•°é‡çº§</td><td style="text-align:left;">æ•°ç™¾</td><td style="text-align:left;">æ•°åƒ</td><td style="text-align:left;">æ•°ç™¾ä¸‡</td></tr></tbody></table><hr><h3 id="q24-goroutineå’Œçº¿ç¨‹çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#q24-goroutineå’Œçº¿ç¨‹çš„åŒºåˆ«"><span>Q24: Goroutineå’Œçº¿ç¨‹çš„åŒºåˆ«</span></a></h3><table><thead><tr><th style="text-align:left;">ç‰¹æ€§</th><th style="text-align:left;">Goroutine</th><th style="text-align:left;">OS Thread</th></tr></thead><tbody><tr><td style="text-align:left;">å†…å­˜å ç”¨</td><td style="text-align:left;">åˆå§‹ 2KBï¼Œå¯åŠ¨æ€å¢é•¿</td><td style="text-align:left;">å›ºå®š 1-8MB</td></tr><tr><td style="text-align:left;">åˆ›å»ºé”€æ¯</td><td style="text-align:left;">ç”¨æˆ·æ€ï¼Œå¼€é”€å°</td><td style="text-align:left;">å†…æ ¸æ€ï¼Œå¼€é”€å¤§</td></tr><tr><td style="text-align:left;">åˆ‡æ¢æˆæœ¬</td><td style="text-align:left;">~200ns</td><td style="text-align:left;">~1-2Î¼s</td></tr><tr><td style="text-align:left;">è°ƒåº¦</td><td style="text-align:left;">Go runtimeï¼ˆç”¨æˆ·æ€ï¼‰</td><td style="text-align:left;">æ“ä½œç³»ç»Ÿï¼ˆå†…æ ¸æ€ï¼‰</td></tr><tr><td style="text-align:left;">æ•°é‡</td><td style="text-align:left;">å¯åˆ›å»ºç™¾ä¸‡çº§</td><td style="text-align:left;">é€šå¸¸æ•°åƒä¸ª</td></tr><tr><td style="text-align:left;">æ ˆ</td><td style="text-align:left;">åŠ¨æ€ä¼¸ç¼©ï¼ˆ2KB-1GBï¼‰</td><td style="text-align:left;">å›ºå®šå¤§å°</td></tr></tbody></table><hr><h3 id="q25-goroutineå’Œchannelçš„ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#q25-goroutineå’Œchannelçš„ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆ"><span>Q25: Goroutineå’ŒChannelçš„ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆ</span></a></h3><p><strong>Goroutineï¼š</strong></p><ul><li>è½»é‡çº§å¹¶å‘æ‰§è¡Œå•å…ƒ</li><li>ç”± Go runtime è°ƒåº¦</li><li>åˆå§‹å†…å­˜ä»… 2KB</li></ul><p><strong>Channelï¼š</strong></p><ul><li>Goroutine é—´çš„é€šä¿¡æœºåˆ¶</li><li>å®ç°æ•°æ®åŒæ­¥å’Œä¼ é€’</li><li>ä¿è¯å¹¶å‘å®‰å…¨</li></ul><p><strong>åä½œå…³ç³»ï¼š</strong></p><blockquote><p>&quot;Don&#39;t communicate by sharing memory; share memory by communicating.&quot;</p></blockquote><hr><h3 id="q26-ä»€ä¹ˆæ˜¯channel-ä¸ºä»€ä¹ˆå®ƒå¯ä»¥åšåˆ°çº¿ç¨‹å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#q26-ä»€ä¹ˆæ˜¯channel-ä¸ºä»€ä¹ˆå®ƒå¯ä»¥åšåˆ°çº¿ç¨‹å®‰å…¨"><span>Q26: ä»€ä¹ˆæ˜¯channelï¼Œä¸ºä»€ä¹ˆå®ƒå¯ä»¥åšåˆ°çº¿ç¨‹å®‰å…¨</span></a></h3><p><strong>Channel æ˜¯ Go ä¸­çš„é€šä¿¡æœºåˆ¶</strong>ï¼Œç”¨äº goroutine é—´ä¼ é€’æ•°æ®ã€‚</p><p><strong>åº•å±‚ç»“æ„ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> hchan</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    qcount</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   uint</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">           // å½“å‰å…ƒç´ æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    dataqsiz</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> uint</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">           // ç¼“å†²åŒºå¤§å°</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    buf</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">      unsafe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Pointer</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // ç¯å½¢é˜Ÿåˆ—æŒ‡é’ˆ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    lock</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">     mutex</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          // äº’æ–¥é”ï¼ˆå…³é”®ï¼ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    sendq</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    waitq</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          // å‘é€ç­‰å¾…é˜Ÿåˆ—</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    recvq</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    waitq</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          // æ¥æ”¶ç­‰å¾…é˜Ÿåˆ—</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>çº¿ç¨‹å®‰å…¨åŸå› ï¼š</strong></p><ol><li><strong>å†…ç½®äº’æ–¥é”</strong>ï¼šæ‰€æœ‰æ“ä½œéƒ½åœ¨é”ä¿æŠ¤ä¸‹è¿›è¡Œ</li><li><strong>ç­‰å¾…é˜Ÿåˆ—</strong>ï¼šå‘é€/æ¥æ”¶è€…ä¼šè¢«å®‰å…¨åœ°åŠ å…¥ç­‰å¾…é˜Ÿåˆ—</li><li><strong>åŸå­æ“ä½œ</strong>ï¼šå…³é”®çŠ¶æ€ä½¿ç”¨åŸå­æ“ä½œæ›´æ–°</li></ol><hr><h3 id="q27-æ— ç¼“å†²chançš„å‘é€å’Œæ¥æ”¶æ˜¯å¦åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#q27-æ— ç¼“å†²chançš„å‘é€å’Œæ¥æ”¶æ˜¯å¦åŒæ­¥"><span>Q27: æ— ç¼“å†²Chançš„å‘é€å’Œæ¥æ”¶æ˜¯å¦åŒæ­¥</span></a></h3><p><strong>æ˜¯åŒæ­¥çš„ã€‚</strong> æ— ç¼“å†² Channel å‘é€å’Œæ¥æ”¶æ“ä½œå¿…é¡»åŒæ—¶å‡†å¤‡å¥½æ‰èƒ½å®Œæˆã€‚</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ch</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> make</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">chan</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ— ç¼“å†²</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">go</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ch</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 42</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // é˜»å¡ç›´åˆ°æœ‰æ¥æ”¶è€…</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">val</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;-</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ch</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // é˜»å¡ç›´åˆ°æœ‰å‘é€è€…</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q28-channelæ˜¯åŒæ­¥çš„è¿˜æ˜¯å¼‚æ­¥çš„" tabindex="-1"><a class="header-anchor" href="#q28-channelæ˜¯åŒæ­¥çš„è¿˜æ˜¯å¼‚æ­¥çš„"><span>Q28: Channelæ˜¯åŒæ­¥çš„è¿˜æ˜¯å¼‚æ­¥çš„</span></a></h3><p><strong>å–å†³äºæ˜¯å¦æœ‰ç¼“å†²ï¼š</strong></p><table><thead><tr><th style="text-align:left;">ç±»å‹</th><th style="text-align:left;">åˆ›å»ºæ–¹å¼</th><th style="text-align:left;">åŒæ­¥æ€§</th></tr></thead><tbody><tr><td style="text-align:left;">æ— ç¼“å†²</td><td style="text-align:left;"><code>make(chan T)</code></td><td style="text-align:left;">åŒæ­¥</td></tr><tr><td style="text-align:left;">æœ‰ç¼“å†²</td><td style="text-align:left;"><code>make(chan T, n)</code></td><td style="text-align:left;">å¼‚æ­¥ï¼ˆç¼“å†²åŒºæœªæ»¡æ—¶ï¼‰</td></tr></tbody></table><hr><h3 id="q29-channel-æ“ä½œçš„å„ç§æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#q29-channel-æ“ä½œçš„å„ç§æƒ…å†µ"><span>Q29: Channel æ“ä½œçš„å„ç§æƒ…å†µ</span></a></h3><table><thead><tr><th style="text-align:left;">æ“ä½œ</th><th style="text-align:left;">nil channel</th><th style="text-align:left;">å·²å…³é—­ channel</th><th style="text-align:left;">æ­£å¸¸ channel</th></tr></thead><tbody><tr><td style="text-align:left;">å‘é€</td><td style="text-align:left;">æ°¸ä¹…é˜»å¡</td><td style="text-align:left;"><strong>panic</strong></td><td style="text-align:left;">é˜»å¡æˆ–æˆåŠŸ</td></tr><tr><td style="text-align:left;">æ¥æ”¶</td><td style="text-align:left;">æ°¸ä¹…é˜»å¡</td><td style="text-align:left;">è¿”å›é›¶å€¼ï¼Œok=false</td><td style="text-align:left;">é˜»å¡æˆ–æˆåŠŸ</td></tr><tr><td style="text-align:left;">å…³é—­</td><td style="text-align:left;"><strong>panic</strong></td><td style="text-align:left;"><strong>panic</strong></td><td style="text-align:left;">æˆåŠŸ</td></tr></tbody></table><hr><h3 id="q30-golangå¹¶å‘æœºåˆ¶ä»¥åŠcspå¹¶å‘æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#q30-golangå¹¶å‘æœºåˆ¶ä»¥åŠcspå¹¶å‘æ¨¡å‹"><span>Q30: Golangå¹¶å‘æœºåˆ¶ä»¥åŠCSPå¹¶å‘æ¨¡å‹</span></a></h3><p><strong>CSPï¼ˆCommunicating Sequential Processesï¼‰æ¨¡å‹æ ¸å¿ƒæ€æƒ³ï¼š</strong></p><blockquote><p>&quot;ä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œè¦é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜&quot;</p></blockquote><p><strong>Go çš„å¹¶å‘æœºåˆ¶ï¼š</strong></p><ol><li><strong>Goroutine</strong>ï¼šè½»é‡çº§çº¿ç¨‹ï¼Œç”± Go runtime è°ƒåº¦</li><li><strong>Channel</strong>ï¼šgoroutine é—´çš„é€šä¿¡ç®¡é“</li><li><strong>Select</strong>ï¼šå¤šè·¯å¤ç”¨æœºåˆ¶</li></ol><table><thead><tr><th style="text-align:left;">ä¼ ç»Ÿæ¨¡å‹</th><th style="text-align:left;">CSP æ¨¡å‹</th></tr></thead><tbody><tr><td style="text-align:left;">å…±äº«å†…å­˜ + é”</td><td style="text-align:left;">é€šè¿‡ Channel é€šä¿¡</td></tr><tr><td style="text-align:left;">å®¹æ˜“æ­»é”</td><td style="text-align:left;">æ›´å®‰å…¨çš„å¹¶å‘æ¨¡å¼</td></tr></tbody></table><hr><h3 id="q31-golangä¸­é™¤äº†åŠ mutexé”ä»¥å¤–è¿˜æœ‰å“ªäº›æ–¹å¼å®‰å…¨è¯»å†™å…±äº«å˜é‡" tabindex="-1"><a class="header-anchor" href="#q31-golangä¸­é™¤äº†åŠ mutexé”ä»¥å¤–è¿˜æœ‰å“ªäº›æ–¹å¼å®‰å…¨è¯»å†™å…±äº«å˜é‡"><span>Q31: Golangä¸­é™¤äº†åŠ Mutexé”ä»¥å¤–è¿˜æœ‰å“ªäº›æ–¹å¼å®‰å…¨è¯»å†™å…±äº«å˜é‡</span></a></h3><table><thead><tr><th style="text-align:left;">æ–¹å¼</th><th style="text-align:left;">é€‚ç”¨åœºæ™¯</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;"><code>sync.RWMutex</code></td><td style="text-align:left;">è¯»å¤šå†™å°‘</td><td style="text-align:left;">è¯»é”å…±äº«ï¼Œå†™é”æ’ä»–</td></tr><tr><td style="text-align:left;"><code>sync.Map</code></td><td style="text-align:left;">å¹¶å‘ map</td><td style="text-align:left;">å†…ç½®å¹¶å‘å®‰å…¨çš„ map</td></tr><tr><td style="text-align:left;"><code>atomic</code> åŒ…</td><td style="text-align:left;">ç®€å•ç±»å‹</td><td style="text-align:left;">åŸå­æ“ä½œï¼Œæ— é”é«˜æ€§èƒ½</td></tr><tr><td style="text-align:left;"><code>channel</code></td><td style="text-align:left;">æ•°æ®ä¼ é€’</td><td style="text-align:left;">CSP æ¨¡å‹ï¼Œé€šè¿‡é€šä¿¡å…±äº«å†…å­˜</td></tr></tbody></table><hr><h3 id="q32-goä¸­çš„é”æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#q32-goä¸­çš„é”æœ‰å“ªäº›"><span>Q32: Goä¸­çš„é”æœ‰å“ªäº›</span></a></h3><table><thead><tr><th style="text-align:left;">é”ç±»å‹</th><th style="text-align:left;">è¯´æ˜</th><th style="text-align:left;">ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td style="text-align:left;"><code>sync.Mutex</code></td><td style="text-align:left;">äº’æ–¥é”</td><td style="text-align:left;">ä¿æŠ¤ä¸´ç•ŒåŒº</td></tr><tr><td style="text-align:left;"><code>sync.RWMutex</code></td><td style="text-align:left;">è¯»å†™é”</td><td style="text-align:left;">è¯»å¤šå†™å°‘</td></tr><tr><td style="text-align:left;"><code>sync.Once</code></td><td style="text-align:left;">å•æ¬¡æ‰§è¡Œ</td><td style="text-align:left;">å•ä¾‹åˆå§‹åŒ–</td></tr><tr><td style="text-align:left;"><code>sync.Cond</code></td><td style="text-align:left;">æ¡ä»¶å˜é‡</td><td style="text-align:left;">ç­‰å¾…æ¡ä»¶æ»¡è¶³</td></tr><tr><td style="text-align:left;"><code>sync.Map</code></td><td style="text-align:left;">å¹¶å‘å®‰å…¨ map</td><td style="text-align:left;">å¹¶å‘ map æ“ä½œ</td></tr><tr><td style="text-align:left;"><code>atomic</code></td><td style="text-align:left;">åŸå­æ“ä½œ</td><td style="text-align:left;">ç®€å•ç±»å‹åŸå­æ“ä½œ</td></tr></tbody></table><hr><h3 id="q33-goä¸­çš„é”å¦‚ä½•å®ç°" tabindex="-1"><a class="header-anchor" href="#q33-goä¸­çš„é”å¦‚ä½•å®ç°"><span>Q33: Goä¸­çš„é”å¦‚ä½•å®ç°</span></a></h3><p><strong>sync.Mutex å®ç°åŸç†ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Mutex</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    state</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int32</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   // é”çŠ¶æ€ï¼ˆlockedã€wokenã€starvingã€waiter countï¼‰</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    sema</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  uint32</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // ä¿¡å·é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¸¤ç§æ¨¡å¼ï¼š</strong></p><ol><li><strong>æ­£å¸¸æ¨¡å¼</strong>ï¼šè‡ªæ—‹å°è¯•è·å–é” â†’ å¤±è´¥ååŠ å…¥ç­‰å¾…é˜Ÿåˆ— â†’ FIFO å”¤é†’</li><li><strong>é¥¥é¥¿æ¨¡å¼</strong>ï¼šç­‰å¾…è¶…è¿‡ 1ms åˆ‡æ¢ â†’ ç›´æ¥æŠŠé”äº¤ç»™ç­‰å¾…è€… â†’ é˜²æ­¢å°¾éƒ¨å»¶è¿Ÿ</li></ol><hr><h3 id="q34-goä¸­casæ˜¯æ€ä¹ˆå›äº‹" tabindex="-1"><a class="header-anchor" href="#q34-goä¸­casæ˜¯æ€ä¹ˆå›äº‹"><span>Q34: Goä¸­CASæ˜¯æ€ä¹ˆå›äº‹</span></a></h3><p><strong>CASï¼ˆCompare And Swapï¼‰æ˜¯åŸå­æ“ä½œï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å¦‚æœ addr çš„å€¼ç­‰äº oldï¼Œåˆ™æ›¿æ¢ä¸º new</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> CompareAndSwapInt64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">addr</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">old</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">new</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">bool</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> counter</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int64</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// CAS è‡ªæ—‹</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    old</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> atomic</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">LoadInt64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">counter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> atomic</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CompareAndSwapInt64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">counter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">old</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">old</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        break</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç‰¹ç‚¹ï¼š</strong> æ— é”å¹¶å‘ã€ç¡¬ä»¶çº§åˆ«åŸå­æ€§ã€é€‚ç”¨äºç®€å•ç±»å‹</p><hr><h3 id="q35-goä¸­æ•°æ®ç«äº‰é—®é¢˜æ€ä¹ˆè§£å†³" tabindex="-1"><a class="header-anchor" href="#q35-goä¸­æ•°æ®ç«äº‰é—®é¢˜æ€ä¹ˆè§£å†³"><span>Q35: Goä¸­æ•°æ®ç«äº‰é—®é¢˜æ€ä¹ˆè§£å†³</span></a></h3><p><strong>æ£€æµ‹å·¥å…·ï¼š</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -race</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> main.go</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # è¿è¡Œæ—¶æ£€æµ‹</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -race</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./...</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     # æµ‹è¯•æ—¶æ£€æµ‹</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong> Mutexã€RWMutexã€Atomicã€Channelã€sync.Once</p><hr><h3 id="q36-golangä¸­å¸¸ç”¨çš„å¹¶å‘æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#q36-golangä¸­å¸¸ç”¨çš„å¹¶å‘æ¨¡å‹"><span>Q36: Golangä¸­å¸¸ç”¨çš„å¹¶å‘æ¨¡å‹</span></a></h3><p><strong>1. Worker Poolï¼ˆå·¥ä½œæ± ï¼‰</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">jobs</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> make</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">chan</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> w</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">w</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">w</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    go</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">jobs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å›ºå®š worker æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. Pipelineï¼ˆç®¡é“ï¼‰</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> gen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;-</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">chan</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { ... }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> sq</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">in</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;-</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">chan</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;-</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">chan</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { ... }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3. Fan-out/Fan-in</strong></p><ul><li>Fan-outï¼šå¤šä¸ª goroutine è¯»å–åŒä¸€ä¸ª channel</li><li>Fan-inï¼šå¤šä¸ª channel åˆå¹¶åˆ°ä¸€ä¸ª</li></ul><p><strong>4. Semaphoreï¼ˆä¿¡å·é‡ï¼‰</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sem</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> make</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">chan</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{}, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æœ€å¤š 10 ä¸ªå¹¶å‘</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h3 id="q37-æ€ä¹ˆé™åˆ¶goroutineçš„æ•°é‡" tabindex="-1"><a class="header-anchor" href="#q37-æ€ä¹ˆé™åˆ¶goroutineçš„æ•°é‡"><span>Q37: æ€ä¹ˆé™åˆ¶Goroutineçš„æ•°é‡</span></a></h3><p><strong>æ–¹æ³•ä¸€ï¼šå¸¦ç¼“å†² Channelï¼ˆä¿¡å·é‡ï¼‰</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sem</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> make</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">chan</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{}, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æœ€å¤š 10 ä¸ª</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    sem</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;-</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{}{}  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è·å–</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    go</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        defer</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() { </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;-</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sem</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }()  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// é‡Šæ”¾</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // work...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–¹æ³•äºŒï¼šWorker Pool</strong>ï¼ˆè§ä¸Šé¢˜ï¼‰</p><p><strong>æ–¹æ³•ä¸‰ï¼šç¬¬ä¸‰æ–¹åº“</strong></p><ul><li><code>golang.org/x/sync/semaphore</code></li><li><code>ants</code>ï¼ˆé«˜æ€§èƒ½åç¨‹æ± ï¼‰</li></ul><hr><h3 id="q38-æ€ä¹ˆæŸ¥çœ‹goroutineçš„æ•°é‡" tabindex="-1"><a class="header-anchor" href="#q38-æ€ä¹ˆæŸ¥çœ‹goroutineçš„æ•°é‡"><span>Q38: æ€ä¹ˆæŸ¥çœ‹Goroutineçš„æ•°é‡</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ–¹æ³•ä¸€ï¼šruntime</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">runtime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NumGoroutine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ–¹æ³•äºŒï¼špprof</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> _</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;net/http/pprof&quot;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">go</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ListenAndServe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;:6060&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è®¿é—® http://localhost:6060/debug/pprof/goroutine</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q39-goä¸»åç¨‹å¦‚ä½•ç­‰å…¶ä½™åç¨‹å®Œå†æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#q39-goä¸»åç¨‹å¦‚ä½•ç­‰å…¶ä½™åç¨‹å®Œå†æ“ä½œ"><span>Q39: Goä¸»åç¨‹å¦‚ä½•ç­‰å…¶ä½™åç¨‹å®Œå†æ“ä½œ</span></a></h3><p><strong>æ–¹æ³•ä¸€ï¼šsync.WaitGroupï¼ˆæ¨èï¼‰</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> wg</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> sync</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">WaitGroup</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    wg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    go</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        defer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> wg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Done</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // work...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">wg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Wait</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ç­‰å¾…æ‰€æœ‰å®Œæˆ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–¹æ³•äºŒï¼šChannel</strong></p><p><strong>æ–¹æ³•ä¸‰ï¼šerrgroup</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">g</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> errgroup</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WithContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">g</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Go</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { ... })</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> g</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Wait</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q40-context-æ˜¯ä»€ä¹ˆ-å®ƒçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#q40-context-æ˜¯ä»€ä¹ˆ-å®ƒçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›"><span>Q40: Context æ˜¯ä»€ä¹ˆï¼Ÿå®ƒçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</span></a></h3><p><strong>Context æ˜¯ä»€ä¹ˆï¼š</strong><br><code>Context</code> æ˜¯ Go è¯­è¨€æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œä¸»è¦ç”¨äºåœ¨ API è¾¹ç•Œä¹‹é—´ä»¥åŠ goroutine ä¹‹é—´ä¼ é€’<strong>æˆªæ­¢æ—¥æœŸï¼ˆDeadlinesï¼‰</strong>ã€<strong>å–æ¶ˆä¿¡å·ï¼ˆCancellation signalsï¼‰<strong>ä»¥åŠ</strong>è¯·æ±‚èŒƒå›´çš„å€¼ï¼ˆRequest-scoped valuesï¼‰</strong>ã€‚</p><p><strong>æ ¸å¿ƒåŸç†ï¼š</strong></p><ul><li><strong>æ ‘çŠ¶ç»“æ„</strong>ï¼šContext å½¢æˆä¸€ä¸ªæ ‘çŠ¶ç»§æ‰¿ä½“ç³»ã€‚æ ¹èŠ‚ç‚¹é€šå¸¸æ˜¯ <code>context.Background()</code> æˆ– <code>context.TODO()</code>ã€‚</li><li><strong>å–æ¶ˆä¿¡å·ä¼ æ’­</strong>ï¼šå½“çˆ¶ Context è¢«å–æ¶ˆæ—¶ï¼Œæ‰€æœ‰ç”±å®ƒè¡ç”Ÿå‡ºæ¥çš„å­ Context ä¹Ÿä¼šè¢«å–æ¶ˆã€‚</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šContext æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œå¯ä»¥è¢«ä¼ é€’ç»™å¤šä¸ª goroutineã€‚</li></ul><p><strong>Go æ ‡å‡†åº“æä¾›çš„å››ç§è¡ç”Ÿçš„ Contextï¼š</strong></p><table><thead><tr><th style="text-align:left;">å‡½æ•°</th><th style="text-align:left;">ä½œç”¨</th><th style="text-align:left;">åœºæ™¯</th></tr></thead><tbody><tr><td style="text-align:left;"><code>WithCancel</code></td><td style="text-align:left;">è¿”å›ä¸€ä¸ªå¯æ‰‹åŠ¨å–æ¶ˆçš„ Context</td><td style="text-align:left;">ä»»åŠ¡å®Œæˆåæ‰‹åŠ¨åœæ­¢åç¨‹</td></tr><tr><td style="text-align:left;"><code>WithDeadline</code></td><td style="text-align:left;">åœ¨æŒ‡å®šçš„æ—¶é—´ç‚¹è‡ªåŠ¨å–æ¶ˆ</td><td style="text-align:left;">é™æ—¶ä»»åŠ¡ã€æˆªæ­¢æ—¶é—´</td></tr><tr><td style="text-align:left;"><code>WithTimeout</code></td><td style="text-align:left;">åœ¨æŒ‡å®šçš„æŒç»­æ—¶é—´åè‡ªåŠ¨å–æ¶ˆ</td><td style="text-align:left;">RPC è°ƒç”¨è¶…æ—¶ã€æ•°æ®åº“æŸ¥è¯¢è¶…æ—¶</td></tr><tr><td style="text-align:left;"><code>WithValue</code></td><td style="text-align:left;">æºå¸¦è¯·æ±‚èŒƒå›´çš„é”®å€¼å¯¹</td><td style="text-align:left;">ä¼ é€’ RequestIDã€TraceIDã€ç”¨æˆ·ä¿¡æ¯</td></tr></tbody></table><p><strong>åº”ç”¨åœºæ™¯ï¼š</strong></p><ol><li><p><strong>è¶…æ—¶æ§åˆ¶ï¼ˆæœ€å¸¸ç”¨ï¼‰</strong>ï¼š<br> åœ¨åšç½‘ç»œè¯·æ±‚æˆ–æ•°æ®åº“æŸ¥è¯¢æ—¶ï¼Œé˜²æ­¢è°ƒç”¨æ–¹å› ä¸ºä¸‹æ¸¸å“åº”æ…¢è€Œå¯¼è‡´èµ„æºä¸€ç›´è¢«å ç”¨ã€‚</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cancel</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WithTimeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Background</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">defer</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> cancel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">_</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NewRequestWithContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;https://api.example.com&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">DefaultClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Do</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å–æ¶ˆä¿¡å·çš„çº§è”ä¼ é€’</strong>ï¼š<br> å½“ä¸€ä¸ªä¸»ä»»åŠ¡è¢«å–æ¶ˆæˆ–å¤±è´¥æ—¶ï¼Œä¸ä¹‹ç›¸å…³çš„æ‰€æœ‰å­ä»»åŠ¡ï¼ˆåœ¨ä¸åŒçš„ goroutine ä¸­ï¼‰éƒ½åº”è¯¥ç«‹å³åœæ­¢ã€‚</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cancel</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WithCancel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Background</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    go</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;worker1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    go</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> worker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;worker2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    cancel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä¸¤ä¸ª worker éƒ½ä¼šæ”¶åˆ°ä¿¡å·å¹¶é€€å‡º</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è·¨ API è¾¹ç•Œä¼ é€’æ•°æ®</strong>ï¼š<br> åœ¨ Web æ¡†æ¶ï¼ˆå¦‚ Ginï¼‰çš„ä¸­é—´ä»¶ä¸­ï¼Œå¸¸ç”¨æ¥ä¼ é€’ TraceIDã€ç”¨æˆ·ç™»å½•ä¿¡æ¯ç­‰ã€‚</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä¼ é€’æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WithValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Background</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;TraceID&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;abc-123&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è·å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">traceID</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;TraceID&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>é˜²æ­¢ Goroutine æ³„æ¼</strong>ï¼š<br> é€šè¿‡ Context çš„ <code>Done()</code> é€šé“ï¼Œç¡®ä¿ Goroutine åœ¨ä»»åŠ¡ä¸å†éœ€è¦æ—¶èƒ½åŠæ—¶é€€å‡ºã€‚</p></li></ol><p><strong>ä½¿ç”¨åŸåˆ™ï¼š</strong></p><ul><li>ä¸è¦å°† Context æ”¾å…¥ç»“æ„ä½“ä¸­ï¼Œè€Œæ˜¯æ˜¾å¼ä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ï¼ˆé€šå¸¸å‘½åä¸º <code>ctx</code>ï¼‰ã€‚</li><li>ä¸è¦ä¼ é€’ <code>nil</code> çš„ Contextï¼Œå¦‚æœä¸ç¡®å®šç”¨ä»€ä¹ˆï¼Œä½¿ç”¨ <code>context.TODO()</code>ã€‚</li><li>Context ä»…ç”¨äºä¼ é€’è¯·æ±‚èŒƒå›´çš„æ•°æ®ï¼Œä¸åº”ç”¨äºä¼ é€’å‡½æ•°çš„å¯é€‰å‚æ•°ã€‚</li></ul><hr><h3 id="q41-å¦‚ä½•åœ¨goroutineæ‰§è¡Œä¸€åŠå°±é€€å‡ºåç¨‹" tabindex="-1"><a class="header-anchor" href="#q41-å¦‚ä½•åœ¨goroutineæ‰§è¡Œä¸€åŠå°±é€€å‡ºåç¨‹"><span>Q41: å¦‚ä½•åœ¨goroutineæ‰§è¡Œä¸€åŠå°±é€€å‡ºåç¨‹</span></a></h3><p><strong>æ–¹æ³•ä¸€ï¼šcontext å–æ¶ˆï¼ˆæ¨èï¼‰</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cancel</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WithCancel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Background</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">go</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">ctx</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        select</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        case</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;-</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Done</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // é€€å‡º</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        default</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // å·¥ä½œ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cancel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å‘é€å–æ¶ˆä¿¡å·</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–¹æ³•äºŒï¼šChannel ä¿¡å·</strong></p><p><strong>æ–¹æ³•ä¸‰ï¼šruntime.Goexit()</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">runtime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Goexit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ç«‹å³ç»ˆæ­¢å½“å‰ goroutine</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h3 id="q42-goroutineå‘ç”Ÿäº†æ³„æ¼å¦‚ä½•æ£€æµ‹" tabindex="-1"><a class="header-anchor" href="#q42-goroutineå‘ç”Ÿäº†æ³„æ¼å¦‚ä½•æ£€æµ‹"><span>Q42: Goroutineå‘ç”Ÿäº†æ³„æ¼å¦‚ä½•æ£€æµ‹</span></a></h3><p><strong>å¸¸è§æ³„æ¼åŸå› ï¼š</strong></p><ul><li>é˜»å¡åœ¨ channel ä¸Šæ— æ³•é€€å‡º</li><li>æ— é™å¾ªç¯æ²¡æœ‰é€€å‡ºæ¡ä»¶</li><li>å¿˜è®°å…³é—­ channel</li></ul><p><strong>æ£€æµ‹æ–¹æ³•ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 1. runtime</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">fmt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">runtime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NumGoroutine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 2. pprof</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">go</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tool</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> pprof</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//localhost:6060/debug/pprof/goroutine</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 3. goleakï¼ˆæµ‹è¯•ç”¨ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> TestNoLeak</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">t</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">testing</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    defer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> goleak</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">VerifyNone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // test code</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q43-åœ¨goå‡½æ•°ä¸­ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿå†…å­˜æ³„éœ²" tabindex="-1"><a class="header-anchor" href="#q43-åœ¨goå‡½æ•°ä¸­ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿå†…å­˜æ³„éœ²"><span>Q43: åœ¨Goå‡½æ•°ä¸­ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿå†…å­˜æ³„éœ²</span></a></h3><p><strong>å¸¸è§å†…å­˜æ³„éœ²åœºæ™¯ï¼š</strong></p><ol><li><strong>Goroutine æ³„éœ²</strong>ï¼šé˜»å¡åœ¨ channel ä¸Šæ— æ³•é€€å‡º</li><li><strong>æœªå…³é—­çš„èµ„æº</strong>ï¼šæ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ã€HTTP Body</li><li><strong>ç¼“å­˜æœªæ¸…ç†</strong>ï¼šå…¨å±€ map æ— é™å¢é•¿</li><li><strong>time.Ticker æœªåœæ­¢</strong></li></ol><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ticker</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NewTicker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">defer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ticker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Stop</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å¿…é¡»åœæ­¢ï¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="å››ã€gmp-è°ƒåº¦å™¨" tabindex="-1"><a class="header-anchor" href="#å››ã€gmp-è°ƒåº¦å™¨"><span>å››ã€GMP è°ƒåº¦å™¨</span></a></h2><h3 id="q44-goçš„gpmå¦‚ä½•è°ƒåº¦" tabindex="-1"><a class="header-anchor" href="#q44-goçš„gpmå¦‚ä½•è°ƒåº¦"><span>Q44: Goçš„GPMå¦‚ä½•è°ƒåº¦</span></a></h3><p><strong>GMP ç»„ä»¶ï¼š</strong></p><table><thead><tr><th style="text-align:left;">ç»„ä»¶</th><th style="text-align:left;">å…¨ç§°</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;">G</td><td style="text-align:left;">Goroutine</td><td style="text-align:left;">åç¨‹</td></tr><tr><td style="text-align:left;">M</td><td style="text-align:left;">Machine</td><td style="text-align:left;">æ“ä½œç³»ç»Ÿçº¿ç¨‹</td></tr><tr><td style="text-align:left;">P</td><td style="text-align:left;">Processor</td><td style="text-align:left;">é€»è¾‘å¤„ç†å™¨ï¼Œè¿æ¥ G å’Œ M</td></tr></tbody></table><p><strong>è°ƒåº¦æµç¨‹ï¼š</strong></p><ol><li>ä¼˜å…ˆä» P çš„æœ¬åœ°é˜Ÿåˆ—è·å– G</li><li>æœ¬åœ°é˜Ÿåˆ—ç©ºåˆ™ä»å…¨å±€é˜Ÿåˆ—æ‰¹é‡è·å–</li><li>å…¨å±€é˜Ÿåˆ—ç©ºåˆ™ä»å…¶ä»– P å·å–ï¼ˆWork Stealingï¼‰</li><li>éƒ½æ²¡æœ‰åˆ™ M ä¼‘çœ </li></ol><p><strong>æŠ¢å å¼è°ƒåº¦ï¼ˆGo 1.14+ï¼‰ï¼š</strong></p><ul><li>åŸºäºä¿¡å·çš„å¼‚æ­¥æŠ¢å </li><li>å³ä½¿æ²¡æœ‰å‡½æ•°è°ƒç”¨ä¹Ÿèƒ½è¢«æŠ¢å </li></ul><hr><h3 id="q45-ä¸ºä½•gpmè°ƒåº¦è¦æœ‰p" tabindex="-1"><a class="header-anchor" href="#q45-ä¸ºä½•gpmè°ƒåº¦è¦æœ‰p"><span>Q45: ä¸ºä½•GPMè°ƒåº¦è¦æœ‰P</span></a></h3><p><strong>P çš„å­˜åœ¨è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š</strong></p><ol><li><strong>æœ¬åœ°é˜Ÿåˆ—</strong>ï¼šå‡å°‘å…¨å±€é”ç«äº‰</li><li><strong>mcache ç¼“å­˜</strong>ï¼šæ¯ä¸ª P æœ‰ç‹¬ç«‹çš„å†…å­˜ç¼“å­˜</li><li><strong>æ§åˆ¶å¹¶å‘åº¦</strong>ï¼šGOMAXPROCS æ§åˆ¶ P æ•°é‡</li><li><strong>Work Stealing</strong>ï¼šP å¯ä»¥äº’ç›¸å·ä»»åŠ¡</li></ol><hr><h3 id="q46-goroutineå’Œkernelthreadä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»" tabindex="-1"><a class="header-anchor" href="#q46-goroutineå’Œkernelthreadä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»"><span>Q46: Goroutineå’ŒKernelThreadä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»</span></a></h3><p><strong>å¤šå¯¹å¤šï¼ˆM:Nï¼‰å…³ç³»ï¼š</strong></p><ul><li>å¤šä¸ª G è¿è¡Œåœ¨å°‘æ•° M ä¸Š</li><li>P ä½œä¸ºä¸­ä»‹è¿æ¥ G å’Œ M</li><li>å……åˆ†åˆ©ç”¨å¤šæ ¸ï¼Œé¿å…é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢</li></ul><hr><h3 id="q47-g0çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#q47-g0çš„ä½œç”¨"><span>Q47: G0çš„ä½œç”¨</span></a></h3><p><strong>G0 æ˜¯æ¯ä¸ª Mï¼ˆçº¿ç¨‹ï¼‰çš„ç‰¹æ®Š goroutineï¼š</strong></p><p><strong>ä½œç”¨ï¼š</strong></p><ol><li>è¿è¡Œè°ƒåº¦å™¨ä»£ç </li><li>æ‰§è¡Œ cgoã€syscall</li><li>goroutine æ ˆæ‰©ç¼©å®¹</li><li>æ‰§è¡Œ GC æ ‡è®°ç­‰</li></ol><p><strong>ç‰¹ç‚¹ï¼š</strong> æ¯ä¸ª M éƒ½æœ‰ä¸€ä¸ª G0ï¼Œä½¿ç”¨ç³»ç»Ÿæ ˆï¼ˆçº¦ 8KBï¼‰</p><hr><h2 id="äº”ã€å†…å­˜ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#äº”ã€å†…å­˜ç®¡ç†"><span>äº”ã€å†…å­˜ç®¡ç†</span></a></h2><h3 id="q48-goè¯­è¨€çš„æ ˆç©ºé—´ç®¡ç†æ˜¯æ€ä¹ˆæ ·çš„" tabindex="-1"><a class="header-anchor" href="#q48-goè¯­è¨€çš„æ ˆç©ºé—´ç®¡ç†æ˜¯æ€ä¹ˆæ ·çš„"><span>Q48: Goè¯­è¨€çš„æ ˆç©ºé—´ç®¡ç†æ˜¯æ€ä¹ˆæ ·çš„</span></a></h3><p><strong>åŠ¨æ€æ ˆæœºåˆ¶ï¼š</strong></p><ul><li>åˆå§‹æ ˆå¤§å°ï¼š2KB</li><li>æœ€å¤§æ ˆå¤§å°ï¼š1GBï¼ˆ64ä½ç³»ç»Ÿï¼‰</li><li>åŠ¨æ€å¢é•¿ç­–ç•¥</li></ul><p><strong>æ ˆæ‰©å®¹è¿‡ç¨‹ï¼š</strong></p><ol><li>æ£€æµ‹åˆ°æ ˆä¸è¶³</li><li>åˆ†é…æ–°æ ˆï¼ˆ2 å€å¤§å°ï¼‰</li><li>å¤åˆ¶æ—§æ ˆå†…å®¹</li><li>è°ƒæ•´æ ˆä¸ŠæŒ‡é’ˆ</li><li>é‡Šæ”¾æ—§æ ˆ</li></ol><p><strong>æ ˆæ”¶ç¼©ï¼š</strong> GC æ—¶æ£€æŸ¥ï¼Œä½¿ç”¨ç‡ &lt; 1/4 æ—¶æ”¶ç¼©</p><hr><h3 id="q49-goçš„å¯¹è±¡åœ¨å†…å­˜ä¸­æ˜¯æ€æ ·åˆ†é…çš„" tabindex="-1"><a class="header-anchor" href="#q49-goçš„å¯¹è±¡åœ¨å†…å­˜ä¸­æ˜¯æ€æ ·åˆ†é…çš„"><span>Q49: Goçš„å¯¹è±¡åœ¨å†…å­˜ä¸­æ˜¯æ€æ ·åˆ†é…çš„</span></a></h3><p><strong>Go ä½¿ç”¨ TCMalloc å¤šçº§ç¼“å­˜ï¼š</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>mcacheï¼ˆæ¯ä¸ª P ä¸€ä¸ªï¼Œæ— é”ï¼‰</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>mcentralï¼ˆæ¯ä¸ª size class ä¸€ä¸ªï¼Œæœ‰é”ï¼‰</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>mheapï¼ˆå…¨å±€å”¯ä¸€ï¼Œç®¡ç†æ‰€æœ‰å†…å­˜ï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">å¯¹è±¡å¤§å°</th><th style="text-align:left;">åˆ†é…æ–¹å¼</th></tr></thead><tbody><tr><td style="text-align:left;">&lt; 16Bï¼ˆtinyï¼‰</td><td style="text-align:left;">Tiny Allocator</td></tr><tr><td style="text-align:left;">16B ~ 32KB</td><td style="text-align:left;">mcache â†’ mcentral</td></tr><tr><td style="text-align:left;">&gt; 32KB</td><td style="text-align:left;">ç›´æ¥ä» mheap åˆ†é…</td></tr></tbody></table><hr><h3 id="q50-goä¸­çš„é€ƒé€¸åˆ†ææ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#q50-goä¸­çš„é€ƒé€¸åˆ†ææ˜¯ä»€ä¹ˆ"><span>Q50: Goä¸­çš„é€ƒé€¸åˆ†ææ˜¯ä»€ä¹ˆ</span></a></h3><p><strong>é€ƒé€¸åˆ†æå†³å®šå˜é‡åˆ†é…åœ¨æ ˆè¿˜æ˜¯å †ã€‚</strong></p><p><strong>æŸ¥çœ‹é€ƒé€¸åˆ†æï¼š</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -gcflags=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;-m&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> main.go</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>å¸¸è§é€ƒé€¸åœºæ™¯ï¼š</strong></p><ol><li>è¿”å›å±€éƒ¨å˜é‡æŒ‡é’ˆ</li><li>é—­åŒ…å¼•ç”¨</li><li>interface{} å‚æ•°</li><li>åŠ¨æ€å¤§å°åˆ†é… <code>make([]int, n)</code></li><li>åˆ‡ç‰‡æ‰©å®¹</li></ol><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> escape</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    x</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 42</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> &amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">x</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // x é€ƒé€¸åˆ°å †</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q51-golangçš„å†…å­˜æ¨¡å‹ä¸­ä¸ºä»€ä¹ˆå°å¯¹è±¡å¤šäº†ä¼šé€ æˆgcå‹åŠ›" tabindex="-1"><a class="header-anchor" href="#q51-golangçš„å†…å­˜æ¨¡å‹ä¸­ä¸ºä»€ä¹ˆå°å¯¹è±¡å¤šäº†ä¼šé€ æˆgcå‹åŠ›"><span>Q51: Golangçš„å†…å­˜æ¨¡å‹ä¸­ä¸ºä»€ä¹ˆå°å¯¹è±¡å¤šäº†ä¼šé€ æˆGCå‹åŠ›</span></a></h3><p><strong>åŸå› åˆ†æï¼š</strong></p><ol><li><strong>æ‰«æå¼€é”€</strong>ï¼šGC éœ€è¦æ‰«ææ‰€æœ‰å¯¹è±¡</li><li><strong>å†…å­˜ç¢ç‰‡</strong>ï¼šå°å¯¹è±¡åˆ†æ•£åˆ†å¸ƒ</li><li><strong>åˆ†é…å‹åŠ›</strong>ï¼šé¢‘ç¹åˆ†é…å¢åŠ  mcache/mcentral å‹åŠ›</li><li><strong>ä¸‰è‰²æ ‡è®°</strong>ï¼šæ¯ä¸ªå¯¹è±¡éƒ½éœ€è¦æ ‡è®°</li></ol><p><strong>ä¼˜åŒ–ç­–ç•¥ï¼š</strong> sync.Pool å¤ç”¨ã€é¢„åˆ†é…ã€å‡å°‘é€ƒé€¸ã€åˆå¹¶å°å¯¹è±¡</p><hr><h2 id="å…­ã€åƒåœ¾å›æ”¶" tabindex="-1"><a class="header-anchor" href="#å…­ã€åƒåœ¾å›æ”¶"><span>å…­ã€åƒåœ¾å›æ”¶</span></a></h2><h3 id="q52-golangåƒåœ¾å›æ”¶ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#q52-golangåƒåœ¾å›æ”¶ç®—æ³•"><span>Q52: Golangåƒåœ¾å›æ”¶ç®—æ³•</span></a></h3><p><strong>ä¸‰è‰²æ ‡è®° + æ··åˆå†™å±éšœ</strong></p><p><strong>ä¸‰è‰²æ ‡è®°ï¼š</strong></p><ul><li><strong>ç™½è‰²</strong>ï¼šæœªæ‰«æï¼Œå¯èƒ½æ˜¯åƒåœ¾</li><li><strong>ç°è‰²</strong>ï¼šå·²æ‰«æï¼Œå¼•ç”¨æœªæ‰«æ</li><li><strong>é»‘è‰²</strong>ï¼šå·²æ‰«æå®Œæˆ</li></ul><p><strong>ç®—æ³•æµç¨‹ï¼š</strong></p><ol><li>STW â†’ å¼€å¯å†™å±éšœ</li><li>å¹¶å‘æ ‡è®°ï¼ˆä¸‰è‰²æ ‡è®°ï¼‰</li><li>STW â†’ å…³é—­å†™å±éšœ</li><li>å¹¶å‘æ¸…é™¤</li></ol><p><strong>æ··åˆå†™å±éšœï¼ˆGo 1.8+ï¼‰ï¼š</strong> æ’å…¥å±éšœ + åˆ é™¤å±éšœï¼Œæ— éœ€æ ˆé‡æ–°æ‰«æ</p><hr><h3 id="q53-gcçš„è§¦å‘æ¡ä»¶" tabindex="-1"><a class="header-anchor" href="#q53-gcçš„è§¦å‘æ¡ä»¶"><span>Q53: GCçš„è§¦å‘æ¡ä»¶</span></a></h3><table><thead><tr><th style="text-align:left;">è§¦å‘æ¡ä»¶</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;">å †å†…å­˜å¢é•¿</td><td style="text-align:left;">è¾¾åˆ° GOGC é˜ˆå€¼ï¼ˆé»˜è®¤ 100%ï¼Œå³ç¿»å€ï¼‰</td></tr><tr><td style="text-align:left;">å®šæ—¶è§¦å‘</td><td style="text-align:left;">è¶…è¿‡ 2 åˆ†é’Ÿæ²¡æœ‰ GC</td></tr><tr><td style="text-align:left;">æ‰‹åŠ¨è§¦å‘</td><td style="text-align:left;"><code>runtime.GC()</code></td></tr><tr><td style="text-align:left;">å†…å­˜é™åˆ¶</td><td style="text-align:left;">GOMEMLIMITï¼ˆGo 1.19+ï¼‰</td></tr></tbody></table><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">GOGC</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">100</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # é»˜è®¤å€¼ï¼Œå †å†…å­˜å¢é•¿ 100% è§¦å‘ GC</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">GOGC</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">200</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # é™ä½ GC é¢‘ç‡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">GOGC</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">off</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # å…³é—­ GCï¼ˆä¸æ¨èï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q54-gc-è¿‡ç¨‹ä¸­çš„-stw" tabindex="-1"><a class="header-anchor" href="#q54-gc-è¿‡ç¨‹ä¸­çš„-stw"><span>Q54: GC è¿‡ç¨‹ä¸­çš„ STW</span></a></h3><p><strong>ä¸¤æ¬¡çŸ­æš‚çš„ STWï¼š</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Mark Setup (STW 1)    ~10-30Î¼s   å¼€å¯å†™å±éšœ</span></span>
<span class="line"><span>Concurrent Mark                   åå°æ ‡è®°</span></span>
<span class="line"><span>Mark Termination (STW 2) ~60-90Î¼s å…³é—­å†™å±éšœ</span></span>
<span class="line"><span>Concurrent Sweep                  æ¸…ç†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€» STW æ—¶é—´é€šå¸¸ &lt; 1msã€‚</p><hr><h3 id="q55-å¦‚ä½•ä¼˜åŒ–-gc" tabindex="-1"><a class="header-anchor" href="#q55-å¦‚ä½•ä¼˜åŒ–-gc"><span>Q55: å¦‚ä½•ä¼˜åŒ– GC</span></a></h3><ol><li><strong>è°ƒæ•´ GOGC</strong>ï¼š<code>GOGC=200</code> å‡å°‘ GC é¢‘ç‡</li><li><strong>ä½¿ç”¨ GOMEMLIMIT</strong>ï¼ˆGo 1.19+ï¼‰</li><li><strong>å¤ç”¨å¯¹è±¡</strong>ï¼š<code>sync.Pool</code></li><li><strong>é¢„åˆ†é…åˆ‡ç‰‡</strong></li><li><strong>å‡å°‘é€ƒé€¸</strong></li></ol><hr><h2 id="ä¸ƒã€æ ‡å‡†åº“ä¸å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€æ ‡å‡†åº“ä¸å®æˆ˜"><span>ä¸ƒã€æ ‡å‡†åº“ä¸å®æˆ˜</span></a></h2><h3 id="q56-goä¸­çš„httpåŒ…çš„å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#q56-goä¸­çš„httpåŒ…çš„å®ç°åŸç†"><span>Q56: Goä¸­çš„httpåŒ…çš„å®ç°åŸç†</span></a></h3><p><strong>æ ¸å¿ƒç»„ä»¶ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Handler</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ServeHTTP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ResponseWriter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ServeMux</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    mu</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    sync</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RWMutex</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    m</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">     map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">muxEntry</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p><ol><li>ListenAndServe ç›‘å¬ç«¯å£</li><li>Accept æ¥å—è¿æ¥</li><li>ä¸ºæ¯ä¸ªè¿æ¥å¯åŠ¨ goroutine</li><li>è§£æ HTTP è¯·æ±‚</li><li>è·¯ç”±åŒ¹é… â†’ è°ƒç”¨ Handler</li><li>å†™å…¥å“åº”</li></ol><hr><h3 id="q57-sync-pool-çš„ä½œç”¨å’ŒåŸç†" tabindex="-1"><a class="header-anchor" href="#q57-sync-pool-çš„ä½œç”¨å’ŒåŸç†"><span>Q57: sync.Pool çš„ä½œç”¨å’ŒåŸç†</span></a></h3><p><strong>ä½œç”¨ï¼š</strong> å¯¹è±¡å¤ç”¨ï¼Œå‡å°‘ GC å‹åŠ›</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> pool</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> sync</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Pool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    New</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">interface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{} {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> new</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">bytes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Buffer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">buf</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> pool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">bytes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Buffer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">buf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Reset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä½¿ç”¨ buf...</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">buf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ³¨æ„ï¼š</strong> Pool ä¸­çš„å¯¹è±¡å¯èƒ½åœ¨ä»»æ„æ—¶åˆ»è¢« GC å›æ”¶</p><hr><h3 id="q58-sync-once-çš„å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#q58-sync-once-çš„å®ç°åŸç†"><span>Q58: sync.Once çš„å®ç°åŸç†</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Once</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    done</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> uint32</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    m</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Mutex</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">o </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Once</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Do</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">f</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> atomic</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">LoadUint32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">done</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // å¿«é€Ÿè·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    defer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">done</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        defer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> atomic</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">StoreUint32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">done</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        f</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q59-go-ä¸­å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#q59-go-ä¸­å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼"><span>Q59: Go ä¸­å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    instance</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Singleton</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    once</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">     sync</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Once</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> GetInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Singleton</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    once</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Do</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        instance</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> &amp;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Singleton</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    })</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> instance</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q60-pprof-æ€§èƒ½åˆ†ææ€ä¹ˆç”¨" tabindex="-1"><a class="header-anchor" href="#q60-pprof-æ€§èƒ½åˆ†ææ€ä¹ˆç”¨"><span>Q60: pprof æ€§èƒ½åˆ†ææ€ä¹ˆç”¨</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> _</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;net/http/pprof&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">go</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ListenAndServe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;:6060&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># CPU åˆ†æ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pprof</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://localhost:6060/debug/pprof/profile?seconds=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">30</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å†…å­˜åˆ†æ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pprof</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://localhost:6060/debug/pprof/heap</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Goroutine åˆ†æ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pprof</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://localhost:6060/debug/pprof/goroutine</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¸¸ç”¨å‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">top,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> list,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> web,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> svg</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="å…«ã€é¡¹ç›®å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#å…«ã€é¡¹ç›®å®æˆ˜"><span>å…«ã€é¡¹ç›®å®æˆ˜</span></a></h2><h3 id="q61-gin-ä¸­é—´ä»¶çš„å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#q61-gin-ä¸­é—´ä»¶çš„å®ç°åŸç†"><span>Q61: Gin ä¸­é—´ä»¶çš„å®ç°åŸç†</span></a></h3><p><strong>æ´‹è‘±æ¨¡å‹ï¼ŒåŸºäºè´£ä»»é“¾æ¨¡å¼ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Context</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    handlers</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HandlersChain</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // []HandlerFunc</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    index</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int8</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">           // å½“å‰æ‰§è¡Œçš„ handler ç´¢å¼•</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">c </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Next</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">index</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">++</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">index</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">len</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">handlers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">handlers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">index</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">](</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">index</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">++</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ‰§è¡Œæµç¨‹ï¼š</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>è¯·æ±‚ â†’ Middleware1 â†’ Middleware2 â†’ Handler â†’ Middleware2 â†’ Middleware1 â†’ å“åº”</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h3 id="q62-gorm-çš„-hook-æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#q62-gorm-çš„-hook-æœºåˆ¶"><span>Q62: GORM çš„ Hook æœºåˆ¶</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// åˆ›å»ºå‰</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">u </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">BeforeCreate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">tx</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gorm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">DB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    u</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Password</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> hashPassword</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">u</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ›´æ–°å‰</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">u </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">BeforeUpdate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">tx</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gorm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">DB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Statement</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Changed</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Password&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        u</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Password</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> hashPassword</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">u</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Hook é¡ºåºï¼š</strong></p><ul><li>åˆ›å»ºï¼šBeforeSave â†’ BeforeCreate â†’ æ’å…¥ â†’ AfterCreate â†’ AfterSave</li><li>æ›´æ–°ï¼šBeforeSave â†’ BeforeUpdate â†’ æ›´æ–° â†’ AfterUpdate â†’ AfterSave</li></ul><hr><h3 id="q63-å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”" tabindex="-1"><a class="header-anchor" href="#q63-å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”"><span>Q63: å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”</span></a></h3><p><strong>Redis åˆ†å¸ƒå¼é”ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// åŠ é”</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> TryLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">ctx</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">value</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">ttl</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Duration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">bool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ok</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">_</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> rdb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SetNX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ttl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ok</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è§£é”ï¼ˆLua ä¿è¯åŸå­æ€§ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">ctx</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">value</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">bool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    script</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NewScript</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        if redis.call(&#39;get&#39;, KEYS[1]) == ARGV[1] then</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            return redis.call(&#39;del&#39;, KEYS[1])</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        end</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        return 0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">_</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> script</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Run</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">rdb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, []</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> result</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q64-ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©å¦‚ä½•è§£å†³" tabindex="-1"><a class="header-anchor" href="#q64-ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©å¦‚ä½•è§£å†³"><span>Q64: ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©å¦‚ä½•è§£å†³</span></a></h3><table><thead><tr><th style="text-align:left;">é—®é¢˜</th><th style="text-align:left;">åŸå› </th><th style="text-align:left;">è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td style="text-align:left;">ç©¿é€</td><td style="text-align:left;">æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®</td><td style="text-align:left;">å¸ƒéš†è¿‡æ»¤å™¨ã€ç¼“å­˜ç©ºå€¼</td></tr><tr><td style="text-align:left;">å‡»ç©¿</td><td style="text-align:left;">çƒ­ç‚¹ key è¿‡æœŸ</td><td style="text-align:left;">äº’æ–¥é”ã€æ°¸ä¸è¿‡æœŸ + å¼‚æ­¥æ›´æ–°</td></tr><tr><td style="text-align:left;">é›ªå´©</td><td style="text-align:left;">å¤§é‡ key åŒæ—¶è¿‡æœŸ</td><td style="text-align:left;">éšæœºè¿‡æœŸæ—¶é—´ã€å¤šçº§ç¼“å­˜</td></tr></tbody></table><hr><h3 id="q65-å¦‚ä½•å®ç°æœåŠ¡ç†”æ–­" tabindex="-1"><a class="header-anchor" href="#q65-å¦‚ä½•å®ç°æœåŠ¡ç†”æ–­"><span>Q65: å¦‚ä½•å®ç°æœåŠ¡ç†”æ–­</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;github.com/sony/gobreaker&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cb</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> gobreaker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NewCircuitBreaker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gobreaker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Settings</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    Name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:        </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;my-service&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    MaxRequests</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    Timeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:     </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">30</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ReadyToTrip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">counts</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> gobreaker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Counts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">bool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        failureRatio</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> float64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">counts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">TotalFailures</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> float64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">counts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Requests</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> counts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Requests</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &gt;=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> failureRatio</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &gt;=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.6</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Execute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">interface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{}, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> doRequest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç†”æ–­å™¨çŠ¶æ€ï¼š</strong> Closedï¼ˆæ­£å¸¸ï¼‰â†’ Openï¼ˆç†”æ–­ï¼‰â†’ Half-Openï¼ˆæµ‹è¯•ï¼‰</p><hr><h3 id="q66-grpc-å’Œ-http-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#q66-grpc-å’Œ-http-çš„åŒºåˆ«"><span>Q66: gRPC å’Œ HTTP çš„åŒºåˆ«</span></a></h3><table><thead><tr><th style="text-align:left;">ç‰¹æ€§</th><th style="text-align:left;">gRPC</th><th style="text-align:left;">HTTP/REST</th></tr></thead><tbody><tr><td style="text-align:left;">åè®®</td><td style="text-align:left;">HTTP/2</td><td style="text-align:left;">HTTP/1.1</td></tr><tr><td style="text-align:left;">åºåˆ—åŒ–</td><td style="text-align:left;">Protobufï¼ˆäºŒè¿›åˆ¶ï¼‰</td><td style="text-align:left;">JSONï¼ˆæ–‡æœ¬ï¼‰</td></tr><tr><td style="text-align:left;">æ€§èƒ½</td><td style="text-align:left;">é«˜</td><td style="text-align:left;">è¾ƒä½</td></tr><tr><td style="text-align:left;">æµå¼ä¼ è¾“</td><td style="text-align:left;">åŸç”Ÿæ”¯æŒ</td><td style="text-align:left;">éœ€ WebSocket</td></tr><tr><td style="text-align:left;">æµè§ˆå™¨</td><td style="text-align:left;">éœ€ grpc-web</td><td style="text-align:left;">åŸç”Ÿæ”¯æŒ</td></tr></tbody></table><p><strong>é€‰æ‹©ï¼š</strong> å†…éƒ¨æœåŠ¡ç”¨ gRPCï¼Œå¯¹å¤– API ç”¨ REST</p><hr><h3 id="q67-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" tabindex="-1"><a class="header-anchor" href="#q67-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"><span>Q67: å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</span></a></h3><p><strong>ä¸‰ä¸ªç¯èŠ‚ï¼š</strong></p><ol><li><strong>ç”Ÿäº§è€…ç¡®è®¤</strong>ï¼šç­‰å¾… broker ACK</li><li><strong>MQ æŒä¹…åŒ–</strong>ï¼šæ¶ˆæ¯è½ç›˜</li><li><strong>æ¶ˆè´¹è€…ç¡®è®¤</strong>ï¼šæ‰‹åŠ¨ ACK</li></ol><p><strong>å¹‚ç­‰æ€§å¤„ç†ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> processOrder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">orderID</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> processed</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">_</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;processed:&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> orderID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">processed</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // å·²å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> doProcess</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">orderID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> err</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;processed:&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">+</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">orderID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">24</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Hour</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="ä¹ã€gin-æ¡†æ¶æ·±å…¥" tabindex="-1"><a class="header-anchor" href="#ä¹ã€gin-æ¡†æ¶æ·±å…¥"><span>ä¹ã€Gin æ¡†æ¶æ·±å…¥</span></a></h2><h3 id="q68-gin-å’Œ-net-http-çš„å…³ç³»" tabindex="-1"><a class="header-anchor" href="#q68-gin-å’Œ-net-http-çš„å…³ç³»"><span>Q68: Gin å’Œ net/http çš„å…³ç³»</span></a></h3><p><strong>Gin æ˜¯åŸºäº net/http çš„å°è£…ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Gin çš„ Engine å®ç°äº† http.Handler æ¥å£</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Engine</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">engine </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Engine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ServeHTTP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">w</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ResponseWriter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å¤„ç†è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å¯ä»¥ä½œä¸º http.Handler ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ListenAndServe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;:8080&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">engine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Gin åœ¨ net/http åŸºç¡€ä¸Šå¢åŠ äº†ï¼š</strong></p><ul><li>é«˜æ€§èƒ½è·¯ç”±ï¼ˆåŸºæ•°æ ‘ï¼‰</li><li>ä¸­é—´ä»¶æœºåˆ¶</li><li>å‚æ•°ç»‘å®š</li><li>é”™è¯¯å¤„ç†</li></ul><hr><h3 id="q69-gin-ä¸­é—´ä»¶åŸç†å’Œæ‰§è¡Œé¡ºåº" tabindex="-1"><a class="header-anchor" href="#q69-gin-ä¸­é—´ä»¶åŸç†å’Œæ‰§è¡Œé¡ºåº"><span>Q69: Gin ä¸­é—´ä»¶åŸç†å’Œæ‰§è¡Œé¡ºåº</span></a></h3><p><strong>æ´‹è‘±æ¨¡å‹ï¼š</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>è¯·æ±‚ â†’ M1(å‰) â†’ M2(å‰) â†’ M3(å‰) â†’ Handler</span></span>
<span class="line"><span>å“åº” â† M1(å) â† M2(å) â† M3(å) â†â”˜</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ‰§è¡Œæµç¨‹ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Logger</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HandlerFunc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        start</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Now</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Next</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ‰§è¡Œåç»­å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        latency</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Since</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">start</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Printf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;è€—æ—¶: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">latency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å…³é”®æ–¹æ³•ï¼š</strong></p><ul><li><code>c.Next()</code>ï¼šæ‰§è¡Œåç»­ handler</li><li><code>c.Abort()</code>ï¼šç»ˆæ­¢åç»­æ‰§è¡Œ</li><li><code>c.AbortWithStatus()</code>ï¼šç»ˆæ­¢å¹¶è¿”å›çŠ¶æ€ç </li></ul><hr><h3 id="q70-å¦‚ä½•å®ç°ä¸€ä¸ªé‰´æƒä¸­é—´ä»¶" tabindex="-1"><a class="header-anchor" href="#q70-å¦‚ä½•å®ç°ä¸€ä¸ªé‰´æƒä¸­é—´ä»¶"><span>Q70: å¦‚ä½•å®ç°ä¸€ä¸ªé‰´æƒä¸­é—´ä»¶</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> AuthMiddleware</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HandlerFunc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        token</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">GetHeader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Authorization&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 1. æ£€æŸ¥ Token æ˜¯å¦å­˜åœ¨</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> token</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">AbortWithStatusJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">401</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">H</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æœªæˆæƒ&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">})</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 2. éªŒè¯ Token</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        claims</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> jwt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ParseToken</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">token</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">AbortWithStatusJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">401</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">H</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Token æ— æ•ˆ&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">})</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 3. å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ Context</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;userID&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">claims</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">UserID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;role&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">claims</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Role</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Next</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q71-gin-å¦‚ä½•å¤„ç†-panic" tabindex="-1"><a class="header-anchor" href="#q71-gin-å¦‚ä½•å¤„ç†-panic"><span>Q71: Gin å¦‚ä½•å¤„ç† panic</span></a></h3><p><strong>å†…ç½® Recovery ä¸­é—´ä»¶ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">r</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Default</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// åŒ…å« Logger å’Œ Recovery</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ‰‹åŠ¨æ·»åŠ </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Use</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Recovery</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è‡ªå®šä¹‰ Recovery</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Use</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CustomRecovery</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{}) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // è®°å½•æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Printf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Panic: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // è¿”å›é”™è¯¯å“åº”</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">AbortWithStatusJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">H</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;error&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨å†…éƒ¨é”™è¯¯&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    })</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q72-http-è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#q72-http-è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸ"><span>Q72: HTTP è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸ</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>1. è¯·æ±‚è¿›å…¥ â†’ net/http æ¥æ”¶</span></span>
<span class="line"><span>2. Engine.ServeHTTP() â†’ ä»è¿æ¥æ± è·å– Context</span></span>
<span class="line"><span>3. è·¯ç”±åŒ¹é… â†’ åŸºæ•°æ ‘æŸ¥æ‰¾</span></span>
<span class="line"><span>4. æ‰§è¡Œä¸­é—´ä»¶é“¾ â†’ handlers[0:n]</span></span>
<span class="line"><span>5. å‚æ•°ç»‘å®š â†’ Query/JSON/Form</span></span>
<span class="line"><span>6. ä¸šåŠ¡å¤„ç† â†’ Controller</span></span>
<span class="line"><span>7. å“åº”å†™å…¥ â†’ c.JSON() / c.String()</span></span>
<span class="line"><span>8. Context å›æ”¶ â†’ æ”¾å›è¿æ¥æ± </span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q73-gin-å‚æ•°æ ¡éªŒ" tabindex="-1"><a class="header-anchor" href="#q73-gin-å‚æ•°æ ¡éªŒ"><span>Q73: Gin å‚æ•°æ ¡éªŒ</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> CreateUserReq</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    Username</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> string</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `json:&quot;username&quot; binding:&quot;required,min=3,max=20&quot;`</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    Email</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    string</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `json:&quot;email&quot; binding:&quot;required,email&quot;`</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    Age</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      int</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `json:&quot;age&quot; binding:&quot;gte=18,lte=100&quot;`</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    Password</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> string</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `json:&quot;password&quot; binding:&quot;required,min=6&quot;`</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> CreateUser</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> req</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> CreateUserReq</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ShouldBindJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // è‡ªå®šä¹‰é”™è¯¯å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">JSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">400</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">H</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            &quot;error&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">translateError</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        })</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ä¸šåŠ¡é€»è¾‘...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="åã€ç³»ç»Ÿè®¾è®¡ä¸æ¶æ„" tabindex="-1"><a class="header-anchor" href="#åã€ç³»ç»Ÿè®¾è®¡ä¸æ¶æ„"><span>åã€ç³»ç»Ÿè®¾è®¡ä¸æ¶æ„</span></a></h2><h3 id="q74-å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#q74-å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘ç³»ç»Ÿ"><span>Q74: å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘ç³»ç»Ÿ</span></a></h3><p><strong>æ ¸å¿ƒç­–ç•¥ï¼š</strong></p><table><thead><tr><th style="text-align:left;">ç­–ç•¥</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>ç¼“å­˜</strong></td><td style="text-align:left;">å¤šçº§ç¼“å­˜ï¼ˆæœ¬åœ° + Redisï¼‰</td></tr><tr><td style="text-align:left;"><strong>å¼‚æ­¥</strong></td><td style="text-align:left;">æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦</td></tr><tr><td style="text-align:left;"><strong>é™æµ</strong></td><td style="text-align:left;">ä¿æŠ¤ç³»ç»Ÿä¸è¢«æ‰“å®</td></tr><tr><td style="text-align:left;"><strong>åˆ†åº“åˆ†è¡¨</strong></td><td style="text-align:left;">æ•°æ®åº“æ°´å¹³æ‰©å±•</td></tr><tr><td style="text-align:left;"><strong>è¯»å†™åˆ†ç¦»</strong></td><td style="text-align:left;">ä¸»å†™ä»è¯»</td></tr><tr><td style="text-align:left;"><strong>è´Ÿè½½å‡è¡¡</strong></td><td style="text-align:left;">å¤šå®ä¾‹åˆ†æ‹…å‹åŠ›</td></tr></tbody></table><hr><h3 id="q75-é™æµç®—æ³•æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#q75-é™æµç®—æ³•æœ‰å“ªäº›"><span>Q75: é™æµç®—æ³•æœ‰å“ªäº›</span></a></h3><table><thead><tr><th style="text-align:left;">ç®—æ³•</th><th style="text-align:left;">ç‰¹ç‚¹</th><th style="text-align:left;">é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>è®¡æ•°å™¨</strong></td><td style="text-align:left;">ç®€å•ï¼Œæœ‰ä¸´ç•Œé—®é¢˜</td><td style="text-align:left;">ç®€å•é™æµ</td></tr><tr><td style="text-align:left;"><strong>æ»‘åŠ¨çª—å£</strong></td><td style="text-align:left;">è§£å†³ä¸´ç•Œé—®é¢˜</td><td style="text-align:left;">ç²¾ç¡®é™æµ</td></tr><tr><td style="text-align:left;"><strong>ä»¤ç‰Œæ¡¶</strong></td><td style="text-align:left;">å…è®¸çªå‘æµé‡</td><td style="text-align:left;">API é™æµ</td></tr><tr><td style="text-align:left;"><strong>æ¼æ¡¶</strong></td><td style="text-align:left;">å¹³æ»‘æµé‡</td><td style="text-align:left;">æµé‡æ•´å½¢</td></tr></tbody></table><p><strong>ä»¤ç‰Œæ¡¶å®ç°ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;golang.org/x/time/rate&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">limiter</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> rate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NewLimiter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ¯ç§’ 100 ä¸ªï¼Œçªå‘ 10 ä¸ª</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">limiter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Allow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">JSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">429</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">H</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;è¯·æ±‚è¿‡äºé¢‘ç¹&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">})</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q76-å¦‚ä½•å®ç°æœåŠ¡é™çº§" tabindex="-1"><a class="header-anchor" href="#q76-å¦‚ä½•å®ç°æœåŠ¡é™çº§"><span>Q76: å¦‚ä½•å®ç°æœåŠ¡é™çº§</span></a></h3><p><strong>é™çº§ç­–ç•¥ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> GetUserInfo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">userID</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) (</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 1. å°è¯•ä»ç¼“å­˜è·å–</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">userID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 2. ç†”æ–­å™¨æ£€æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> circuitBreaker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">IsOpen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // é™çº§ï¼šè¿”å›é»˜è®¤æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getDefaultUser</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">userID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 3. è°ƒç”¨æœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">userID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        circuitBreaker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RecordFailure</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // é™çº§ï¼šè¿”å›ç¼“å­˜çš„æ—§æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">GetStale</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">userID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q77-ä»€ä¹ˆæ˜¯é«˜å¯ç”¨-å¦‚ä½•å®ç°" tabindex="-1"><a class="header-anchor" href="#q77-ä»€ä¹ˆæ˜¯é«˜å¯ç”¨-å¦‚ä½•å®ç°"><span>Q77: ä»€ä¹ˆæ˜¯é«˜å¯ç”¨ï¼Œå¦‚ä½•å®ç°</span></a></h3><p><strong>é«˜å¯ç”¨ = ç³»ç»ŸæŒç»­æä¾›æœåŠ¡çš„èƒ½åŠ›</strong></p><table><thead><tr><th style="text-align:left;">å±‚é¢</th><th style="text-align:left;">æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>åº”ç”¨å±‚</strong></td><td style="text-align:left;">å¤šå®ä¾‹éƒ¨ç½²ã€æ— çŠ¶æ€æœåŠ¡</td></tr><tr><td style="text-align:left;"><strong>ç½‘ç»œå±‚</strong></td><td style="text-align:left;">è´Ÿè½½å‡è¡¡ã€å¤šæœºæˆ¿</td></tr><tr><td style="text-align:left;"><strong>æ•°æ®å±‚</strong></td><td style="text-align:left;">ä¸»ä»å¤åˆ¶ã€è¯»å†™åˆ†ç¦»</td></tr><tr><td style="text-align:left;"><strong>å®¹ç¾</strong></td><td style="text-align:left;">æ•…éšœè½¬ç§»ã€ç†”æ–­é™çº§</td></tr></tbody></table><p><strong>å¥åº·æ£€æŸ¥ï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> healthCheck</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Context</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // æ£€æŸ¥ä¾èµ–æœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> db</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Ping</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">JSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">503</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">H</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;status&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;unhealthy&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">})</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Ping</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">JSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">503</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">H</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;status&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;unhealthy&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">})</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">JSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">gin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">H</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;status&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;healthy&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">})</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="åä¸€ã€æ€§èƒ½è°ƒä¼˜" tabindex="-1"><a class="header-anchor" href="#åä¸€ã€æ€§èƒ½è°ƒä¼˜"><span>åä¸€ã€æ€§èƒ½è°ƒä¼˜</span></a></h2><h3 id="q78-pprof-æ€ä¹ˆç”¨" tabindex="-1"><a class="header-anchor" href="#q78-pprof-æ€ä¹ˆç”¨"><span>Q78: pprof æ€ä¹ˆç”¨</span></a></h3><p><strong>å¯ç”¨ pprofï¼š</strong></p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> _</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;net/http/pprof&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">go</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ListenAndServe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;:6060&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å¸¸ç”¨åˆ†æï¼š</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># CPU åˆ†æ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pprof</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://localhost:6060/debug/pprof/profile?seconds=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">30</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å†…å­˜åˆ†æ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pprof</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://localhost:6060/debug/pprof/heap</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Goroutine åˆ†æ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pprof</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://localhost:6060/debug/pprof/goroutine</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é˜»å¡åˆ†æ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pprof</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://localhost:6060/debug/pprof/block</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¸¸ç”¨å‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pprof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">top</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         # çƒ­ç‚¹å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pprof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">list</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> func</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # æŸ¥çœ‹å‡½æ•°ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pprof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">web</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         # ç”Ÿæˆå›¾å½¢</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q79-cpu-é£™é«˜å¦‚ä½•æ’æŸ¥" tabindex="-1"><a class="header-anchor" href="#q79-cpu-é£™é«˜å¦‚ä½•æ’æŸ¥"><span>Q79: CPU é£™é«˜å¦‚ä½•æ’æŸ¥</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 1. æ‰¾åˆ° Go è¿›ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ps</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aux</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myapp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 2. é‡‡é›† CPU Profile</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://localhost:6060/debug/pprof/profile?seconds=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">30</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cpu.pprof</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 3. åˆ†æ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pprof</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cpu.pprof</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pprof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">top</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 20</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pprof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">web</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å¸¸è§åŸå› ï¼š</strong></p><ul><li>æ­»å¾ªç¯</li><li>é¢‘ç¹ GC</li><li>é”ç«äº‰</li><li>æ­£åˆ™è¡¨è¾¾å¼</li></ul><hr><h3 id="q80-å†…å­˜æš´æ¶¨å¦‚ä½•æ’æŸ¥" tabindex="-1"><a class="header-anchor" href="#q80-å†…å­˜æš´æ¶¨å¦‚ä½•æ’æŸ¥"><span>Q80: å†…å­˜æš´æ¶¨å¦‚ä½•æ’æŸ¥</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é‡‡é›†å †å†…å­˜</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://localhost:6060/debug/pprof/heap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">heap.pprof</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åˆ†æ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pprof</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> heap.pprof</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pprof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">top</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -inuse_space</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # å½“å‰ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pprof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">top</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -alloc_space</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # ç´¯è®¡åˆ†é…</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å¸¸è§åŸå› ï¼š</strong></p><ul><li>Goroutine æ³„æ¼</li><li>ç¼“å­˜æ— é™å¢é•¿</li><li>å¤§å¯¹è±¡æœªé‡Šæ”¾</li><li>åˆ‡ç‰‡åº•å±‚æ•°ç»„æœªé‡Šæ”¾</li></ul><hr><h3 id="q81-ç«ç„°å›¾æ€ä¹ˆçœ‹" tabindex="-1"><a class="header-anchor" href="#q81-ç«ç„°å›¾æ€ä¹ˆçœ‹"><span>Q81: ç«ç„°å›¾æ€ä¹ˆçœ‹</span></a></h3><p><strong>ç”Ÿæˆç«ç„°å›¾ï¼š</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">go</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pprof</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -http=:8080</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cpu.pprof</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>è§£è¯»ï¼š</strong></p><ul><li><strong>æ¨ªè½´</strong>ï¼šå ç”¨æ¯”ä¾‹ï¼ˆè¶Šå®½è¶Šè€—èµ„æºï¼‰</li><li><strong>çºµè½´</strong>ï¼šè°ƒç”¨æ ˆæ·±åº¦</li><li><strong>é¢œè‰²</strong>ï¼šæ— ç‰¹æ®Šå«ä¹‰ï¼Œä»…åŒºåˆ†</li></ul><p><strong>ä¼˜åŒ–ç›®æ ‡ï¼š</strong> æ‰¾åˆ°æœ€å®½çš„&quot;å¹³å°&quot;ï¼ˆçƒ­ç‚¹å‡½æ•°ï¼‰</p><hr><h3 id="q82-å¦‚ä½•ä¼˜åŒ–-json-åºåˆ—åŒ–" tabindex="-1"><a class="header-anchor" href="#q82-å¦‚ä½•ä¼˜åŒ–-json-åºåˆ—åŒ–"><span>Q82: å¦‚ä½•ä¼˜åŒ– JSON åºåˆ—åŒ–</span></a></h3><table><thead><tr><th style="text-align:left;">åº“</th><th style="text-align:left;">ç‰¹ç‚¹</th></tr></thead><tbody><tr><td style="text-align:left;">encoding/json</td><td style="text-align:left;">æ ‡å‡†åº“ï¼Œé€šç”¨</td></tr><tr><td style="text-align:left;">jsoniter</td><td style="text-align:left;">å…¼å®¹æ ‡å‡†åº“ï¼Œæ›´å¿«</td></tr><tr><td style="text-align:left;">sonic</td><td style="text-align:left;">å­—èŠ‚è·³åŠ¨ï¼ŒSIMD åŠ é€Ÿ</td></tr><tr><td style="text-align:left;">easyjson</td><td style="text-align:left;">ä»£ç ç”Ÿæˆï¼Œé›¶åå°„</td></tr></tbody></table><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> jsoniter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;github.com/json-iterator/go&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> jsoniter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ConfigCompatibleWithStandardLibrary</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">json</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Marshal</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">obj</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">json</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Unmarshal</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">obj</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="åäºŒã€äº‘åŸç”Ÿéƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#åäºŒã€äº‘åŸç”Ÿéƒ¨ç½²"><span>åäºŒã€äº‘åŸç”Ÿéƒ¨ç½²</span></a></h2><h3 id="q83-go-æœåŠ¡-docker-é•œåƒæ€ä¹ˆåš" tabindex="-1"><a class="header-anchor" href="#q83-go-æœåŠ¡-docker-é•œåƒæ€ä¹ˆåš"><span>Q83: Go æœåŠ¡ Docker é•œåƒæ€ä¹ˆåš</span></a></h3><p><strong>å¤šé˜¶æ®µæ„å»ºï¼š</strong></p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-dockerfile"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ„å»ºé˜¶æ®µ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> golang:1.21-alpine </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> builder</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /app</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">COPY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> go.mod go.sum ./</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> go mod download</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">COPY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> . .</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> CGO_ENABLED=0 go build -o main .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è¿è¡Œé˜¶æ®µ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> alpine:latest</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> apk --no-cache add ca-certificates</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /app</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">COPY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> --from=builder /app/main .</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 8080</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;./main&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æœ€ç»ˆé•œåƒçº¦ 10-20MB</strong></p><hr><h3 id="q84-k8s-åŸºæœ¬ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#q84-k8s-åŸºæœ¬ç»„ä»¶"><span>Q84: K8s åŸºæœ¬ç»„ä»¶</span></a></h3><table><thead><tr><th style="text-align:left;">ç»„ä»¶</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>Pod</strong></td><td style="text-align:left;">æœ€å°éƒ¨ç½²å•å…ƒ</td></tr><tr><td style="text-align:left;"><strong>Deployment</strong></td><td style="text-align:left;">ç®¡ç† Pod å‰¯æœ¬</td></tr><tr><td style="text-align:left;"><strong>Service</strong></td><td style="text-align:left;">æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</td></tr><tr><td style="text-align:left;"><strong>Ingress</strong></td><td style="text-align:left;">å¯¹å¤–æš´éœ² HTTP æœåŠ¡</td></tr><tr><td style="text-align:left;"><strong>ConfigMap</strong></td><td style="text-align:left;">é…ç½®ç®¡ç†</td></tr><tr><td style="text-align:left;"><strong>Secret</strong></td><td style="text-align:left;">æ•æ„Ÿé…ç½®</td></tr></tbody></table><hr><h3 id="q85-æœåŠ¡å¦‚ä½•åœ¨-k8s-ä¸­æš´éœ²" tabindex="-1"><a class="header-anchor" href="#q85-æœåŠ¡å¦‚ä½•åœ¨-k8s-ä¸­æš´éœ²"><span>Q85: æœåŠ¡å¦‚ä½•åœ¨ K8s ä¸­æš´éœ²</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Serviceï¼ˆé›†ç¾¤å†…éƒ¨ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">v1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Service</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">my-service</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  selector</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    app</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">myapp</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  ports</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">80</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      targetPort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8080</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">---</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Ingressï¼ˆå¯¹å¤–ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Ingress</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">my-ingress</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  rules</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">api.example.com</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        paths</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            pathType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Prefix</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            backend</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">              service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">                name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">my-service</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">                port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">                  number</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q86-å¦‚ä½•åšæ»šåŠ¨æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#q86-å¦‚ä½•åšæ»šåŠ¨æ›´æ–°"><span>Q86: å¦‚ä½•åšæ»šåŠ¨æ›´æ–°</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">myapp</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  replicas</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  strategy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">RollingUpdate</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    rollingUpdate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      maxSurge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # æœ€å¤šå¤š 1 ä¸ª Pod</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      maxUnavailable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # æœ€å°‘å¯ç”¨æ•°</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å‘å¸ƒå‘½ä»¤ï¼š</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> deployment/myapp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myapp=myapp:v2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rollout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> deployment/myapp</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rollout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> undo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> deployment/myapp</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # å›æ»š</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="åä¸‰ã€å·¥ç¨‹èƒ½åŠ›" tabindex="-1"><a class="header-anchor" href="#åä¸‰ã€å·¥ç¨‹èƒ½åŠ›"><span>åä¸‰ã€å·¥ç¨‹èƒ½åŠ›</span></a></h2><h3 id="q87-go-é¡¹ç›®å¸¸è§ç›®å½•ç»“æ„" tabindex="-1"><a class="header-anchor" href="#q87-go-é¡¹ç›®å¸¸è§ç›®å½•ç»“æ„"><span>Q87: Go é¡¹ç›®å¸¸è§ç›®å½•ç»“æ„</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>project/</span></span>
<span class="line"><span>â”œâ”€â”€ cmd/                # å…¥å£</span></span>
<span class="line"><span>â”‚   â””â”€â”€ server/</span></span>
<span class="line"><span>â”‚       â””â”€â”€ main.go</span></span>
<span class="line"><span>â”œâ”€â”€ internal/           # ç§æœ‰ä»£ç </span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ handler/        # HTTP å¤„ç†</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ service/        # ä¸šåŠ¡é€»è¾‘</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ repository/     # æ•°æ®è®¿é—®</span></span>
<span class="line"><span>â”‚   â””â”€â”€ model/          # æ•°æ®æ¨¡å‹</span></span>
<span class="line"><span>â”œâ”€â”€ pkg/                # å¯å¯¼å‡ºçš„å…¬å…±åŒ…</span></span>
<span class="line"><span>â”œâ”€â”€ api/                # API å®šä¹‰ï¼ˆproto/swaggerï¼‰</span></span>
<span class="line"><span>â”œâ”€â”€ configs/            # é…ç½®æ–‡ä»¶</span></span>
<span class="line"><span>â”œâ”€â”€ scripts/            # è„šæœ¬</span></span>
<span class="line"><span>â”œâ”€â”€ test/               # æµ‹è¯•</span></span>
<span class="line"><span>â”œâ”€â”€ go.mod</span></span>
<span class="line"><span>â””â”€â”€ Makefile</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q88-å¦‚ä½•å†™å•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#q88-å¦‚ä½•å†™å•å…ƒæµ‹è¯•"><span>Q88: å¦‚ä½•å†™å•å…ƒæµ‹è¯•</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// user_service_test.go</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> TestCreateUser</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">t</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">testing</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // Arrange</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    mockRepo</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> &amp;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MockUserRepo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    service</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> NewUserService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mockRepo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    mockRepo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">On</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Create&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Anything</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // Act</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    err</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">})</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // Assert</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    assert</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NoError</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    mockRepo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">AssertExpectations</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è¡¨é©±åŠ¨æµ‹è¯•</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> TestAdd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">t</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">testing</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    tests</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> []</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        name</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">     string</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">b</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">     int</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        expected</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }{</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;positive&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">},</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;negative&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">},</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;zero&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">},</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> _</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tt</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> range</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tests</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Run</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">t</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">testing</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            result</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            assert</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Equal</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">expected</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        })</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q89-mock-æ€ä¹ˆåš" tabindex="-1"><a class="header-anchor" href="#q89-mock-æ€ä¹ˆåš"><span>Q89: Mock æ€ä¹ˆåš</span></a></h3><p><strong>å¸¸ç”¨ Mock åº“ï¼š</strong></p><table><thead><tr><th style="text-align:left;">åº“</th><th style="text-align:left;">ç‰¹ç‚¹</th></tr></thead><tbody><tr><td style="text-align:left;">gomock</td><td style="text-align:left;">å®˜æ–¹ï¼Œä»£ç ç”Ÿæˆ</td></tr><tr><td style="text-align:left;">testify/mock</td><td style="text-align:left;">ç®€å•æ˜“ç”¨</td></tr><tr><td style="text-align:left;">mockery</td><td style="text-align:left;">è‡ªåŠ¨ç”Ÿæˆ mock</td></tr></tbody></table><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-go"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä½¿ç”¨ testify/mock</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MockUserRepo</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    mock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Mock</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">m </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MockUserRepo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">GetByID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">id</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) (</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    args</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Called</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æµ‹è¯•ä¸­ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mockRepo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">On</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GetByID&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="q90-codereview-å…³æ³¨ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#q90-codereview-å…³æ³¨ä»€ä¹ˆ"><span>Q90: CodeReview å…³æ³¨ä»€ä¹ˆ</span></a></h3><table><thead><tr><th style="text-align:left;">æ–¹é¢</th><th style="text-align:left;">å…³æ³¨ç‚¹</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>æ­£ç¡®æ€§</strong></td><td style="text-align:left;">é€»è¾‘æ˜¯å¦æ­£ç¡®ï¼Œè¾¹ç•Œæ¡ä»¶</td></tr><tr><td style="text-align:left;"><strong>å®‰å…¨æ€§</strong></td><td style="text-align:left;">SQLæ³¨å…¥ã€XSSã€æƒé™æ ¡éªŒ</td></tr><tr><td style="text-align:left;"><strong>æ€§èƒ½</strong></td><td style="text-align:left;">N+1 æŸ¥è¯¢ã€å¤§å¾ªç¯ã€é”ç²’åº¦</td></tr><tr><td style="text-align:left;"><strong>å¯è¯»æ€§</strong></td><td style="text-align:left;">å‘½åã€æ³¨é‡Šã€å‡½æ•°é•¿åº¦</td></tr><tr><td style="text-align:left;"><strong>å¯æµ‹è¯•æ€§</strong></td><td style="text-align:left;">ä¾èµ–æ³¨å…¥ã€æ¥å£æŠ½è±¡</td></tr><tr><td style="text-align:left;"><strong>é”™è¯¯å¤„ç†</strong></td><td style="text-align:left;">error æ˜¯å¦æ­£ç¡®å¤„ç†</td></tr></tbody></table><hr><h2 id="åå››ã€é«˜é¢‘è€ƒç‚¹æ¸…å•" tabindex="-1"><a class="header-anchor" href="#åå››ã€é«˜é¢‘è€ƒç‚¹æ¸…å•"><span>åå››ã€é«˜é¢‘è€ƒç‚¹æ¸…å•</span></a></h2><h3 id="å¿…è€ƒ" tabindex="-1"><a class="header-anchor" href="#å¿…è€ƒ"><span>å¿…è€ƒ</span></a></h3><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-0" disabled="disabled"><label class="task-list-item-label" for="task-item-0"> slice/map åº•å±‚ç»“æ„å’Œæ‰©å®¹</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-1" disabled="disabled"><label class="task-list-item-label" for="task-item-1"> Goroutine vs çº¿ç¨‹ã€GMP æ¨¡å‹</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-2" disabled="disabled"><label class="task-list-item-label" for="task-item-2"> Channel åº•å±‚å’Œæ“ä½œè¡¨</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-3" disabled="disabled"><label class="task-list-item-label" for="task-item-3"> GC ä¸‰è‰²æ ‡è®°ã€å†™å±éšœ</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-4" disabled="disabled"><label class="task-list-item-label" for="task-item-4"> é€ƒé€¸åˆ†æ</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-5" disabled="disabled"><label class="task-list-item-label" for="task-item-5"> Context ä½¿ç”¨</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-6" disabled="disabled"><label class="task-list-item-label" for="task-item-6"> Gin ä¸­é—´ä»¶åŸç†</label></li></ul><h3 id="å¸¸è€ƒ" tabindex="-1"><a class="header-anchor" href="#å¸¸è€ƒ"><span>å¸¸è€ƒ</span></a></h3><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-7" disabled="disabled"><label class="task-list-item-label" for="task-item-7"> defer æ‰§è¡Œé¡ºåº</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-8" disabled="disabled"><label class="task-list-item-label" for="task-item-8"> select ç”¨æ³•</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-9" disabled="disabled"><label class="task-list-item-label" for="task-item-9"> sync.Mutex vs RWMutex</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-10" disabled="disabled"><label class="task-list-item-label" for="task-item-10"> sync.Pool åŸç†</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-11" disabled="disabled"><label class="task-list-item-label" for="task-item-11"> pprof ä½¿ç”¨</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-12" disabled="disabled"><label class="task-list-item-label" for="task-item-12"> é™æµç®—æ³•</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-13" disabled="disabled"><label class="task-list-item-label" for="task-item-13"> ç¼“å­˜ä¸€è‡´æ€§</label></li></ul><h3 id="è¿›é˜¶" tabindex="-1"><a class="header-anchor" href="#è¿›é˜¶"><span>è¿›é˜¶</span></a></h3><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-14" disabled="disabled"><label class="task-list-item-label" for="task-item-14"> ç³»ç»Ÿè®¾è®¡ï¼ˆé«˜å¹¶å‘ã€é«˜å¯ç”¨ï¼‰</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-15" disabled="disabled"><label class="task-list-item-label" for="task-item-15"> ç†”æ–­é™çº§å®ç°</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-16" disabled="disabled"><label class="task-list-item-label" for="task-item-16"> Goroutine æ³„æ¼æ£€æµ‹</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-17" disabled="disabled"><label class="task-list-item-label" for="task-item-17"> å†…å­˜æ³„æ¼æ’æŸ¥</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-18" disabled="disabled"><label class="task-list-item-label" for="task-item-18"> Docker/K8s éƒ¨ç½²</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-19" disabled="disabled"><label class="task-list-item-label" for="task-item-19"> å•å…ƒæµ‹è¯•å’Œ Mock</label></li></ul></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/codermast/codermast-notes/edit/main/docs/interview/golang.md" aria-label="ç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">æœ€è¿‘æ›´æ–°: </span><time class="vp-meta-info" datetime="2025-12-30T10:10:44.000Z" data-allow-mismatch>2025/12/30 10:10</time></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: codermast@qq.com">å‹äºº</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><!----><a class="route-link auto-link next" href="/interview/mysql.html" aria-label="MySQL é¢è¯•é¢˜"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">MySQL é¢è¯•é¢˜<iconify-icon class="vp-icon" icon="logos:mysql" sizing="height" height="1em"></iconify-icon></div></a></nav><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;"><div style="display: flex;align-items: center;justify-content: center;height: 96px"><span style="--loading-icon: url(&quot;data:image/svg+xml;utf8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; preserveAspectRatio=&#39;xMidYMid&#39; viewBox=&#39;25 25 50 50&#39;%3E%3CanimateTransform attributeName=&#39;transform&#39; type=&#39;rotate&#39; dur=&#39;2s&#39; keyTimes=&#39;0;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;360&#39;%3E%3C/animateTransform%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;20&#39; fill=&#39;none&#39; stroke=&#39;currentColor&#39; stroke-width=&#39;4&#39; stroke-linecap=&#39;round&#39;%3E%3Canimate attributeName=&#39;stroke-dasharray&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;1,200;90,200;1,200&#39;%3E%3C/animate%3E%3Canimate attributeName=&#39;stroke-dashoffset&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;-35px;-125px&#39;%3E%3C/animate%3E%3C/circle%3E%3C/svg%3E&quot;);--icon-size: 48px;display: inline-block;width: var(--icon-size);height: var(--icon-size);background-color: currentcolor;-webkit-mask-image: var(--loading-icon);mask-image: var(--loading-icon)"></span></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer"><a href="https://beian.miit.gov.cn/" target="_blank" rel="nofollow">é™•ICPå¤‡20010345å·-5</a></div><div class="vp-copyright">Copyright Â© 2025 Golang Clouds </div></footer></div><!--]--><!--]--><!--[--><!----><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/assets/app-EbySI1sk.js" defer></script>
  </body>
</html>
